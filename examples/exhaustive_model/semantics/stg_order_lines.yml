models:
  vulcan_demo.stg_order_lines:
    alias: orders
    description: "Staging table for order line items with transaction details"
    
    dimensions:
      includes:
        - order_item_sk
        - order_id
        - item_id
        - customer_id
        - order_date
        - product_id
        - warehouse_id
        - warehouse_id_filter
      
      enhancements:
        - name: order_date
          granularities:
            - name: daily
              interval: "1 day"
              description: "Daily order aggregation"
            - name: weekly
              interval: "1 week"
              description: "Weekly order aggregation"
            - name: monthly
              interval: "1 month"
              description: "Monthly order aggregation"

    joins:
      customers:
        type: one_to_many
        expression: "{orders.customer_id} = {customers.customer_id}"

    measures:
      total_order_lines:
        type: count
        expression: "{orders.order_item_sk}"
        description: "Total number of order line items"
      
      total_quantity:
        type: sum
        expression: "{orders.quantity}"
        description: "Total quantity ordered"
      
      total_line_revenue:
        type: sum
        expression: "{orders.line_revenue}"
        format: currency
        description: "Total revenue from order lines"
      
      avg_unit_price:
        type: avg
        expression: "{orders.unit_price}"
        format: currency
        description: "Average unit price"
      
      avg_quantity_per_line:
        type: avg
        expression: "{orders.quantity}"
        description: "Average quantity per order line"
    
      total_revenue:
        type: sum
        expression: "{orders.line_revenue}"
        filters:
          - "{orders.warehouse_id} = 'test'"
        description: "Total revenue from order lines by warehouse"
    segments:
      recent_orders:
        expression: "{orders.order_date} >= CURRENT_DATE - INTERVAL '30 days'"
        description: "Orders from the last 30 days"
      
      high_value_lines:
        expression: "{orders.line_revenue} >= 100"
        description: "Order lines with revenue >= $100"
      
      bulk_orders:
        expression: "{orders.quantity} >= 10"
        description: "Order lines with quantity >= 10"
    

