checks:
  vulcan_demo.incremental_by_unique_key:
    completeness:
      - missing_count(customer_id) = 0:
          name: no_missing_customer_ids
          attributes:
            description: "All customer records must have a customer ID"
      
      - missing_count(customer_name) = 0:
          name: no_missing_customer_names
          attributes:
            description: "All customer records must have a customer name"
      
      - missing_count(email) = 0:
          name: no_missing_emails
          attributes:
            description: "All customer records must have an email address"
      
      - row_count > 0:
          name: has_customers
          attributes:
            description: "At least one customer exists in the incremental model"
    
    validity:
      - failed rows:
          name: invalid_email_format
          fail query: |
            SELECT customer_id, customer_name, email, region_name
            FROM vulcan_demo.incremental_by_unique_key
            WHERE email NOT LIKE '%@%' OR email IS NULL
          samples limit: 10
          attributes:
            description: "Email addresses must be in valid format"
      
      - failed rows:
          name: negative_total_orders
          fail query: |
            SELECT customer_id, customer_name, total_orders, total_spent
            FROM vulcan_demo.incremental_by_unique_key
            WHERE total_orders < 0
          samples limit: 10
          attributes:
            description: "Total orders cannot be negative"
      
      - failed rows:
          name: negative_total_spent
          fail query: |
            SELECT customer_id, customer_name, total_orders, total_spent
            FROM vulcan_demo.incremental_by_unique_key
            WHERE total_spent < 0
          samples limit: 10
          attributes:
            description: "Total spent cannot be negative"
      
      - failed rows:
          name: invalid_customer_segment
          fail query: |
            SELECT customer_id, customer_name, customer_segment, total_spent
            FROM vulcan_demo.incremental_by_unique_key
            WHERE customer_segment NOT IN ('High Value', 'Medium Value', 'Low Value')
          samples limit: 10
          attributes:
            description: "Customer segment must be one of: High Value, Medium Value, Low Value"
      
      - failed rows:
          name: future_last_order_date
          fail query: |
            SELECT customer_id, customer_name, last_order_date, total_orders
            FROM vulcan_demo.incremental_by_unique_key
            WHERE last_order_date > CURRENT_DATE
          samples limit: 10
          attributes:
            description: "Last order date cannot be in the future"
    
    uniqueness:
      - duplicate_count(customer_id) = 0:
          name: unique_customer_ids
          attributes:
            description: "Customer IDs must be unique (this is the unique key for incremental model)"
    
    accuracy:
      - anomaly detection for row_count:
          name: row_count_anomaly
          attributes:
            description: "Detect anomalies in customer count using historic data"
      
      - anomaly detection for avg(total_spent):
          name: avg_total_spent_anomaly
          attributes:
            description: "Detect anomalies in average total spent per customer using historic data"

