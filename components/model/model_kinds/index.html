<!DOCTYPE html>
<html class="no-js" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Complete documentation for Vulcan - complete stack for building data products" name="description"/>
<meta content="DataOS Vulcan Team" name="author"/>
<link href="https://tmdc-io.github.io/vulcan-docs/components/model/model_kinds/" rel="canonical"/>
<link href="../types/managed_models/" rel="prev"/>
<link href="../statements/" rel="next"/>
<link href="../../../assets/images/vulcan.svg" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.0" name="generator"/>
<title>Kinds - DataOS Vulcan</title>
<link href="../../../assets/stylesheets/main.618322db.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
<link href="../../../assets/stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body data-md-color-accent="blue-grey" data-md-color-primary="blue-grey" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#kinds">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="DataOS Vulcan" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="DataOS Vulcan">
<img alt="logo" src="../../../assets/images/vulcan-white.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DataOS Vulcan
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Kinds
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue-grey" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue-grey" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/tmdc-io/vulcan-book" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    tmdc-io/vulcan-book
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DataOS Vulcan" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="DataOS Vulcan">
<img alt="logo" src="../../../assets/images/vulcan-white.svg"/>
</a>
    DataOS Vulcan
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/tmdc-io/vulcan-book" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    tmdc-io/vulcan-book
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    
  
    About
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Configurations
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Configurations
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/overview/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Options
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Options
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/options/model_defaults/">
<span class="md-ellipsis">
    
  
    Model Defaults
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/options/variables/">
<span class="md-ellipsis">
    
  
    Variables
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/options/execution_hooks/">
<span class="md-ellipsis">
    
  
    Execution Hooks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/options/notifications/">
<span class="md-ellipsis">
    
  
    Notifications
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/options/linter/">
<span class="md-ellipsis">
    
  
    Linter
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Engines
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Engines
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/engines/postgres/postgres/">
<span class="md-ellipsis">
    
  
    Postgres
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../configurations/engines/snowflake/snowflake/">
<span class="md-ellipsis">
    
  
    Snowflake
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ci-cd/ci-cd/">
<span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Components
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Components
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Model
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Model
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../overview/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../properties/">
<span class="md-ellipsis">
    
  
    Properties
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_1_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1_3" id="__nav_3_1_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Types
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_1_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_1_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Types
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../types/sql_models/">
<span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../types/python_models/">
<span class="md-ellipsis">
    
  
    Python
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../types/external_models/">
<span class="md-ellipsis">
    
  
    External
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../types/managed_models/">
<span class="md-ellipsis">
    
  
    Managed
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    Kinds
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Kinds
  

    
  </span>
</a>
<nav aria-label="On this page" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      On this page
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_by_time_range">
<span class="md-ellipsis">
      
        INCREMENTAL_BY_TIME_RANGE
      
    </span>
</a>
<nav aria-label="INCREMENTAL_BY_TIME_RANGE" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#time-column">
<span class="md-ellipsis">
      
        Time Column
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#partitioning">
<span class="md-ellipsis">
      
        Partitioning
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#idempotency">
<span class="md-ellipsis">
      
        Idempotency
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_by_unique_key">
<span class="md-ellipsis">
      
        INCREMENTAL_BY_UNIQUE_KEY
      
    </span>
</a>
<nav aria-label="INCREMENTAL_BY_UNIQUE_KEY" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unique-key-expressions">
<span class="md-ellipsis">
      
        Unique Key Expressions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#when-matched-expression">
<span class="md-ellipsis">
      
        When Matched Expression
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#merge-filter-expression">
<span class="md-ellipsis">
      
        Merge Filter Expression
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy_1">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#full">
<span class="md-ellipsis">
      
        FULL
      
    </span>
</a>
<nav aria-label="FULL" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy_2">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#view">
<span class="md-ellipsis">
      
        VIEW
      
    </span>
</a>
<nav aria-label="VIEW" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#materialized-views">
<span class="md-ellipsis">
      
        Materialized Views
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#embedded">
<span class="md-ellipsis">
      
        EMBEDDED
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#seed">
<span class="md-ellipsis">
      
        SEED
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2">
<span class="md-ellipsis">
      
        SCD Type 2
      
    </span>
</a>
<nav aria-label="SCD Type 2" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-time-recommended">
<span class="md-ellipsis">
      
        SCD Type 2 By Time (Recommended)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-column">
<span class="md-ellipsis">
      
        SCD Type 2 By Column
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#change-column-names">
<span class="md-ellipsis">
      
        Change Column Names
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deletes">
<span class="md-ellipsis">
      
        Deletes
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-of-scd-type-2-by-time-in-action">
<span class="md-ellipsis">
      
        Example of SCD Type 2 By Time in Action
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-of-scd-type-2-by-column-in-action">
<span class="md-ellipsis">
      
        Example of SCD Type 2 By Column in Action
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#shared-configuration-options">
<span class="md-ellipsis">
      
        Shared Configuration Options
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-time-configuration-options">
<span class="md-ellipsis">
      
        SCD Type 2 By Time Configuration Options
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-column-configuration-options">
<span class="md-ellipsis">
      
        SCD Type 2 By Column Configuration Options
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#processing-source-table-with-historical-data">
<span class="md-ellipsis">
      
        Processing Source Table with Historical Data
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#querying-scd-type-2-models">
<span class="md-ellipsis">
      
        Querying SCD Type 2 Models
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reset-scd-type-2-model-clearing-history">
<span class="md-ellipsis">
      
        Reset SCD Type 2 Model (Clearing History)
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#external">
<span class="md-ellipsis">
      
        EXTERNAL
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#managed">
<span class="md-ellipsis">
      
        MANAGED
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_by_partition">
<span class="md-ellipsis">
      
        INCREMENTAL_BY_PARTITION
      
    </span>
</a>
<nav aria-label="INCREMENTAL_BY_PARTITION" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      
        Example
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy_3">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_unmanaged">
<span class="md-ellipsis">
      
        INCREMENTAL_UNMANAGED
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../statements/">
<span class="md-ellipsis">
    
  
    Statements
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tests/tests/">
<span class="md-ellipsis">
    
  
    Tests
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../audits/audits/">
<span class="md-ellipsis">
    
  
    Audits
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../checks/checks/">
<span class="md-ellipsis">
    
  
    Checks
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Semantics
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Semantics
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../semantics/overview/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../semantics/models/">
<span class="md-ellipsis">
    
  
    Semantic Models
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../semantics/business_metrics/">
<span class="md-ellipsis">
    
  
    Business Metrics
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Advance Features
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Advance Features
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1" id="__nav_3_6_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Macros
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_6_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_6_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Macros
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced-features/macros/overview/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced-features/macros/variables/">
<span class="md-ellipsis">
    
  
    Variables
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced-features/macros/built_in/">
<span class="md-ellipsis">
    
  
    Built In
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced-features/macros/jinja/">
<span class="md-ellipsis">
    
  
    Jinja
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced-features/signals/">
<span class="md-ellipsis">
    
  
    Signals
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced-features/custom_materializations/">
<span class="md-ellipsis">
    
  
    Custom materializations
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/get-started/docker/">
<span class="md-ellipsis">
    
  
    Get Started
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/plan_guide/">
<span class="md-ellipsis">
    
  
    Plan
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/run_and_scheduling/">
<span class="md-ellipsis">
    
  
    Run and Scheduling
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/models/">
<span class="md-ellipsis">
    
  
    Models
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/incremental_by_time/">
<span class="md-ellipsis">
    
  
    Incremental by Time
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/data_quality/">
<span class="md-ellipsis">
    
  
    Data Quality
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/model_selection/">
<span class="md-ellipsis">
    
  
    Model Selection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/transpiling_semantics/">
<span class="md-ellipsis">
    
  
    Transpiling Semantics
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cli-command/cli/">
<span class="md-ellipsis">
    
  
    CLI Commands
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cookbook/">
<span class="md-ellipsis">
    
  
    Cookbook
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../faq/">
<span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="On this page" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      On this page
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_by_time_range">
<span class="md-ellipsis">
      
        INCREMENTAL_BY_TIME_RANGE
      
    </span>
</a>
<nav aria-label="INCREMENTAL_BY_TIME_RANGE" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#time-column">
<span class="md-ellipsis">
      
        Time Column
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#partitioning">
<span class="md-ellipsis">
      
        Partitioning
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#idempotency">
<span class="md-ellipsis">
      
        Idempotency
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_by_unique_key">
<span class="md-ellipsis">
      
        INCREMENTAL_BY_UNIQUE_KEY
      
    </span>
</a>
<nav aria-label="INCREMENTAL_BY_UNIQUE_KEY" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unique-key-expressions">
<span class="md-ellipsis">
      
        Unique Key Expressions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#when-matched-expression">
<span class="md-ellipsis">
      
        When Matched Expression
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#merge-filter-expression">
<span class="md-ellipsis">
      
        Merge Filter Expression
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy_1">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#full">
<span class="md-ellipsis">
      
        FULL
      
    </span>
</a>
<nav aria-label="FULL" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy_2">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#view">
<span class="md-ellipsis">
      
        VIEW
      
    </span>
</a>
<nav aria-label="VIEW" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#materialized-views">
<span class="md-ellipsis">
      
        Materialized Views
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#embedded">
<span class="md-ellipsis">
      
        EMBEDDED
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#seed">
<span class="md-ellipsis">
      
        SEED
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2">
<span class="md-ellipsis">
      
        SCD Type 2
      
    </span>
</a>
<nav aria-label="SCD Type 2" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-time-recommended">
<span class="md-ellipsis">
      
        SCD Type 2 By Time (Recommended)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-column">
<span class="md-ellipsis">
      
        SCD Type 2 By Column
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#change-column-names">
<span class="md-ellipsis">
      
        Change Column Names
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deletes">
<span class="md-ellipsis">
      
        Deletes
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-of-scd-type-2-by-time-in-action">
<span class="md-ellipsis">
      
        Example of SCD Type 2 By Time in Action
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-of-scd-type-2-by-column-in-action">
<span class="md-ellipsis">
      
        Example of SCD Type 2 By Column in Action
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#shared-configuration-options">
<span class="md-ellipsis">
      
        Shared Configuration Options
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-time-configuration-options">
<span class="md-ellipsis">
      
        SCD Type 2 By Time Configuration Options
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scd-type-2-by-column-configuration-options">
<span class="md-ellipsis">
      
        SCD Type 2 By Column Configuration Options
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#processing-source-table-with-historical-data">
<span class="md-ellipsis">
      
        Processing Source Table with Historical Data
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#querying-scd-type-2-models">
<span class="md-ellipsis">
      
        Querying SCD Type 2 Models
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reset-scd-type-2-model-clearing-history">
<span class="md-ellipsis">
      
        Reset SCD Type 2 Model (Clearing History)
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#external">
<span class="md-ellipsis">
      
        EXTERNAL
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#managed">
<span class="md-ellipsis">
      
        MANAGED
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_by_partition">
<span class="md-ellipsis">
      
        INCREMENTAL_BY_PARTITION
      
    </span>
</a>
<nav aria-label="INCREMENTAL_BY_PARTITION" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      
        Example
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#materialization-strategy_3">
<span class="md-ellipsis">
      
        Materialization strategy
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incremental_unmanaged">
<span class="md-ellipsis">
      
        INCREMENTAL_UNMANAGED
      
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<nav aria-label="Navigation" class="md-path">
<ol class="md-path__list">
<li class="md-path__item">
<a class="md-path__link" href="../../..">
<span class="md-ellipsis">
    About
  </span>
</a>
</li>
<li class="md-path__item">
<a class="md-path__link" href="../overview/">
<span class="md-ellipsis">
    Components
  </span>
</a>
</li>
<li class="md-path__item">
<a class="md-path__link" href="../overview/">
<span class="md-ellipsis">
    Model
  </span>
</a>
</li>
</ol>
</nav>
<article class="md-content__inner md-typeset">
<h1 id="kinds">Kinds<a class="headerlink" href="#kinds" title="Link to this section">¶</a></h1>
<p>Model kinds determine how Vulcan loads and processes your data. Each kind is optimized for different use cases. Some rebuild everything from scratch, others update incrementally, and some create views that compute on-demand.</p>
<h2 id="incremental_by_time_range">INCREMENTAL_BY_TIME_RANGE<a class="headerlink" href="#incremental_by_time_range" title="Link to this section">¶</a></h2>
<p><code>INCREMENTAL_BY_TIME_RANGE</code> models are perfect for time-series data, things like events, logs, transactions, or any data that arrives over time. Instead of rebuilding everything each run (like FULL models do), these models only process the time intervals that are missing or need updating.</p>
<p>If you're processing daily sales data, you don't want to reprocess all of 2023 just to add today's data. With <code>INCREMENTAL_BY_TIME_RANGE</code>, Vulcan only processes the new intervals, which saves time and money.</p>
<p>To use this kind, you need to tell Vulcan two things:</p>
<ol>
<li><strong>Which column has your time data</strong> - So Vulcan knows how to partition and filter</li>
<li><strong>A WHERE clause</strong> - That filters your upstream data by time range using Vulcan's time macros</li>
</ol>
<p>You specify the time column in your <code>MODEL</code> DDL using the <code>time_column</code> key. Here's a simple example:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">daily_sales</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="c1">-- This model's time information is stored in the `order_date` column</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p><a id="timezones"></a>
In addition to specifying a time column in the <code>MODEL</code> DDL, the model's query must contain a <code>WHERE</code> clause that filters the upstream records by time range. Vulcan provides special macros that represent the start and end of the time range being processed: <code>@start_date</code> / <code>@end_date</code> and <code>@start_ds</code> / <code>@end_ds</code>. See <a href="../../advanced-features/macros/variables/">Macros</a> for more information.</p>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>This example demonstrates incremental by time range models.</p>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incrementals_demo</span><span class="p">,</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="c1">-- How does this model kind behave?</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="c1">--   DELETE by time range, then INSERT</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">transaction_date</span><span class="p">,</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="c1">-- How do I handle late-arriving data?</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="c1">--   Handle late-arriving events for the past 2 (2*1) days based on cron</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="c1">--   interval. Each time it runs, it will process today, yesterday, and</span>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="c1">--   the day before yesterday.</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="n">lookback</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a>
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">  </span><span class="c1">-- Don't backfill data before this date</span>
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2024-10-25'</span><span class="p">,</span>
</span><span id="__span-1-21"><a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a>
</span><span id="__span-1-22"><a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">  </span><span class="c1">-- What schedule should I run these at?</span>
</span><span id="__span-1-23"><a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a>
</span><span id="__span-1-24"><a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">  </span><span class="c1">--   Daily at Midnight UTC</span>
</span><span id="__span-1-25"><a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-1-26"><a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a>
</span><span id="__span-1-27"><a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">  </span><span class="c1">-- Good documentation for the primary key</span>
</span><span id="__span-1-28"><a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">  </span><span class="n">grain</span><span class="w"> </span><span class="n">transaction_id</span><span class="p">,</span>
</span><span id="__span-1-29"><a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a>
</span><span id="__span-1-30"><a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">  </span><span class="c1">-- How do I test this data?</span>
</span><span id="__span-1-31"><a href="#__codelineno-1-31" id="__codelineno-1-31" name="__codelineno-1-31"></a>
</span><span id="__span-1-32"><a href="#__codelineno-1-32" id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">  </span><span class="c1">--   Validate that the `transaction_id` primary key values are both unique</span>
</span><span id="__span-1-33"><a href="#__codelineno-1-33" id="__codelineno-1-33" name="__codelineno-1-33"></a>
</span><span id="__span-1-34"><a href="#__codelineno-1-34" id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">  </span><span class="c1">--   and non-null. Data audit tests only run for the processed intervals,</span>
</span><span id="__span-1-35"><a href="#__codelineno-1-35" id="__codelineno-1-35" name="__codelineno-1-35"></a>
</span><span id="__span-1-36"><a href="#__codelineno-1-36" id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">  </span><span class="c1">--   not for the entire table.</span>
</span><span id="__span-1-37"><a href="#__codelineno-1-37" id="__codelineno-1-37" name="__codelineno-1-37"></a>
</span><span id="__span-1-38"><a href="#__codelineno-1-38" id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">  </span><span class="c1">-- audits (</span>
</span><span id="__span-1-39"><a href="#__codelineno-1-39" id="__codelineno-1-39" name="__codelineno-1-39"></a>
</span><span id="__span-1-40"><a href="#__codelineno-1-40" id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="w">  </span><span class="c1">--   UNIQUE_VALUES(columns = (transaction_id)),</span>
</span><span id="__span-1-41"><a href="#__codelineno-1-41" id="__codelineno-1-41" name="__codelineno-1-41"></a>
</span><span id="__span-1-42"><a href="#__codelineno-1-42" id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">  </span><span class="c1">--   NOT_NULL(columns = (transaction_id))</span>
</span><span id="__span-1-43"><a href="#__codelineno-1-43" id="__codelineno-1-43" name="__codelineno-1-43"></a>
</span><span id="__span-1-44"><a href="#__codelineno-1-44" id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="w">  </span><span class="c1">-- )</span>
</span><span id="__span-1-45"><a href="#__codelineno-1-45" id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="p">);</span>
</span><span id="__span-1-46"><a href="#__codelineno-1-46" id="__codelineno-1-46" name="__codelineno-1-46"></a>
</span><span id="__span-1-47"><a href="#__codelineno-1-47" id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="k">WITH</span><span class="w"> </span><span class="n">sales_data</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-48"><a href="#__codelineno-1-48" id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-1-49"><a href="#__codelineno-1-49" id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="w">    </span><span class="n">transaction_id</span><span class="p">,</span>
</span><span id="__span-1-50"><a href="#__codelineno-1-50" id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="w">    </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-1-51"><a href="#__codelineno-1-51" id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-1-52"><a href="#__codelineno-1-52" id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="w">    </span><span class="n">transaction_amount</span><span class="p">,</span>
</span><span id="__span-1-53"><a href="#__codelineno-1-53" id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="w">    </span><span class="c1">-- How do I account for UTC vs. PST (California baby) timestamps?</span>
</span><span id="__span-1-54"><a href="#__codelineno-1-54" id="__codelineno-1-54" name="__codelineno-1-54"></a>
</span><span id="__span-1-55"><a href="#__codelineno-1-55" id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="w">    </span><span class="c1">--   Make sure all time columns are in UTC and convert them to PST in the</span>
</span><span id="__span-1-56"><a href="#__codelineno-1-56" id="__codelineno-1-56" name="__codelineno-1-56"></a>
</span><span id="__span-1-57"><a href="#__codelineno-1-57" id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="w">    </span><span class="c1">--   presentation layer downstream.</span>
</span><span id="__span-1-58"><a href="#__codelineno-1-58" id="__codelineno-1-58" name="__codelineno-1-58"></a><span class="w">    </span><span class="n">transaction_timestamp</span><span class="p">,</span>
</span><span id="__span-1-59"><a href="#__codelineno-1-59" id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="w">    </span><span class="n">payment_method</span><span class="p">,</span>
</span><span id="__span-1-60"><a href="#__codelineno-1-60" id="__codelineno-1-60" name="__codelineno-1-60"></a><span class="w">    </span><span class="n">currency</span>
</span><span id="__span-1-61"><a href="#__codelineno-1-61" id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">tcloud_raw_data</span><span class="p">.</span><span class="n">sales</span><span class="w">  </span><span class="c1">-- Source A: sales data</span>
</span><span id="__span-1-62"><a href="#__codelineno-1-62" id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="w">  </span><span class="c1">-- How do I make this run fast and only process the necessary intervals?</span>
</span><span id="__span-1-63"><a href="#__codelineno-1-63" id="__codelineno-1-63" name="__codelineno-1-63"></a>
</span><span id="__span-1-64"><a href="#__codelineno-1-64" id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="w">  </span><span class="c1">--   Use our date macros that will automatically run the necessary intervals.</span>
</span><span id="__span-1-65"><a href="#__codelineno-1-65" id="__codelineno-1-65" name="__codelineno-1-65"></a>
</span><span id="__span-1-66"><a href="#__codelineno-1-66" id="__codelineno-1-66" name="__codelineno-1-66"></a><span class="w">  </span><span class="c1">--   Because Vulcan manages state, it will know what needs to run each time</span>
</span><span id="__span-1-67"><a href="#__codelineno-1-67" id="__codelineno-1-67" name="__codelineno-1-67"></a>
</span><span id="__span-1-68"><a href="#__codelineno-1-68" id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="w">  </span><span class="c1">--   you invoke `vulcan run`.</span>
</span><span id="__span-1-69"><a href="#__codelineno-1-69" id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">transaction_timestamp</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_dt</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_dt</span>
</span><span id="__span-1-70"><a href="#__codelineno-1-70" id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="p">),</span>
</span><span id="__span-1-71"><a href="#__codelineno-1-71" id="__codelineno-1-71" name="__codelineno-1-71"></a>
</span><span id="__span-1-72"><a href="#__codelineno-1-72" id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="n">product_usage</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-73"><a href="#__codelineno-1-73" id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-1-74"><a href="#__codelineno-1-74" id="__codelineno-1-74" name="__codelineno-1-74"></a><span class="w">    </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-1-75"><a href="#__codelineno-1-75" id="__codelineno-1-75" name="__codelineno-1-75"></a><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-1-76"><a href="#__codelineno-1-76" id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="w">    </span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-1-77"><a href="#__codelineno-1-77" id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="w">    </span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-1-78"><a href="#__codelineno-1-78" id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="w">    </span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-1-79"><a href="#__codelineno-1-79" id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="w">    </span><span class="n">user_segment</span>
</span><span id="__span-1-80"><a href="#__codelineno-1-80" id="__codelineno-1-80" name="__codelineno-1-80"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">tcloud_raw_data</span><span class="p">.</span><span class="n">product_usage</span><span class="w">  </span><span class="c1">-- Source B</span>
</span><span id="__span-1-81"><a href="#__codelineno-1-81" id="__codelineno-1-81" name="__codelineno-1-81"></a><span class="w">  </span><span class="c1">-- Include usage data from the 30 days before the interval</span>
</span><span id="__span-1-82"><a href="#__codelineno-1-82" id="__codelineno-1-82" name="__codelineno-1-82"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">last_usage_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="o">@</span><span class="n">start_dt</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_dt</span>
</span><span id="__span-1-83"><a href="#__codelineno-1-83" id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="p">)</span>
</span><span id="__span-1-84"><a href="#__codelineno-1-84" id="__codelineno-1-84" name="__codelineno-1-84"></a>
</span><span id="__span-1-85"><a href="#__codelineno-1-85" id="__codelineno-1-85" name="__codelineno-1-85"></a><span class="k">SELECT</span>
</span><span id="__span-1-86"><a href="#__codelineno-1-86" id="__codelineno-1-86" name="__codelineno-1-86"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">,</span>
</span><span id="__span-1-87"><a href="#__codelineno-1-87" id="__codelineno-1-87" name="__codelineno-1-87"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-1-88"><a href="#__codelineno-1-88" id="__codelineno-1-88" name="__codelineno-1-88"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-1-89"><a href="#__codelineno-1-89" id="__codelineno-1-89" name="__codelineno-1-89"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">transaction_amount</span><span class="p">,</span>
</span><span id="__span-1-90"><a href="#__codelineno-1-90" id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="w">  </span><span class="c1">-- Extract the date from the timestamp to partition by day</span>
</span><span id="__span-1-91"><a href="#__codelineno-1-91" id="__codelineno-1-91" name="__codelineno-1-91"></a><span class="w">  </span><span class="nb">DATE</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">transaction_timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">transaction_date</span><span class="p">,</span>
</span><span id="__span-1-92"><a href="#__codelineno-1-92" id="__codelineno-1-92" name="__codelineno-1-92"></a><span class="w">  </span><span class="c1">-- Convert timestamp to PST using a SQL function in the presentation layer for end users</span>
</span><span id="__span-1-93"><a href="#__codelineno-1-93" id="__codelineno-1-93" name="__codelineno-1-93"></a><span class="w">  </span><span class="n">DATETIME</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">transaction_timestamp</span><span class="p">,</span><span class="w"> </span><span class="s1">'America/Los_Angeles'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">transaction_timestamp_pst</span><span class="p">,</span>
</span><span id="__span-1-94"><a href="#__codelineno-1-94" id="__codelineno-1-94" name="__codelineno-1-94"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">payment_method</span><span class="p">,</span>
</span><span id="__span-1-95"><a href="#__codelineno-1-95" id="__codelineno-1-95" name="__codelineno-1-95"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">currency</span><span class="p">,</span>
</span><span id="__span-1-96"><a href="#__codelineno-1-96" id="__codelineno-1-96" name="__codelineno-1-96"></a><span class="w">  </span><span class="c1">-- Product usage metrics</span>
</span><span id="__span-1-97"><a href="#__codelineno-1-97" id="__codelineno-1-97" name="__codelineno-1-97"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-1-98"><a href="#__codelineno-1-98" id="__codelineno-1-98" name="__codelineno-1-98"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-1-99"><a href="#__codelineno-1-99" id="__codelineno-1-99" name="__codelineno-1-99"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-1-100"><a href="#__codelineno-1-100" id="__codelineno-1-100" name="__codelineno-1-100"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">user_segment</span><span class="p">,</span>
</span><span id="__span-1-101"><a href="#__codelineno-1-101" id="__codelineno-1-101" name="__codelineno-1-101"></a><span class="w">  </span><span class="c1">-- Derived metrics</span>
</span><span id="__span-1-102"><a href="#__codelineno-1-102" id="__codelineno-1-102" name="__codelineno-1-102"></a><span class="w">  </span><span class="k">CASE</span>
</span><span id="__span-1-103"><a href="#__codelineno-1-103" id="__codelineno-1-103" name="__codelineno-1-103"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">feature_utilization_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-1-104"><a href="#__codelineno-1-104" id="__codelineno-1-104" name="__codelineno-1-104"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-1-105"><a href="#__codelineno-1-105" id="__codelineno-1-105" name="__codelineno-1-105"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-1-106"><a href="#__codelineno-1-106" id="__codelineno-1-106" name="__codelineno-1-106"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-1-107"><a href="#__codelineno-1-107" id="__codelineno-1-107" name="__codelineno-1-107"></a><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">user_type</span><span class="p">,</span>
</span><span id="__span-1-108"><a href="#__codelineno-1-108" id="__codelineno-1-108" name="__codelineno-1-108"></a><span class="w">  </span><span class="c1">-- Time since last usage</span>
</span><span id="__span-1-109"><a href="#__codelineno-1-109" id="__codelineno-1-109" name="__codelineno-1-109"></a><span class="w">  </span><span class="n">DATE_DIFF</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">transaction_timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">last_usage_date</span><span class="p">,</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">days_since_last_usage</span>
</span><span id="__span-1-110"><a href="#__codelineno-1-110" id="__codelineno-1-110" name="__codelineno-1-110"></a><span class="k">FROM</span><span class="w"> </span><span class="n">sales_data</span><span class="w"> </span><span class="n">s</span>
</span><span id="__span-1-111"><a href="#__codelineno-1-111" id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">product_usage</span><span class="w"> </span><span class="n">p</span>
</span><span id="__span-1-112"><a href="#__codelineno-1-112" id="__codelineno-1-112" name="__codelineno-1-112"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span>
</span><span id="__span-1-113"><a href="#__codelineno-1-113" id="__codelineno-1-113" name="__codelineno-1-113"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">customer_id</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>50975949</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incrementals_demo__50975949</span><span class="o">`</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">,</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'We extract the date from the timestamp to partition by day'</span><span class="p">),</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Convert this to PST using a SQL function'</span><span class="p">),</span>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">  </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">  </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span>
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="n">FLOAT64</span><span class="p">,</span>
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-14"><a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">  </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Derived metrics'</span><span class="p">),</span>
</span><span id="__span-2-15"><a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">  </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Time since last usage'</span><span class="p">)</span>
</span><span id="__span-2-16"><a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-2-17"><a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">  </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will validate the SQL before processing data (note the <code>WHERE FALSE LIMIT 0</code> and the placeholder timestamps).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">WITH</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">    </span><span class="k">FALSE</span>
</span><span id="__span-3-15"><a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="p">),</span>
</span><span id="__span-3-16"><a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-17"><a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-3-18"><a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-19"><a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-20"><a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-21"><a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-22"><a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-23"><a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span>
</span><span id="__span-3-24"><a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span>
</span><span id="__span-3-25"><a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-26"><a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-27"><a href="#__codelineno-3-27" id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1969-12-02 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span>
</span><span id="__span-3-28"><a href="#__codelineno-3-28" id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-29"><a href="#__codelineno-3-29" id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">    </span><span class="k">FALSE</span>
</span><span id="__span-3-30"><a href="#__codelineno-3-30" id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="p">)</span>
</span><span id="__span-3-31"><a href="#__codelineno-3-31" id="__codelineno-3-31" name="__codelineno-3-31"></a>
</span><span id="__span-3-32"><a href="#__codelineno-3-32" id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="k">SELECT</span>
</span><span id="__span-3-33"><a href="#__codelineno-3-33" id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-34"><a href="#__codelineno-3-34" id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-35"><a href="#__codelineno-3-35" id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-36"><a href="#__codelineno-3-36" id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="w">  </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-37"><a href="#__codelineno-3-37" id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="w">  </span><span class="nb">DATE</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-38"><a href="#__codelineno-3-38" id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="w">  </span><span class="n">DATETIME</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="s1">'America/Los_Angeles'</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-39"><a href="#__codelineno-3-39" id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-40"><a href="#__codelineno-3-40" id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-41"><a href="#__codelineno-3-41" id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-42"><a href="#__codelineno-3-42" id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-43"><a href="#__codelineno-3-43" id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-44"><a href="#__codelineno-3-44" id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-45"><a href="#__codelineno-3-45" id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="w">  </span><span class="k">CASE</span>
</span><span id="__span-3-46"><a href="#__codelineno-3-46" id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-3-47"><a href="#__codelineno-3-47" id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-3-48"><a href="#__codelineno-3-48" id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-3-49"><a href="#__codelineno-3-49" id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-3-50"><a href="#__codelineno-3-50" id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-51"><a href="#__codelineno-3-51" id="__codelineno-3-51" name="__codelineno-3-51"></a><span class="w">  </span><span class="n">DATE_DIFF</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-3-52"><a href="#__codelineno-3-52" id="__codelineno-3-52" name="__codelineno-3-52"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span>
</span><span id="__span-3-53"><a href="#__codelineno-3-53" id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span>
</span><span id="__span-3-54"><a href="#__codelineno-3-54" id="__codelineno-3-54" name="__codelineno-3-54"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-55"><a href="#__codelineno-3-55" id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span>
</span><span id="__span-3-56"><a href="#__codelineno-3-56" id="__codelineno-3-56" name="__codelineno-3-56"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">FALSE</span>
</span><span id="__span-3-57"><a href="#__codelineno-3-57" id="__codelineno-3-57" name="__codelineno-3-57"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p>Vulcan will merge data into the empty table.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">MERGE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incrementals_demo__50975949</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">__MERGE_TARGET__</span><span class="o">`</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">      </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">      </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">      </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">      </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">      </span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">      </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">      </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span>
</span><span id="__span-4-11"><a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span>
</span><span id="__span-4-12"><a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span>
</span><span id="__span-4-13"><a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-4-14"><a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">  </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-15"><a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-4-16"><a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">      </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-17"><a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">      </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-18"><a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">      </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-19"><a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">      </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-20"><a href="#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">      </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-21"><a href="#__codelineno-4-21" id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">      </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span>
</span><span id="__span-4-22"><a href="#__codelineno-4-22" id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span>
</span><span id="__span-4-23"><a href="#__codelineno-4-23" id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">),</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">'30'</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span>
</span><span id="__span-4-24"><a href="#__codelineno-4-24" id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-4-25"><a href="#__codelineno-4-25" id="__codelineno-4-25" name="__codelineno-4-25"></a>
</span><span id="__span-4-26"><a href="#__codelineno-4-26" id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-4-27"><a href="#__codelineno-4-27" id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-28"><a href="#__codelineno-4-28" id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">    </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-29"><a href="#__codelineno-4-29" id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="w">    </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-30"><a href="#__codelineno-4-30" id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-31"><a href="#__codelineno-4-31" id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-32"><a href="#__codelineno-4-32" id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-33"><a href="#__codelineno-4-33" id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="w">    </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-34"><a href="#__codelineno-4-34" id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="w">    </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-35"><a href="#__codelineno-4-35" id="__codelineno-4-35" name="__codelineno-4-35"></a><span class="w">    </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-36"><a href="#__codelineno-4-36" id="__codelineno-4-36" name="__codelineno-4-36"></a><span class="w">    </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-37"><a href="#__codelineno-4-37" id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="w">    </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-38"><a href="#__codelineno-4-38" id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="w">    </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-39"><a href="#__codelineno-4-39" id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="w">    </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-40"><a href="#__codelineno-4-40" id="__codelineno-4-40" name="__codelineno-4-40"></a><span class="w">    </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-41"><a href="#__codelineno-4-41" id="__codelineno-4-41" name="__codelineno-4-41"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-42"><a href="#__codelineno-4-42" id="__codelineno-4-42" name="__codelineno-4-42"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-4-43"><a href="#__codelineno-4-43" id="__codelineno-4-43" name="__codelineno-4-43"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-44"><a href="#__codelineno-4-44" id="__codelineno-4-44" name="__codelineno-4-44"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-45"><a href="#__codelineno-4-45" id="__codelineno-4-45" name="__codelineno-4-45"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-46"><a href="#__codelineno-4-46" id="__codelineno-4-46" name="__codelineno-4-46"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-47"><a href="#__codelineno-4-47" id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="w">      </span><span class="nb">DATE</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-48"><a href="#__codelineno-4-48" id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="w">      </span><span class="n">DATETIME</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="s1">'America/Los_Angeles'</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-49"><a href="#__codelineno-4-49" id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-50"><a href="#__codelineno-4-50" id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-51"><a href="#__codelineno-4-51" id="__codelineno-4-51" name="__codelineno-4-51"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-52"><a href="#__codelineno-4-52" id="__codelineno-4-52" name="__codelineno-4-52"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-53"><a href="#__codelineno-4-53" id="__codelineno-4-53" name="__codelineno-4-53"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-54"><a href="#__codelineno-4-54" id="__codelineno-4-54" name="__codelineno-4-54"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-55"><a href="#__codelineno-4-55" id="__codelineno-4-55" name="__codelineno-4-55"></a><span class="w">      </span><span class="k">CASE</span>
</span><span id="__span-4-56"><a href="#__codelineno-4-56" id="__codelineno-4-56" name="__codelineno-4-56"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-4-57"><a href="#__codelineno-4-57" id="__codelineno-4-57" name="__codelineno-4-57"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-4-58"><a href="#__codelineno-4-58" id="__codelineno-4-58" name="__codelineno-4-58"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-4-59"><a href="#__codelineno-4-59" id="__codelineno-4-59" name="__codelineno-4-59"></a><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-4-60"><a href="#__codelineno-4-60" id="__codelineno-4-60" name="__codelineno-4-60"></a><span class="w">      </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-61"><a href="#__codelineno-4-61" id="__codelineno-4-61" name="__codelineno-4-61"></a><span class="w">      </span><span class="n">DATE_DIFF</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-62"><a href="#__codelineno-4-62" id="__codelineno-4-62" name="__codelineno-4-62"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span>
</span><span id="__span-4-63"><a href="#__codelineno-4-63" id="__codelineno-4-63" name="__codelineno-4-63"></a><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span>
</span><span id="__span-4-64"><a href="#__codelineno-4-64" id="__codelineno-4-64" name="__codelineno-4-64"></a><span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span>
</span><span id="__span-4-65"><a href="#__codelineno-4-65" id="__codelineno-4-65" name="__codelineno-4-65"></a><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span>
</span><span id="__span-4-66"><a href="#__codelineno-4-66" id="__codelineno-4-66" name="__codelineno-4-66"></a><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span><span id="__span-4-67"><a href="#__codelineno-4-67" id="__codelineno-4-67" name="__codelineno-4-67"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span>
</span><span id="__span-4-68"><a href="#__codelineno-4-68" id="__codelineno-4-68" name="__codelineno-4-68"></a><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">__MERGE_SOURCE__</span><span class="o">`</span>
</span><span id="__span-4-69"><a href="#__codelineno-4-69" id="__codelineno-4-69" name="__codelineno-4-69"></a><span class="k">ON</span><span class="w"> </span><span class="k">FALSE</span>
</span><span id="__span-4-70"><a href="#__codelineno-4-70" id="__codelineno-4-70" name="__codelineno-4-70"></a><span class="k">WHEN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">DELETE</span>
</span><span id="__span-4-71"><a href="#__codelineno-4-71" id="__codelineno-4-71" name="__codelineno-4-71"></a><span class="k">WHEN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span>
</span><span id="__span-4-72"><a href="#__codelineno-4-72" id="__codelineno-4-72" name="__codelineno-4-72"></a><span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-73"><a href="#__codelineno-4-73" id="__codelineno-4-73" name="__codelineno-4-73"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-74"><a href="#__codelineno-4-74" id="__codelineno-4-74" name="__codelineno-4-74"></a><span class="w">    </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-75"><a href="#__codelineno-4-75" id="__codelineno-4-75" name="__codelineno-4-75"></a><span class="w">    </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-76"><a href="#__codelineno-4-76" id="__codelineno-4-76" name="__codelineno-4-76"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-4-77"><a href="#__codelineno-4-77" id="__codelineno-4-77" name="__codelineno-4-77"></a><span class="w">  </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-78"><a href="#__codelineno-4-78" id="__codelineno-4-78" name="__codelineno-4-78"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-79"><a href="#__codelineno-4-79" id="__codelineno-4-79" name="__codelineno-4-79"></a><span class="w">    </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-80"><a href="#__codelineno-4-80" id="__codelineno-4-80" name="__codelineno-4-80"></a><span class="w">    </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-81"><a href="#__codelineno-4-81" id="__codelineno-4-81" name="__codelineno-4-81"></a><span class="w">  </span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer to pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">incrementals_demo</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incrementals_demo__50975949</span><span class="o">`</span>
</span></code></pre></div>
</details>
<div class="admonition info">
<p class="admonition-title">Important: Timezone Requirements</p>
<p>Your <code>time_column</code> should be in UTC timezone. This ensures Vulcan's scheduler and time macros work correctly.</p>
<p><strong>Why UTC?</strong> It's a data engineering best practice, convert everything to UTC when it enters your system, then convert to local timezones only when data leaves for end users. This prevents timezone-related bugs as data flows between models.</p>
<p><strong>Important:</strong> The <code>cron_tz</code> flag doesn't change this requirement, it only affects when your model runs, not how time intervals are calculated.</p>
<p>If you absolutely must use a different timezone, you can try to work around it using <code>lookback</code>, <code>allow_partials</code>, or cron offsets, but UTC is strongly recommended. Trust us on this one, timezone bugs are no fun!</p>
</div>
<p>This example implements a complete <code>INCREMENTAL_BY_TIME_RANGE</code> model that specifies the time column name <code>order_date</code> in the <code>MODEL</code> DDL and includes a SQL <code>WHERE</code> clause to filter records by time range:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"/><input id="__tabbed_1_2" name="__tabbed_1" type="radio"/><div class="tabbed-labels"><label for="__tabbed_1_1">SQL</label><label for="__tabbed_1_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">incremental_by_time_range</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">order_date</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2025-01-01'</span><span class="p">,</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">),</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="p">);</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="k">SELECT</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">product_name</span><span class="p">,</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_count</span><span class="p">,</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_quantity</span><span class="p">,</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">unit_price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_sales_amount</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">order_items</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">oi</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="k">WHERE</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">category</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="n">model</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelKindName</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="nd">@model</span><span class="p">(</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span class="s2">"vulcan_demo.incremental_by_time_range_py"</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a>    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a>        <span class="s2">"order_date"</span><span class="p">:</span> <span class="s2">"date"</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a>        <span class="s2">"product_id"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a>        <span class="s2">"product_name"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a>        <span class="s2">"total_sales_amount"</span><span class="p">:</span> <span class="s2">"decimal(10,2)"</span><span class="p">,</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a>    <span class="p">},</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a>    <span class="n">kind</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13"></a>        <span class="n">name</span><span class="o">=</span><span class="n">ModelKindName</span><span class="o">.</span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="p">,</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14"></a>        <span class="n">time_column</span><span class="o">=</span><span class="s2">"order_date"</span><span class="p">,</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15"></a>    <span class="p">),</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16"></a>    <span class="n">grains</span><span class="o">=</span><span class="p">[</span><span class="s2">"order_date"</span><span class="p">,</span> <span class="s2">"product_id"</span><span class="p">],</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17"></a>    <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">"vulcan_demo.orders"</span><span class="p">,</span> <span class="s2">"vulcan_demo.order_items"</span><span class="p">,</span> <span class="s2">"vulcan_demo.products"</span><span class="p">],</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="p">)</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20"></a>    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="s2">    SELECT o.order_date, p.product_id, p.name AS product_name,</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="s2">           SUM(oi.quantity * oi.unit_price) AS total_sales_amount</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="s2">    FROM vulcan_demo.orders o</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="s2">    JOIN vulcan_demo.order_items oi ON o.order_id = oi.order_id</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="s2">    JOIN vulcan_demo.products p ON oi.product_id = p.product_id</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="s2">    WHERE o.order_date BETWEEN '</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">' AND '</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">'</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="s2">    GROUP BY o.order_date, p.product_id, p.name</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="s2">    """</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29"></a>    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
</div>
</div>
<h3 id="time-column">Time Column<a class="headerlink" href="#time-column" title="Link to this section">¶</a></h3>
<p>Vulcan needs to know which column in your model's output represents the timestamp or date for each record. This is your <code>time_column</code>.</p>
<div class="admonition info">
<p class="admonition-title">Remember: UTC Timezone</p>
<p>Your <code>time_column</code> should be in UTC timezone. Learn more about why this matters <a href="#timezones">above</a>.</p>
</div>
<p>The time column is used to determine which records will be overwritten during data <a href="../../../guides/plan/#restatement-plans">restatement</a> and provides a partition key for engines that support partitioning (such as Apache Spark). The name of the time column is specified in the <code>MODEL</code> DDL <code>kind</code> specification:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">daily_sales</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="c1">-- This model's time information is stored in the `order_date` column</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>By default, Vulcan assumes your time column is in <code>%Y-%m-%d</code> format (like <code>2025-01-15</code>). If your dates are in a different format, you can specify it:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">daily_sales</span><span class="p">,</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="p">(</span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="s1">'%Y-%m-%d'</span><span class="p">)</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<div class="admonition note">
<p class="admonition-title">Format String Dialect</p>
<p>Use the same SQL dialect for your format string as the one used in your model's query.</p>
</div>
<p><strong>Safety feature:</strong> Vulcan automatically adds a time range filter to your query's output to prevent data leakage. This means even if your <code>WHERE</code> clause has a bug, Vulcan won't accidentally store records outside the target interval.</p>
<p>Here's how it works:</p>
<ul>
<li>
<p><strong>Your WHERE clause</strong> filters the <strong>input</strong> data as it's read from upstream tables (makes queries faster)</p>
</li>
<li>
<p><strong>Vulcan's automatic filter</strong> filters the <strong>output</strong> data before it's stored (prevents data leakage)</p>
</li>
</ul>
<p>This is especially important when handling late-arriving data, you don't want to accidentally overwrite unrelated records!</p>
<p>Example: sometimes your upstream data uses a different time column than your model. In this case, you filter on the upstream column (<code>shipped_date</code>), but Vulcan still adds a filter on your model's time column (<code>order_date</code>):</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">shipment_events</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="c1">-- `order_date` is model's time column</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="p">);</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="k">SELECT</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">shipped_date</span><span class="p">,</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">carrier</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">shipments</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="k">WHERE</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">shipped_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Filter is based on the user-supplied `shipped_date` column</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>At runtime, Vulcan will automatically modify the model's query to look like this:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span>
<span class="normal"><a href="#__codelineno-12-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">SELECT</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">shipped_date</span><span class="p">,</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">carrier</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">shipments</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="k">WHERE</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">shipped_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span><span class="p">;</span><span class="w"> </span><span class="c1">-- `order_date` time column filter automatically added by Vulcan</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h3 id="partitioning">Partitioning<a class="headerlink" href="#partitioning" title="Link to this section">¶</a></h3>
<p>By default, Vulcan automatically adds your <code>time_column</code> to the partition key. This lets database engines do partition pruning (skipping partitions that don't match your query), which makes queries faster.</p>
<p><strong>Why this matters:</strong> If you're querying data from the last 7 days, the engine can skip scanning all the old partitions. That's a huge performance win!</p>
<p>Sometimes you might not want this though, maybe you want to partition exclusively on another column, or you want to partition on <code>month(time_column)</code> but your engine doesn't support expression-based partitioning.</p>
<p>To disable automatic time column partitioning, set <code>partition_by_time_column false</code>:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">daily_sales</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="n">partition_by_time_column</span><span class="w"> </span><span class="k">false</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="p">(</span><span class="n">warehouse_id</span><span class="p">)</span><span class="w"> </span><span class="c1">-- order_date will no longer be automatically added here and the partition key will just be 'warehouse_id'</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h3 id="idempotency">Idempotency<a class="headerlink" href="#idempotency" title="Link to this section">¶</a></h3>
<p>Make incremental by time range model queries <a href="../../../references/glossary/#idempotency">idempotent</a> to prevent unexpected results during data <a href="../../../guides/plan/#restatement-plans">restatement</a>.</p>
<p>Make your incremental by time range queries idempotent. This means running the same query multiple times produces the same result, which prevents surprises during data restatement.</p>
<p><strong>Watch out:</strong> Your upstream models can affect idempotency. If you reference a FULL model (which rebuilds everything each run), your incremental model becomes non-idempotent because that upstream data changes every time. This is usually fine, but it's good to be aware of.</p>
<h3 id="materialization-strategy">Materialization strategy<a class="headerlink" href="#materialization-strategy" title="Link to this section">¶</a></h3>
<p>Depending on the target engine, models of the <code>INCREMENTAL_BY_TIME_RANGE</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spark</td>
<td>INSERT OVERWRITE by time column partition</td>
</tr>
<tr>
<td>Databricks</td>
<td>INSERT OVERWRITE by time column partition</td>
</tr>
<tr>
<td>Snowflake</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>BigQuery</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>Redshift</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>Postgres</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>DuckDB</td>
<td>DELETE by time range, then INSERT</td>
</tr>
</tbody>
</table>
<h2 id="incremental_by_unique_key">INCREMENTAL_BY_UNIQUE_KEY<a class="headerlink" href="#incremental_by_unique_key" title="Link to this section">¶</a></h2>
<p><code>INCREMENTAL_BY_UNIQUE_KEY</code> models update data based on a unique key. It works like an upsert operation: if a key exists, update it; if it doesn't, insert it.</p>
<p>Here's how it works:</p>
<ul>
<li>
<p><strong>New key?</strong> → Insert the row</p>
</li>
<li>
<p><strong>Existing key?</strong> → Update the row with new data</p>
</li>
<li>
<p><strong>Key missing from new data?</strong> → Leave the existing row alone</p>
</li>
</ul>
<p><strong>Why use this?</strong> Perfect for dimension tables, customer records, or any data where you want to keep the latest version of each record without rebuilding everything. It's like updating a contact list, you update existing contacts and add new ones, but you don't delete contacts that aren't in your latest import.</p>
<p>This kind is a good fit for datasets that have the following traits:</p>
<ul>
<li>Each record has a unique key associated with it.</li>
<li>There is at most one record associated with each unique key.</li>
<li>It is appropriate to upsert records, so existing records can be overwritten by new arrivals when their keys match.</li>
</ul>
<p>A <a href="../../../references/glossary/#slowly-changing-dimension-scd">Slowly Changing Dimension</a> (SCD) is one approach that fits this description well. See the <a href="#scd-type-2">SCD Type 2</a> model kind for SCD Type 2 models.</p>
<p>The name of the unique key column must be provided as part of the <code>MODEL</code> DDL, as in this example:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"/><input id="__tabbed_2_2" name="__tabbed_2" type="radio"/><div class="tabbed-labels"><label for="__tabbed_2_1">SQL</label><label for="__tabbed_2_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">incremental_by_unique_key</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">customer_id</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2025-01-01'</span><span class="p">,</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="p">);</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="k">SELECT</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_orders</span><span class="p">,</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">unit_price</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_spent</span><span class="p">,</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">  </span><span class="k">MAX</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">last_order_date</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">order_items</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">oi</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23"></a><span class="k">WHERE</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_date</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_date</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">email</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="n">model</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelKindName</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="nd">@model</span><span class="p">(</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="s2">"vulcan_demo.incremental_by_unique_key_py"</span><span class="p">,</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a>        <span class="s2">"customer_id"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a>        <span class="s2">"total_spent"</span><span class="p">:</span> <span class="s2">"decimal(10,2)"</span><span class="p">,</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9"></a>        <span class="s2">"last_order_date"</span><span class="p">:</span> <span class="s2">"date"</span><span class="p">,</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10"></a>    <span class="p">},</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11"></a>    <span class="n">kind</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12"></a>        <span class="n">name</span><span class="o">=</span><span class="n">ModelKindName</span><span class="o">.</span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="p">,</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13"></a>        <span class="n">unique_key</span><span class="o">=</span><span class="p">[</span><span class="s2">"customer_id"</span><span class="p">],</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14"></a>    <span class="p">),</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15"></a>    <span class="n">grains</span><span class="o">=</span><span class="p">[</span><span class="s2">"customer_id"</span><span class="p">],</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16"></a>    <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">"vulcan_demo.customers"</span><span class="p">,</span> <span class="s2">"vulcan_demo.orders"</span><span class="p">,</span> <span class="s2">"vulcan_demo.order_items"</span><span class="p">],</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="p">)</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="s2">    SELECT c.customer_id,</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="s2">           SUM(oi.quantity * oi.unit_price) as total_spent,</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="s2">           MAX(o.order_date) as last_order_date</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="s2">    FROM vulcan_demo.customers c</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="s2">    LEFT JOIN vulcan_demo.orders o ON c.customer_id = o.customer_id</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="s2">    LEFT JOIN vulcan_demo.order_items oi ON o.order_id = oi.order_id</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="s2">    GROUP BY c.customer_id</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="s2">    """</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28"></a>    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
</div>
</div>
<p>You can use composite keys (multiple columns) too:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">order_items_agg</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>You can also filter upstream records by time range using <code>@start_date</code>, <code>@end_date</code>, or other time macros (just like <code>INCREMENTAL_BY_TIME_RANGE</code>). This is useful when you only want to process records from a specific time period.</p>
<p><strong>Note:</strong> Vulcan's time macros are always in UTC timezone.</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span>
<span class="normal"><a href="#__codelineno-17-7">7</a></span>
<span class="normal"><a href="#__codelineno-17-8">8</a></span>
<span class="normal"><a href="#__codelineno-17-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">SELECT</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_orders</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="k">WHERE</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_date</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_date</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span>
</span></code></pre></div></td></tr></tbody></table></div>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_by_unique_key_example</span><span class="p">,</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2020-01-01'</span><span class="p">,</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="p">);</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="k">SELECT</span>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">  </span><span class="n">item_id</span><span class="p">,</span>
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">  </span><span class="n">event_date</span>
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="k">FROM</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">seed_model</span>
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="k">WHERE</span>
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">  </span><span class="n">event_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_date</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_date</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>1161945221</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_by_unique_key_example__1161945221</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will validate the model's query before processing data (note the <code>FALSE LIMIT 0</code> in the <code>WHERE</code> statement and the placeholder dates).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_model__2834544882</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">FALSE</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p>Vulcan will create a versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_by_unique_key_example__1161945221</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_model__2834544882</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-30'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2020-01-01'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">incremental_by_unique_key_example</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_by_unique_key_example__1161945221</span><span class="o">`</span>
</span></code></pre></div>
</details>
<p><strong>Note:</strong> Models of the <code>INCREMENTAL_BY_UNIQUE_KEY</code> kind are inherently <a href="../../../references/glossary/#idempotency">non-idempotent</a>, which should be taken into consideration during data <a href="../../../guides/plan/#restatement-plans">restatement</a>. As a result, partial data restatement is not supported for this model kind, which means that the entire table will be recreated from scratch if restated.</p>
<h3 id="unique-key-expressions">Unique Key Expressions<a class="headerlink" href="#unique-key-expressions" title="Link to this section">¶</a></h3>
<p>You're not limited to column names. You can use SQL expressions when you need to create a key from multiple columns or transform values. Example using <code>COALESCE</code>:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span>
<span class="normal"><a href="#__codelineno-24-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">customers_unique</span><span class="p">,</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="ss">"email"</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h3 id="when-matched-expression">When Matched Expression<a class="headerlink" href="#when-matched-expression" title="Link to this section">¶</a></h3>
<p>By default, when a key matches (source and target have the same key), Vulcan updates all columns. But sometimes you want more control, maybe you want to preserve certain values, or only update specific columns.</p>
<p>You can customize this behavior with <code>when_matched</code> expressions:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span>
<span class="normal"><a href="#__codelineno-25-8">8</a></span>
<span class="normal"><a href="#__codelineno-25-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">customers_update</span><span class="p">,</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="n">when_matched</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">source</span><span class="p">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">email</span><span class="p">)</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p><strong>Important:</strong> You must use <code>source</code> and <code>target</code> aliases to distinguish between the source (new data) and target (existing table) columns.</p>
<p>You can also provide multiple <code>WHEN MATCHED</code> expressions for more complex logic:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">products_update</span><span class="p">,</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">    </span><span class="n">when_matched</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">source</span><span class="p">.</span><span class="n">price</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">price</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">source</span><span class="p">.</span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">category</span><span class="p">)</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<div class="admonition note">
<p class="admonition-title">Engine Support</p>
<p><code>when_matched</code> only works on engines that support the <code>MERGE</code> statement. Supported engines include:</p>
<ul>
<li>
<p>BigQuery</p>
</li>
<li>
<p>Databricks</p>
</li>
<li>
<p>Postgres</p>
</li>
<li>
<p>Redshift (requires <code>enable_merge: true</code> in connection config)</p>
</li>
<li>
<p>Snowflake</p>
</li>
<li>
<p>Spark</p>
</li>
</ul>
<p><strong>Redshift users:</strong> You need to enable MERGE support by setting <code>enable_merge: true</code> in your connection config. It's disabled by default.</p>
</div>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="nt">gateways</span><span class="p">:</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">  </span><span class="nt">redshift</span><span class="p">:</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="nt">connection</span><span class="p">:</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redshift</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">      </span><span class="nt">enable_merge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Redshift supports only the <code>UPDATE</code> or <code>DELETE</code> actions for the <code>WHEN MATCHED</code> clause and does not allow multiple <code>WHEN MATCHED</code> expressions. For further information, refer to the <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_MERGE.html#r_MERGE-parameters">Redshift documentation</a>.</p>
<h3 id="merge-filter-expression">Merge Filter Expression<a class="headerlink" href="#merge-filter-expression" title="Link to this section">¶</a></h3>
<p>MERGE operations can be slow on large tables because they typically scan the entire existing table. If you're only updating a small subset of records, this is wasteful.</p>
<p><strong>Solution:</strong> Use <code>merge_filter</code> to add conditions to the MERGE's <code>ON</code> clause. This limits the scan to only the rows that might match, making things much faster.</p>
<p>The <code>merge_filter</code> accepts predicates (single or combined with AND) that get added to the MERGE operation:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders_recent</span><span class="p">,</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="n">merge_filter</span><span class="w"> </span><span class="k">source</span><span class="p">.</span><span class="n">_operation</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dateadd</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="k">current_date</span><span class="p">)</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Just like <code>when_matched</code>, use <code>source</code> and <code>target</code> aliases to reference the source and target tables.</p>
<p>If your dbt project uses <code>incremental_predicates</code>, Vulcan automatically converts them to <code>merge_filter</code>.</p>
<h3 id="materialization-strategy_1">Materialization strategy<a class="headerlink" href="#materialization-strategy_1" title="Link to this section">¶</a></h3>
<p>Depending on the target engine, models of the <code>INCREMENTAL_BY_UNIQUE_KEY</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spark</td>
<td>not supported</td>
</tr>
<tr>
<td>Databricks</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>Snowflake</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>BigQuery</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>Redshift</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>Postgres</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>DuckDB</td>
<td>DELETE ON matched + INSERT new rows</td>
</tr>
</tbody>
</table>
<h2 id="full">FULL<a class="headerlink" href="#full" title="Link to this section">¶</a></h2>
<p><code>FULL</code> models are the simplest kind, they rebuild everything from scratch every time they run. No incremental logic, no time columns, no unique keys. Just run the query and replace the entire table.</p>
<p><strong>When to use FULL:</strong></p>
<ul>
<li>
<p>Small datasets where rebuilding is fast and cheap</p>
</li>
<li>
<p>Aggregate tables without a time dimension</p>
</li>
<li>
<p>Tables that change completely each run (like a "current state" snapshot)</p>
</li>
<li>
<p>Development and testing (simpler is better when you're iterating)</p>
</li>
</ul>
<p><strong>When NOT to use FULL:</strong></p>
<ul>
<li>
<p>Large datasets (you'll wait forever and pay a lot)</p>
</li>
<li>
<p>Time-series data (use <code>INCREMENTAL_BY_TIME_RANGE</code> instead)</p>
</li>
<li>
<p>Tables that only change partially (use incremental kinds)</p>
</li>
</ul>
<p>The trade-off is simplicity vs. performance. For small tables, FULL is perfect. For large tables, incremental kinds will save you time and money.</p>
<p>This example specifies a <code>FULL</code> model kind:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"/><input id="__tabbed_3_2" name="__tabbed_3" type="radio"/><div class="tabbed-labels"><label for="__tabbed_3_1">SQL</label><label for="__tabbed_3_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span>
<span class="normal"><a href="#__codelineno-29-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">full_model</span><span class="p">,</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">FULL</span><span class="p">,</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2025-01-01'</span><span class="p">,</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="p">);</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="k">SELECT</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_orders</span><span class="p">,</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">unit_price</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_spent</span><span class="p">,</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">unit_price</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">NULLIF</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_order_value</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">order_items</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">oi</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">email</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_spent</span><span class="w"> </span><span class="k">DESC</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span>
<span class="normal"><a href="#__codelineno-30-23">23</a></span>
<span class="normal"><a href="#__codelineno-30-24">24</a></span>
<span class="normal"><a href="#__codelineno-30-25">25</a></span>
<span class="normal"><a href="#__codelineno-30-26">26</a></span>
<span class="normal"><a href="#__codelineno-30-27">27</a></span>
<span class="normal"><a href="#__codelineno-30-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="n">model</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelKindName</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="nd">@model</span><span class="p">(</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a>    <span class="s2">"vulcan_demo.full_model_py"</span><span class="p">,</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a>    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a>        <span class="s2">"product_id"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a>        <span class="s2">"product_name"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9"></a>        <span class="s2">"category"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10"></a>        <span class="s2">"total_sales"</span><span class="p">:</span> <span class="s2">"decimal(10,2)"</span><span class="p">,</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11"></a>    <span class="p">},</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12"></a>    <span class="n">kind</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13"></a>        <span class="n">name</span><span class="o">=</span><span class="n">ModelKindName</span><span class="o">.</span><span class="n">FULL</span><span class="p">,</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14"></a>    <span class="p">),</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15"></a>    <span class="n">grains</span><span class="o">=</span><span class="p">[</span><span class="s2">"product_id"</span><span class="p">],</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16"></a>    <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">"vulcan_demo.products"</span><span class="p">,</span> <span class="s2">"vulcan_demo.order_items"</span><span class="p">,</span> <span class="s2">"vulcan_demo.orders"</span><span class="p">],</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="p">)</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="s2">    SELECT p.product_id, p.name AS product_name, p.category,</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="s2">           COALESCE(SUM(oi.quantity * oi.unit_price), 0) as total_sales</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="s2">    FROM vulcan_demo.products p</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23"></a><span class="s2">    LEFT JOIN vulcan_demo.order_items oi ON p.product_id = oi.product_id</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24"></a><span class="s2">    LEFT JOIN vulcan_demo.orders o ON oi.order_id = o.order_id</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25"></a><span class="s2">    GROUP BY p.product_id, p.name, p.category</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26"></a><span class="s2">    ORDER BY total_sales DESC</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27"></a><span class="s2">    """</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28"></a>    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
</div>
</div>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">full_model_example</span><span class="p">,</span>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">FULL</span><span class="p">,</span>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">  </span><span class="n">grain</span><span class="w"> </span><span class="n">item_id</span><span class="p">,</span>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="p">);</span>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a>
</span><span id="__span-31-8"><a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="k">SELECT</span>
</span><span id="__span-31-9"><a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">  </span><span class="n">item_id</span><span class="p">,</span>
</span><span id="__span-31-10"><a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_orders</span>
</span><span id="__span-31-11"><a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="k">FROM</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_model</span>
</span><span id="__span-31-12"><a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
</span><span id="__span-31-13"><a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">  </span><span class="n">item_id</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>2345651858</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__full_model_example__2345651858</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will validate the model's query before processing data (note the <code>WHERE FALSE</code> and <code>LIMIT 0</code>).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_model__89556012</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">FALSE</span>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p>Vulcan will create a versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__full_model_example__2345651858</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_model__89556012</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">full_model_example</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-36-2"><a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__full_model_example__2345651858</span><span class="o">`</span>
</span></code></pre></div>
</details>
<h3 id="materialization-strategy_2">Materialization strategy<a class="headerlink" href="#materialization-strategy_2" title="Link to this section">¶</a></h3>
<p>Depending on the target engine, models of the <code>FULL</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spark</td>
<td>INSERT OVERWRITE</td>
</tr>
<tr>
<td>Databricks</td>
<td>INSERT OVERWRITE</td>
</tr>
<tr>
<td>Snowflake</td>
<td>CREATE OR REPLACE TABLE</td>
</tr>
<tr>
<td>BigQuery</td>
<td>CREATE OR REPLACE TABLE</td>
</tr>
<tr>
<td>Redshift</td>
<td>DROP TABLE, CREATE TABLE, INSERT</td>
</tr>
<tr>
<td>Postgres</td>
<td>DROP TABLE, CREATE TABLE, INSERT</td>
</tr>
<tr>
<td>DuckDB</td>
<td>CREATE OR REPLACE TABLE</td>
</tr>
</tbody>
</table>
<h2 id="view">VIEW<a class="headerlink" href="#view" title="Link to this section">¶</a></h2>
<p>Unlike the other kinds, <code>VIEW</code> models don't store any data. Instead, they create a virtual table (a view) that runs your query every time someone queries it.</p>
<p><strong>How it works:</strong> When a downstream model or user queries your VIEW model, the database executes your query on-the-fly. No data is pre-computed or stored.</p>
<p><strong>When to use VIEW:</strong></p>
<ul>
<li>
<p>Simple transformations that are fast to compute</p>
</li>
<li>
<p>When you want always-fresh data (no caching)</p>
</li>
<li>
<p>When storage is expensive but compute is cheap</p>
</li>
<li>
<p>For lightweight transformations that don't need materialization</p>
</li>
</ul>
<p><strong>When NOT to use VIEW:</strong></p>
<ul>
<li>
<p>Expensive queries that run frequently (you'll pay the compute cost every time)</p>
</li>
<li>
<p>Complex aggregations or joins (materialize these instead)</p>
</li>
<li>
<p>Python models (VIEW isn't supported for Python, use SQL)</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Default Kind</p>
<p><code>VIEW</code> is the default model kind if you don't specify one. So if you write a model without a <code>kind</code>, it becomes a VIEW automatically.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Performance Consideration</p>
<p>Since VIEW queries run every time they're referenced, expensive queries can get costly fast. If your view is referenced by many downstream models, you might be running that expensive query dozens of times. Consider materializing expensive views as FULL or incremental models instead.</p>
</div>
<p>This example specifies a <code>VIEW</code> model kind:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">view_model</span><span class="p">,</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">VIEW</span><span class="p">,</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">warehouse_performance_key</span><span class="p">)</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="p">);</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6"></a>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="k">SELECT</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">  </span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span><span class="p">,</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">  </span><span class="n">w</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">warehouse_name</span><span class="p">,</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">  </span><span class="n">r</span><span class="p">.</span><span class="n">region_name</span><span class="p">,</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">  </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span><span class="p">::</span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">::</span><span class="nb">TEXT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">warehouse_performance_key</span><span class="p">,</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_transactions</span><span class="p">,</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">unit_price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_sales_amount</span><span class="p">,</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">unique_customers</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">warehouses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">w</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">regions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">region_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">region_id</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">warehouse_id</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">order_items</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">oi</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">region_name</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span>
</span></code></pre></div></td></tr></tbody></table></div>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-38-1"><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-38-2"><a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">example_view</span><span class="p">,</span>
</span><span id="__span-38-3"><a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">VIEW</span><span class="p">,</span>
</span><span id="__span-38-4"><a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-38-5"><a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="p">);</span>
</span><span id="__span-38-6"><a href="#__codelineno-38-6" id="__codelineno-38-6" name="__codelineno-38-6"></a>
</span><span id="__span-38-7"><a href="#__codelineno-38-7" id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="k">SELECT</span>
</span><span id="__span-38-8"><a href="#__codelineno-38-8" id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="w">  </span><span class="s1">'hello there'</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a_column</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned view in the physical layer. Note that the view's version fingerprint, <code>1024042926</code>, is part of the view name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-39-1"><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__example_view__1024042926</span><span class="o">`</span>
</span><span id="__span-39-2"><a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="p">(</span><span class="o">`</span><span class="n">a_column</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">'hello there'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">a_column</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-40-1"><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned view in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-41-1"><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">example_view</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-41-2"><a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__example_view__1024042926</span><span class="o">`</span>
</span></code></pre></div>
</details>
<h3 id="materialized-views">Materialized Views<a class="headerlink" href="#materialized-views" title="Link to this section">¶</a></h3>
<p>Want the best of both worlds? You can turn a VIEW into a materialized view by setting <code>materialized: true</code>. Materialized views store the query results (like a table) but automatically refresh when the underlying data changes (like a view).</p>
<p>Set it up like this:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span>
<span class="normal"><a href="#__codelineno-42-5">5</a></span>
<span class="normal"><a href="#__codelineno-42-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">sales_summary</span><span class="p">,</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">    </span><span class="n">materialized</span><span class="w"> </span><span class="k">true</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<div class="admonition note">
<p class="admonition-title">Engine Support</p>
<p>Materialized views are only supported on:</p>
<ul>
<li>
<p>BigQuery</p>
</li>
<li>
<p>Databricks</p>
</li>
<li>
<p>Snowflake</p>
</li>
</ul>
<p>On other engines, this flag is ignored and you'll get a regular VIEW.</p>
</div>
<p>Vulcan only recreates the materialized view when your query changes or the view doesn't exist. This provides the performance benefits of materialized views without unnecessary refreshes.</p>
<h2 id="embedded">EMBEDDED<a class="headerlink" href="#embedded" title="Link to this section">¶</a></h2>
<p><code>EMBEDDED</code> models are like reusable SQL snippets. They don't create tables or views, instead, their query gets injected directly into any downstream model that references them, as a subquery.</p>
<p><strong>Why use this?</strong> If you have common logic that multiple models need (like a CTE that filters active customers), you can define it once in an EMBEDDED model and reuse it everywhere. It's like a macro, but for SQL.</p>
<p><strong>Perfect for:</strong></p>
<ul>
<li>
<p>Common CTEs used across multiple models</p>
</li>
<li>
<p>Reusable business logic (like "active customers" or "valid orders")</p>
</li>
<li>
<p>Avoiding code duplication</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Python Models</p>
<p>Python models don't support the <code>EMBEDDED</code> kind, use a SQL model instead.</p>
</div>
<p>This example specifies an <code>EMBEDDED</code> model kind:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">unique_customers</span><span class="p">,</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">EMBEDDED</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="p">);</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5"></a>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="w">  </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">  </span><span class="n">email</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">customers</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h2 id="seed">SEED<a class="headerlink" href="#seed" title="Link to this section">¶</a></h2>
<p>The <code>SEED</code> model kind is used to specify seed models for using static CSV datasets in your Vulcan project.</p>
<p><strong>How it works:</strong> You point to a CSV file, define the schema, and Vulcan loads it into a table. The data only gets reloaded if you change the model definition or update the CSV file.</p>
<p><strong>Use cases:</strong></p>
<ul>
<li>
<p>Reference data (countries, states, categories)</p>
</li>
<li>
<p>Lookup tables</p>
</li>
<li>
<p>Static configuration data</p>
</li>
<li>
<p>Test data</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Python Models</p>
<p>Python models don't support the <code>SEED</code> kind, use a SQL model instead.</p>
</div>
<div class="admonition note">
<p class="admonition-title">When Data Reloads</p>
<p>Seed models are loaded once and stay loaded unless you update the model definition or change the CSV file. This keeps things efficient, no point reloading static data every run!</p>
</div>
<p>This example specifies a <code>SEED</code> model kind:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">seed_model</span><span class="p">,</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SEED</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">    </span><span class="n">path</span><span class="w"> </span><span class="s1">'../seeds/seed_data.csv'</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">  </span><span class="n">columns</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="w">    </span><span class="n">item_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">    </span><span class="n">event_date</span><span class="w"> </span><span class="nb">DATE</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="w">  </span><span class="n">assertions</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="w">    </span><span class="n">UNIQUE_COMBINATION_OF_COLUMNS</span><span class="p">(</span><span class="n">columns</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">event_date</span><span class="p">)),</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="w">    </span><span class="n">NOT_NULL</span><span class="p">(</span><span class="n">columns</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">item_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_date</span><span class="p">))</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16"></a><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-45-1"><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-45-2"><a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">seed_example</span><span class="p">,</span>
</span><span id="__span-45-3"><a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SEED</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-45-4"><a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">    </span><span class="n">path</span><span class="w"> </span><span class="s1">'../../seeds/seed_example.csv'</span>
</span><span id="__span-45-5"><a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-45-6"><a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="w">  </span><span class="n">columns</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-45-7"><a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span>
</span><span id="__span-45-8"><a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="w">    </span><span class="n">item_id</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span>
</span><span id="__span-45-9"><a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="w">    </span><span class="n">event_date</span><span class="w"> </span><span class="nb">DATE</span>
</span><span id="__span-45-10"><a href="#__codelineno-45-10" id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-45-11"><a href="#__codelineno-45-11" id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="w">  </span><span class="n">grain</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">event_date</span><span class="p">)</span>
</span><span id="__span-45-12"><a href="#__codelineno-45-12" id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>3038173937</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-46-1"><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_example__3038173937</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will upload the seed as a temp table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-47-1"><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">vulcan__demo</span><span class="p">.</span><span class="n">__temp_demo__seed_example__3038173937_9kzbpld7</span>
</span></code></pre></div>
<p>Vulcan will create a versioned table in the physical layer from the temp table.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-48-1"><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_example__3038173937</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-48-2"><a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-48-3"><a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-48-4"><a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">__temp_demo__seed_example__3038173937_9kzbpld7</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will drop the temp table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-49-1"><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">__temp_demo__seed_example__3038173937_9kzbpld7</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-50-1"><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-51-1"><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">seed_example</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-51-2"><a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_example__3038173937</span><span class="o">`</span>
</span></code></pre></div>
</details>
<h2 id="scd-type-2">SCD Type 2<a class="headerlink" href="#scd-type-2" title="Link to this section">¶</a></h2>
<p>SCD Type 2 is a model kind that supports <a href="https://en.wikipedia.org/wiki/Slowly_changing_dimension#Type_2:_add_new_row">slowly changing dimensions</a> (SCDs) in your Vulcan project. SCDs are a common pattern in data warehousing that allow you to track changes to records over time.</p>
<p>Vulcan achieves this by adding a <code>valid_from</code> and <code>valid_to</code> column to your model. The <code>valid_from</code> column is the timestamp that the record became valid (inclusive) and the <code>valid_to</code> column is the timestamp that the record became invalid (exclusive). The <code>valid_to</code> column is set to <code>NULL</code> for the latest record.</p>
<p>Therefore, you can use these models to not only tell you what the latest value is for a given record but also what the values were anytime in the past. Note that maintaining this history does come at a cost of increased storage and compute and this may not be a good fit for sources that change frequently since the history could get very large.</p>
<p><strong>Note</strong>: Partial data <a href="../../../guides/plan/#restatement-plans">restatement</a> is not supported for this model kind, which means that the entire table will be recreated from scratch if restated. This may lead to data loss, so data restatement is disabled for models of this kind by default.</p>
<p>Vulcan supports two ways to detect changes: <strong>By Time</strong> (recommended) or <strong>By Column</strong>. Let's look at both:</p>
<h3 id="scd-type-2-by-time-recommended">SCD Type 2 By Time (Recommended)<a class="headerlink" href="#scd-type-2-by-time-recommended" title="Link to this section">¶</a></h3>
<p><strong>By Time</strong> is the recommended approach. It works with source tables that have an "Updated At" timestamp column (like <code>updated_at</code>, <code>modified_at</code>, <code>last_changed</code>).</p>
<p><strong>Why it's recommended:</strong> The timestamp tells you exactly when a record changed, which makes your SCD Type 2 table more accurate. You get precise <code>valid_from</code> times based on when the source system actually updated the record.</p>
<p>If your source table has an <code>updated_at</code> column, use this approach!</p>
<p>This example specifies a <code>SCD_TYPE_2_BY_TIME</code> model kind:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio"/><input id="__tabbed_4_2" name="__tabbed_4" type="radio"/><div class="tabbed-labels"><label for="__tabbed_4_1">SQL</label><label for="__tabbed_4_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span>
<span class="normal"><a href="#__codelineno-52-15">15</a></span>
<span class="normal"><a href="#__codelineno-52-16">16</a></span>
<span class="normal"><a href="#__codelineno-52-17">17</a></span>
<span class="normal"><a href="#__codelineno-52-18">18</a></span>
<span class="normal"><a href="#__codelineno-52-19">19</a></span>
<span class="normal"><a href="#__codelineno-52-20">20</a></span>
<span class="normal"><a href="#__codelineno-52-21">21</a></span>
<span class="normal"><a href="#__codelineno-52-22">22</a></span>
<span class="normal"><a href="#__codelineno-52-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">scd_type2_by_time</span><span class="p">,</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">dt</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="p">);</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8"></a>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="k">SELECT</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10"></a><span class="w">  </span><span class="n">dd</span><span class="p">.</span><span class="n">dt</span><span class="p">,</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="w">  </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="p">,</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="w">  </span><span class="n">dd</span><span class="p">.</span><span class="k">month</span><span class="p">,</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13"></a><span class="w">  </span><span class="n">dd</span><span class="p">.</span><span class="n">day_of_week</span><span class="p">,</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_transactions</span><span class="p">,</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15"></a><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_quantity_sold</span><span class="p">,</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16"></a><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">unit_price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_sales_amount</span><span class="p">,</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17"></a><span class="w">  </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">updated_at</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">dim_dates</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dd</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">order_items</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">oi</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="n">day_of_week</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span>
<span class="normal"><a href="#__codelineno-53-20">20</a></span>
<span class="normal"><a href="#__codelineno-53-21">21</a></span>
<span class="normal"><a href="#__codelineno-53-22">22</a></span>
<span class="normal"><a href="#__codelineno-53-23">23</a></span>
<span class="normal"><a href="#__codelineno-53-24">24</a></span>
<span class="normal"><a href="#__codelineno-53-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="n">model</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelKindName</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3"></a>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="nd">@model</span><span class="p">(</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5"></a>    <span class="s2">"vulcan_demo.scd_type2_by_time_py"</span><span class="p">,</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6"></a>    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7"></a>        <span class="s2">"customer_id"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8"></a>        <span class="s2">"customer_name"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9"></a>        <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10"></a>        <span class="s2">"region_name"</span><span class="p">:</span> <span class="s2">"string"</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11"></a>    <span class="p">},</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12"></a>    <span class="n">kind</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13"></a>        <span class="n">name</span><span class="o">=</span><span class="n">ModelKindName</span><span class="o">.</span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="p">,</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14"></a>        <span class="n">unique_key</span><span class="o">=</span><span class="p">[</span><span class="s2">"customer_id"</span><span class="p">],</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15"></a>    <span class="p">),</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16"></a>    <span class="n">grains</span><span class="o">=</span><span class="p">[</span><span class="s2">"customer_id"</span><span class="p">],</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17"></a>    <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">"vulcan_demo.customers"</span><span class="p">,</span> <span class="s2">"vulcan_demo.regions"</span><span class="p">],</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18"></a><span class="p">)</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21"></a><span class="s2">    SELECT c.customer_id, c.name as customer_name, c.email, r.region_name</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22"></a><span class="s2">    FROM vulcan_demo.customers c</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23"></a><span class="s2">    LEFT JOIN vulcan_demo.regions r ON c.region_id = r.region_id</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24"></a><span class="s2">    """</span>
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25"></a>    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
</div>
</div>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span>
<span class="normal"><a href="#__codelineno-54-5">5</a></span>
<span class="normal"><a href="#__codelineno-54-6">6</a></span>
<span class="normal"><a href="#__codelineno-54-7">7</a></span>
<span class="normal"><a href="#__codelineno-54-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>The <code>updated_at</code> column name can also be changed by adding the following to your model definition:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span>
<span class="normal"><a href="#__codelineno-55-14">14</a></span>
<span class="normal"><a href="#__codelineno-55-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="hll"><span class="w">    </span><span class="n">updated_at_name</span><span class="w"> </span><span class="n">my_updated_at</span><span class="w"> </span><span class="c1">-- Name for `updated_at` column</span>
</span></span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="p">);</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="k">SELECT</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="w">  </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="w">  </span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="w">  </span><span class="n">my_updated_at</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14"></a><span class="k">FROM</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="w">  </span><span class="n">stg</span><span class="p">.</span><span class="n">current_menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span>
<span class="normal"><a href="#__codelineno-56-3">3</a></span>
<span class="normal"><a href="#__codelineno-56-4">4</a></span>
<span class="normal"><a href="#__codelineno-56-5">5</a></span>
<span class="normal"><a href="#__codelineno-56-6">6</a></span>
<span class="normal"><a href="#__codelineno-56-7">7</a></span>
<span class="normal"><a href="#__codelineno-56-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="w">  </span><span class="n">my_updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="scd-type-2-by-column">SCD Type 2 By Column<a class="headerlink" href="#scd-type-2-by-column" title="Link to this section">¶</a></h3>
<p><strong>By Column</strong> works when your source table doesn't have an "Updated At" timestamp. Instead, Vulcan compares the values in specific columns between runs and detects changes.</p>
<p><strong>How it works:</strong> You specify which columns to watch (or use <code>*</code> to watch all columns). When Vulcan detects a change in any of those columns, it records <code>valid_from</code> as the execution time when the change was detected.</p>
<p><strong>Use this when:</strong> Your source system doesn't track update timestamps, but you still want to maintain history. The trade-off is that <code>valid_from</code> times are based on when Vulcan detected the change, not when the source system actually changed it.</p>
<p>This example specifies a <code>SCD_TYPE_2_BY_COLUMN</code> model kind:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio"/><input id="__tabbed_5_2" name="__tabbed_5" type="radio"/><div class="tabbed-labels"><label for="__tabbed_5_1">SQL</label><label for="__tabbed_5_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span>
<span class="normal"><a href="#__codelineno-57-18">18</a></span>
<span class="normal"><a href="#__codelineno-57-19">19</a></span>
<span class="normal"><a href="#__codelineno-57-20">20</a></span>
<span class="normal"><a href="#__codelineno-57-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">scd_type2_by_column</span><span class="p">,</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_COLUMN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="n">product_id</span><span class="p">],</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="w">    </span><span class="n">columns</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">]</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">product_id</span><span class="p">)</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="p">);</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9"></a>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="k">SELECT</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">product_name</span><span class="p">,</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">supplier_name</span><span class="p">,</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16"></a><span class="w">  </span><span class="n">r</span><span class="p">.</span><span class="n">region_name</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">suppliers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">supplier_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">supplier_id</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">regions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span>
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">region_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">region_id</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span>
<span class="normal"><a href="#__codelineno-58-20">20</a></span>
<span class="normal"><a href="#__codelineno-58-21">21</a></span>
<span class="normal"><a href="#__codelineno-58-22">22</a></span>
<span class="normal"><a href="#__codelineno-58-23">23</a></span>
<span class="normal"><a href="#__codelineno-58-24">24</a></span>
<span class="normal"><a href="#__codelineno-58-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="n">model</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelKindName</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3"></a>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="nd">@model</span><span class="p">(</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5"></a>    <span class="s2">"vulcan_demo.scd_type2_by_column_py"</span><span class="p">,</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6"></a>    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7"></a>        <span class="s2">"product_id"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8"></a>        <span class="s2">"product_name"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9"></a>        <span class="s2">"category"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10"></a>        <span class="s2">"price"</span><span class="p">:</span> <span class="s2">"decimal(10,2)"</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11"></a>    <span class="p">},</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12"></a>    <span class="n">kind</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13"></a>        <span class="n">name</span><span class="o">=</span><span class="n">ModelKindName</span><span class="o">.</span><span class="n">SCD_TYPE_2_BY_COLUMN</span><span class="p">,</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14"></a>        <span class="n">unique_key</span><span class="o">=</span><span class="p">[</span><span class="s2">"product_id"</span><span class="p">],</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15"></a>        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"product_name"</span><span class="p">,</span> <span class="s2">"category"</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">],</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16"></a>    <span class="p">),</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17"></a>    <span class="n">grains</span><span class="o">=</span><span class="p">[</span><span class="s2">"product_id"</span><span class="p">],</span>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18"></a>    <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">"vulcan_demo.products"</span><span class="p">],</span>
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19"></a><span class="p">)</span>
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22"></a><span class="s2">    SELECT product_id, name as product_name, category, price</span>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23"></a><span class="s2">    FROM vulcan_demo.products</span>
</span><span id="__span-58-24"><a id="__codelineno-58-24" name="__codelineno-58-24"></a><span class="s2">    """</span>
</span><span id="__span-58-25"><a id="__codelineno-58-25" name="__codelineno-58-25"></a>    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
</div>
</div>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span>
<span class="normal"><a href="#__codelineno-59-3">3</a></span>
<span class="normal"><a href="#__codelineno-59-4">4</a></span>
<span class="normal"><a href="#__codelineno-59-5">5</a></span>
<span class="normal"><a href="#__codelineno-59-6">6</a></span>
<span class="normal"><a href="#__codelineno-59-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="w">  </span><span class="n">valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="change-column-names">Change Column Names<a class="headerlink" href="#change-column-names" title="Link to this section">¶</a></h3>
<p>Vulcan automatically adds <code>valid_from</code> and <code>valid_to</code> columns to your table. If you want different names (maybe to match your existing schema conventions), you can customize them:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span>
<span class="normal"><a href="#__codelineno-60-5">5</a></span>
<span class="normal"><a href="#__codelineno-60-6">6</a></span>
<span class="normal"><a href="#__codelineno-60-7">7</a></span>
<span class="normal"><a href="#__codelineno-60-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="hll"><span class="w">    </span><span class="n">valid_from_name</span><span class="w"> </span><span class="n">my_valid_from</span><span class="p">,</span><span class="w"> </span><span class="c1">-- Name for `valid_from` column</span>
</span></span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="hll"><span class="w">    </span><span class="n">valid_to_name</span><span class="w"> </span><span class="n">my_valid_to</span><span class="w"> </span><span class="c1">-- Name for `valid_to` column</span>
</span></span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span>
<span class="normal"><a href="#__codelineno-61-2">2</a></span>
<span class="normal"><a href="#__codelineno-61-3">3</a></span>
<span class="normal"><a href="#__codelineno-61-4">4</a></span>
<span class="normal"><a href="#__codelineno-61-5">5</a></span>
<span class="normal"><a href="#__codelineno-61-6">6</a></span>
<span class="normal"><a href="#__codelineno-61-7">7</a></span>
<span class="normal"><a href="#__codelineno-61-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">  </span><span class="n">my_valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="w">  </span><span class="n">my_valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="deletes">Deletes<a class="headerlink" href="#deletes" title="Link to this section">¶</a></h3>
<p>A "hard delete" is when a record disappears from your source table entirely. How should SCD Type 2 handle this?</p>
<p><strong>Default behavior (<code>invalidate_hard_deletes: false</code>):</strong></p>
<ul>
<li><code>valid_to</code> column will continue to be set to <code>NULL</code> (therefore still considered "valid")</li>
<li>If the record is added back, then the <code>valid_to</code> column will be set to the <code>valid_from</code> of the new record.</li>
</ul>
<p>When a record is added back, the new record will be inserted into the table with <code>valid_from</code> set to:</p>
<ul>
<li>SCD_TYPE_2_BY_TIME: the largest of either the <code>updated_at</code> timestamp of the new record or the <code>valid_from</code> timestamp of the deleted record in the SCD Type 2 table</li>
<li>SCD_TYPE_2_BY_COLUMN: the <code>execution_time</code> when the record was detected again</li>
</ul>
<p><strong>With <code>invalidate_hard_deletes: true</code>:</strong></p>
<ul>
<li><code>valid_to</code> is set to the execution time when Vulcan detected the missing record</li>
<li>If the record comes back later, <code>valid_to</code> stays unchanged (you'll have a gap in history)</li>
</ul>
<p><strong>Which should you use?</strong></p>
<ul>
<li>
<p><strong><code>false</code> (default):</strong> Missing records are still considered "valid" (no gaps in history). Use this if you think missing records might be temporary or if you prefer continuous history.</p>
</li>
<li>
<p><strong><code>true</code>:</strong> Deletes are accurately tracked with precise timestamps. Use this if you want to know exactly when records were deleted, even if it creates gaps in history.</p>
</li>
</ul>
<p>With <code>false</code>, missing records are still considered valid. With <code>true</code>, missing records are treated as deleted at that time.</p>
<h3 id="example-of-scd-type-2-by-time-in-action">Example of SCD Type 2 By Time in Action<a class="headerlink" href="#example-of-scd-type-2-by-time-in-action" title="Link to this section">¶</a></h3>
<p>Let's walk through a real example. Say you're tracking a restaurant menu, and you start with this source data (with <code>invalidate_hard_deletes: true</code>):</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
</tbody>
</table>
<p>The target table, which is currently empty, will be materialized with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>Now lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
</tbody>
</table>
<p>Summary of Changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $10.99 to $12.99.</li>
<li>Cheeseburger was removed from the menu.</li>
<li>Milkshakes were added to the menu.</li>
</ul>
<p>Assuming your models ran at <code>2020-01-02 11:00:00</code>, target table will be updated with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>For our final pass, lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
</tbody>
</table>
<p>Summary of changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $12.99 to $14.99 (must be good!)</li>
<li>Cheeseburger was added back to the menu with original name and price.</li>
<li>Milkshake name was updated to be "Chocolate Milkshake".</li>
</ul>
<p>Target table will be updated with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p><strong>Notice:</strong> <code>Cheeseburger</code> was deleted from <code>2020-01-02 11:00:00</code> to <code>2020-01-03 00:00:00</code>. If you query the table for that time range, you won't see it, which accurately reflects that it wasn't on the menu during that period.</p>
<p>This is the most accurate representation based on your source data. If <code>Cheeseburger</code> had been added back with its original <code>updated_at</code> timestamp (<code>2020-01-01</code>), Vulcan would have set the new record's <code>valid_from</code> to <code>2020-01-02 11:00:00</code> (when it was detected again), filling the gap. But since the timestamp didn't change, it's likely the item was removed in error, and the gap accurately represents that.</p>
<h3 id="example-of-scd-type-2-by-column-in-action">Example of SCD Type 2 By Column in Action<a class="headerlink" href="#example-of-scd-type-2-by-column-in-action" title="Link to this section">¶</a></h3>
<p>Now let's see how <strong>By Column</strong> works. Same restaurant menu example, but this time the source table doesn't have an <code>updated_at</code> column. We'll configure the model to watch <code>Name</code> and <code>Price</code> for changes.</p>
<p>Starting data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
</tr>
</tbody>
</table>
<p>After the first run, your SCD Type 2 table looks like this:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>Now lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
</tr>
</tbody>
</table>
<p>Summary of Changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $10.99 to $12.99.</li>
<li>Cheeseburger was removed from the menu.</li>
<li>Milkshakes were added to the menu.</li>
</ul>
<p>Assuming your models ran at <code>2020-01-02 11:00:00</code>, target table will be updated with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>For our final pass, lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
</tr>
</tbody>
</table>
<p>Summary of changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $12.99 to $14.99 (must be good!)</li>
<li>Cheeseburger was added back to the menu with original name and price.</li>
<li>Milkshake name was updated to be "Chocolate Milkshake".</li>
</ul>
<p>After running at <code>2020-01-03 11:00:00</code>, your final SCD Type 2 table:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p><strong>Notice:</strong> <code>Cheeseburger</code> was deleted from <code>2020-01-02 11:00:00</code> to <code>2020-01-03 11:00:00</code>. Query the table for that time range, and you won't see it, which accurately reflects that it wasn't on the menu during that period.</p>
<h3 id="shared-configuration-options">Shared Configuration Options<a class="headerlink" href="#shared-configuration-options" title="Link to this section">¶</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>unique_key</td>
<td>Unique key used for identifying rows between source and target</td>
<td>List of strings or string</td>
</tr>
<tr>
<td>valid_from_name</td>
<td>The name of the <code>valid_from</code> column to create in the target table. Default: <code>valid_from</code></td>
<td>string</td>
</tr>
<tr>
<td>valid_to_name</td>
<td>The name of the <code>valid_to</code> column to create in the target table. Default: <code>valid_to</code></td>
<td>string</td>
</tr>
<tr>
<td>invalidate_hard_deletes</td>
<td>If set to <code>true</code>, when a record is missing from the source table it will be marked as invalid. Default: <code>false</code></td>
<td>bool</td>
</tr>
<tr>
<td>batch_size</td>
<td>The maximum number of intervals that can be evaluated in a single backfill task. If this is <code>None</code>, all intervals will be processed as part of a single task. See <a href="#processing-source-table-with-historical-data">Processing Source Table with Historical Data</a> for more info on this use case. (Default: <code>None</code>)</td>
<td>int</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">BigQuery Data Types</p>
<p>On BigQuery, <code>valid_from</code> and <code>valid_to</code> columns default to <code>DATETIME</code>. If you want <code>TIMESTAMP</code> instead, specify it in your model definition:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span>
<span class="normal"><a href="#__codelineno-62-2">2</a></span>
<span class="normal"><a href="#__codelineno-62-3">3</a></span>
<span class="normal"><a href="#__codelineno-62-4">4</a></span>
<span class="normal"><a href="#__codelineno-62-5">5</a></span>
<span class="normal"><a href="#__codelineno-62-6">6</a></span>
<span class="normal"><a href="#__codelineno-62-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="hll"><span class="w">    </span><span class="n">time_data_type</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span></span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>This might work on other engines too, but it's only been tested on BigQuery.</p>
</div>
<h3 id="scd-type-2-by-time-configuration-options">SCD Type 2 By Time Configuration Options<a class="headerlink" href="#scd-type-2-by-time-configuration-options" title="Link to this section">¶</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>updated_at_name</td>
<td>The name of the column containing a timestamp to check for new or updated records. Default: <code>updated_at</code></td>
<td>string</td>
</tr>
<tr>
<td>updated_at_as_valid_from</td>
<td>By default, for new rows <code>valid_from</code> is set to <code>1970-01-01 00:00:00</code>. This changes the behavior to set it to the valid of <code>updated_at</code> when the row is inserted. Default: <code>false</code></td>
<td>bool</td>
</tr>
</tbody>
</table>
<h3 id="scd-type-2-by-column-configuration-options">SCD Type 2 By Column Configuration Options<a class="headerlink" href="#scd-type-2-by-column-configuration-options" title="Link to this section">¶</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>columns</td>
<td>The name of the columns to check for changes. <code>*</code> to represent that all columns should be checked.</td>
<td>List of strings or string</td>
</tr>
<tr>
<td>execution_time_as_valid_from</td>
<td>By default, when the model is first loaded <code>valid_from</code> is set to <code>1970-01-01 00:00:00</code> and future new rows will have <code>execution_time</code> of when the models ran. This changes the behavior to always use <code>execution_time</code>. Default: <code>false</code></td>
<td>bool</td>
</tr>
<tr>
<td>updated_at_name</td>
<td>If sourcing from a table that includes as timestamp to use as valid_from, set this property to that column. See <a href="#processing-source-table-with-historical-data">Processing Source Table with Historical Data</a> for more info on this use case. (Default: <code>None</code>)</td>
<td>int</td>
</tr>
</tbody>
</table>
<h3 id="processing-source-table-with-historical-data">Processing Source Table with Historical Data<a class="headerlink" href="#processing-source-table-with-historical-data" title="Link to this section">¶</a></h3>
<p>Most of the time, you're creating history for a table that doesn't have it. Like the restaurant menu, it just shows what's available now, but you want to track what was available over time. For this use case, leave <code>batch_size</code> as <code>None</code> (the default).</p>
<p><strong>But what if your source already has history?</strong> Some systems create "daily snapshot" tables that contain historical records. If you're sourcing from one of these, set <code>batch_size</code> to <code>1</code> to process each interval sequentially (one day at a time if you're using <code>@daily</code> cron).</p>
<p><strong>Why sequential?</strong> SCD Type 2 needs to compare each day's snapshot to the previous day to detect changes. Processing them in order ensures the history is captured correctly.</p>
<h4 id="example-source-from-daily-snapshot-table">Example - Source from Daily Snapshot Table<a class="headerlink" href="#example-source-from-daily-snapshot-table" title="Link to this section">¶</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span>
<span class="normal"><a href="#__codelineno-63-14">14</a></span>
<span class="normal"><a href="#__codelineno-63-15">15</a></span>
<span class="normal"><a href="#__codelineno-63-16">16</a></span>
<span class="normal"><a href="#__codelineno-63-17">17</a></span>
<span class="normal"><a href="#__codelineno-63-18">18</a></span>
<span class="normal"><a href="#__codelineno-63-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="k">table</span><span class="p">,</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="w">    </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_COLUMN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="w">        </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="w">        </span><span class="n">columns</span><span class="w"> </span><span class="p">[</span><span class="n">some_value</span><span class="p">],</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="w">        </span><span class="n">updated_at_name</span><span class="w"> </span><span class="n">ds</span><span class="p">,</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="w">        </span><span class="n">batch_size</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="w">    </span><span class="k">start</span><span class="w"> </span><span class="s1">'2025-01-01'</span><span class="p">,</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="w">    </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="p">);</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="k">SELECT</span>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13"></a><span class="w">    </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14"></a><span class="w">    </span><span class="n">some_value</span><span class="p">,</span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15"></a><span class="w">    </span><span class="n">ds</span>
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16"></a><span class="k">FROM</span>
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17"></a><span class="w">    </span><span class="n">source_table</span>
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18"></a><span class="k">WHERE</span>
</span><span id="__span-63-19"><a id="__codelineno-63-19" name="__codelineno-63-19"></a><span class="w">    </span><span class="n">ds</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>This processes each day sequentially, checking if <code>some_value</code> changed. When a change is detected, <code>valid_from</code> is set to match the <code>ds</code> column value (except for the very first record, which gets <code>1970-01-01 00:00:00</code>).</p>
<p>If the source data was the following:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>some_value</th>
<th style="text-align: center;">ds</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td style="text-align: center;">2025-01-01</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td style="text-align: center;">2025-01-02</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td style="text-align: center;">2025-01-03</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td style="text-align: center;">2025-01-04</td>
</tr>
</tbody>
</table>
<p>Then the resulting SCD Type 2 table would be:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>some_value</th>
<th style="text-align: center;">ds</th>
<th style="text-align: center;">valid_from</th>
<th style="text-align: center;">valid_to</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td style="text-align: center;">2025-01-01</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2025-01-02 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td style="text-align: center;">2025-01-02</td>
<td style="text-align: center;">2025-01-02 00:00:00</td>
<td style="text-align: center;">2025-01-03 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td style="text-align: center;">2025-01-03</td>
<td style="text-align: center;">2025-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<h3 id="querying-scd-type-2-models">Querying SCD Type 2 Models<a class="headerlink" href="#querying-scd-type-2-models" title="Link to this section">¶</a></h3>
<p>Even though SCD Type 2 models track history, querying the current version is still simple. Here are some common patterns:</p>
<h4 id="querying-the-current-version">Querying the Current Version<a class="headerlink" href="#querying-the-current-version" title="Link to this section">¶</a></h4>
<p>Want just the latest version of each record? Filter for <code>valid_to IS NULL</code>:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span>
<span class="normal"><a href="#__codelineno-64-4">4</a></span>
<span class="normal"><a href="#__codelineno-64-5">5</a></span>
<span class="normal"><a href="#__codelineno-64-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="k">SELECT</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="w">  </span><span class="o">*</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="k">FROM</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="k">WHERE</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>You can also create a view that adds an <code>is_current</code> flag to make it even easier for downstream consumers:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span>
<span class="normal"><a href="#__codelineno-65-3">3</a></span>
<span class="normal"><a href="#__codelineno-65-4">4</a></span>
<span class="normal"><a href="#__codelineno-65-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="k">SELECT</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="w">  </span><span class="o">*</span><span class="p">,</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_current</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="k">FROM</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="w">  </span><span class="n">menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h4 id="querying-for-a-specific-point-in-time">Querying for a Specific Point in Time<a class="headerlink" href="#querying-for-a-specific-point-in-time" title="Link to this section">¶</a></h4>
<p>Want to see what the menu looked like on a specific date? Filter by <code>valid_from</code> and <code>valid_to</code>:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span>
<span class="normal"><a href="#__codelineno-66-4">4</a></span>
<span class="normal"><a href="#__codelineno-66-5">5</a></span>
<span class="normal"><a href="#__codelineno-66-6">6</a></span>
<span class="normal"><a href="#__codelineno-66-7">7</a></span>
<span class="normal"><a href="#__codelineno-66-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="k">SELECT</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="w">  </span><span class="o">*</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="k">FROM</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5"></a><span class="k">WHERE</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="s1">'2020-01-02 01:00:00'</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">valid_from</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="s1">'2020-01-02 01:00:00'</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2199-12-31 23:59:59+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">));</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Here's how you'd use it in a join (to get the menu item price that was valid when an order was placed):</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span>
<span class="normal"><a href="#__codelineno-67-4">4</a></span>
<span class="normal"><a href="#__codelineno-67-5">5</a></span>
<span class="normal"><a href="#__codelineno-67-6">6</a></span>
<span class="normal"><a href="#__codelineno-67-7">7</a></span>
<span class="normal"><a href="#__codelineno-67-8">8</a></span>
<span class="normal"><a href="#__codelineno-67-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="k">SELECT</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="w">  </span><span class="o">*</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="k">FROM</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="w">  </span><span class="n">orders</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">menu_item_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menu_items</span><span class="p">.</span><span class="n">id</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">menu_items</span><span class="p">.</span><span class="n">valid_from</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">menu_items</span><span class="p">.</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2199-12-31 23:59:59+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">));</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>You can create a view that handles the <code>COALESCE</code> automatically, making point-in-time queries even easier:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-68-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-68-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-68-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-68-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-68-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-68-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-68-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-68-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-68-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="k">SELECT</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="w">  </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="w">  </span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="p">,</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="p">,</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7"></a><span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2199-12-31 23:59:59+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">valid_to</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_current</span><span class="p">,</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9"></a><span class="k">FROM</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10"></a><span class="w">  </span><span class="n">menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Want to make <code>valid_to</code> inclusive so users can use <code>BETWEEN</code>? Adjust it like this:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span>
<span class="normal"><a href="#__codelineno-69-2">2</a></span>
<span class="normal"><a href="#__codelineno-69-3">3</a></span>
<span class="normal"><a href="#__codelineno-69-4">4</a></span>
<span class="normal"><a href="#__codelineno-69-5">5</a></span>
<span class="normal"><a href="#__codelineno-69-6">6</a></span>
<span class="normal"><a href="#__codelineno-69-7">7</a></span>
<span class="normal"><a href="#__codelineno-69-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="k">SELECT</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="w">  </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="w">  </span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="p">,</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="p">,</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7"></a><span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2200-01-01 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">SECOND</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">valid_to</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_current</span><span class="p">,</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<div class="admonition note">
<p class="admonition-title">Timestamp Precision</p>
<p>This example uses second precision, so we subtract 1 second. Adjust the subtraction based on your timestamp precision (milliseconds, microseconds, etc.).</p>
</div>
<h4 id="querying-for-deleted-records">Querying for Deleted Records<a class="headerlink" href="#querying-for-deleted-records" title="Link to this section">¶</a></h4>
<p>To find records that were deleted, query for IDs that don't have a current version (<code>valid_to IS NULL</code>). Here's how:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span>
<span class="normal"><a href="#__codelineno-70-4">4</a></span>
<span class="normal"><a href="#__codelineno-70-5">5</a></span>
<span class="normal"><a href="#__codelineno-70-6">6</a></span>
<span class="normal"><a href="#__codelineno-70-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="k">SELECT</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="w">  </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_deleted</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="k">FROM</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7"></a><span class="w">  </span><span class="n">id</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h3 id="reset-scd-type-2-model-clearing-history">Reset SCD Type 2 Model (Clearing History)<a class="headerlink" href="#reset-scd-type-2-model-clearing-history" title="Link to this section">¶</a></h3>
<p>By default, SCD Type 2 models protect your history, once it's gone, you can't recreate it. But sometimes you need to start fresh (maybe you're fixing a bug, or the history got corrupted).</p>
<p><strong>Warning:</strong> This will delete all historical data. Make sure you really want to do this!</p>
<p>To reset history, follow these steps:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span>
<span class="normal"><a href="#__codelineno-71-3">3</a></span>
<span class="normal"><a href="#__codelineno-71-4">4</a></span>
<span class="normal"><a href="#__codelineno-71-5">5</a></span>
<span class="normal"><a href="#__codelineno-71-6">6</a></span>
<span class="normal"><a href="#__codelineno-71-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5"></a><span class="hll"><span class="w">    </span><span class="n">disable_restatement</span><span class="w"> </span><span class="k">false</span>
</span></span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Plan/apply this change to production.
Then you will want to <a href="../../../guides/plan/#restatement-plans">restate the model</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Data Loss Warning</p>
<p>This will permanently remove all historical data. In most cases, you cannot recover it. Make absolutely sure this is what you want!</p>
</div>
<ol start="4">
<li>Once complete, remove <code>disable_restatement</code> from your model definition (sets it back to <code>true</code>) to prevent accidental data loss in the future</li>
</ol>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span>
<span class="normal"><a href="#__codelineno-72-3">3</a></span>
<span class="normal"><a href="#__codelineno-72-4">4</a></span>
<span class="normal"><a href="#__codelineno-72-5">5</a></span>
<span class="normal"><a href="#__codelineno-72-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<ol start="5">
<li>Plan and apply this change to production</li>
</ol>
<h2 id="external">EXTERNAL<a class="headerlink" href="#external" title="Link to this section">¶</a></h2>
<p>The EXTERNAL model kind is used to specify <a href="../types/external_models/">external models</a> that store metadata about external tables. External models are special; they are not specified in .sql files like the other model kinds. They are optional but useful for propagating column and type information for external tables queried in your Vulcan project.</p>
<h2 id="managed">MANAGED<a class="headerlink" href="#managed" title="Link to this section">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Managed models are still under development and the API / semantics may change as support for more engines is added</p>
</div>
<p><strong>Note:</strong> Python models do not support the <code>MANAGED</code> model kind - use a SQL model instead.</p>
<p>The <code>MANAGED</code> model kind is used to create models where the underlying database engine manages the data lifecycle.</p>
<p>These models don't get updated with new intervals or refreshed when <code>vulcan run</code> is called. Responsibility for keeping the <em>data</em> up to date falls on the engine.</p>
<p>You can control how the engine creates the managed model by using the <a href="../overview/#physical_properties"><code>physical_properties</code></a> to pass engine-specific parameters for adapter to use when issuing commands to the underlying database.</p>
<p>Due to there being no standard, each vendor has a different implementation with different semantics and different configuration parameters. Therefore, <code>MANAGED</code> models are not as portable between database engines as other Vulcan model types. In addition, due to their black-box nature, Vulcan has limited visibility into the integrity and state of the model.</p>
<p>We would recommend using standard Vulcan model types in the first instance. However, if you do need to use Managed models, you still gain other Vulcan benefits like the ability to use them in <a href="../overview/#build-a-virtual-environment">virtual environments</a>.</p>
<p>See <a href="../types/managed_models/">Managed Models</a> for more information on which engines are supported and which properties are available.</p>
<h2 id="incremental_by_partition">INCREMENTAL_BY_PARTITION<a class="headerlink" href="#incremental_by_partition" title="Link to this section">¶</a></h2>
<p>Models of the <code>INCREMENTAL_BY_PARTITION</code> kind are computed incrementally based on partition. A set of columns defines the model's partitioning key, and a partition is the group of rows with the same partitioning key value.</p>
<div class="admonition question">
<p class="admonition-title">Should you use this model kind?</p>
<p>Any model kind can use a partitioned <strong>table</strong> by specifying the <a href="../overview/#partitioned_by"><code>partitioned_by</code> key</a> in the <code>MODEL</code> DDL.</p>
<p>The "partition" in <code>INCREMENTAL_BY_PARTITION</code> is about how the data is <strong>loaded</strong> when the model runs.</p>
<p><code>INCREMENTAL_BY_PARTITION</code> models are inherently <a href="../../../references/glossary/#idempotency">non-idempotent</a>, so restatements and other actions can cause data loss. This makes them more complex to manage than other model kinds.</p>
<p>In most scenarios, an <code>INCREMENTAL_BY_TIME_RANGE</code> model can meet your needs and will be easier to manage. The <code>INCREMENTAL_BY_PARTITION</code> model kind should only be used when the data must be loaded by partition (usually for performance reasons).</p>
</div>
<p>This model kind is designed for the scenario where data rows should be loaded and updated as a group based on their shared value for the partitioning key.</p>
<p>It may be used with any SQL engine. Vulcan will automatically create partitioned tables on engines that support explicit table partitioning (e.g., <a href="https://cloud.google.com/bigquery/docs/creating-partitioned-tables">BigQuery</a>, <a href="https://docs.databricks.com/en/sql/language-manual/sql-ref-partition.html">Databricks</a>).</p>
<p>New rows are loaded based on their partitioning key value:</p>
<ul>
<li>
<p>If a partitioning key in newly loaded data is not present in the model table, the new partitioning key and its data rows are inserted.</p>
</li>
<li>
<p>If a partitioning key in newly loaded data is already present in the model table, <strong>all the partitioning key's existing data rows in the model table are replaced</strong> with the partitioning key's data rows in the newly loaded data.</p>
</li>
<li>
<p>If a partitioning key is present in the model table but not present in the newly loaded data, the partitioning key's existing data rows are not modified and remain in the model table.</p>
</li>
</ul>
<p>This kind should only be used for datasets that have the following traits:</p>
<ul>
<li>The dataset's records can be grouped by a partitioning key.</li>
<li>Each record has a partitioning key associated with it.</li>
<li>It is appropriate to upsert records, so existing records can be overwritten by new arrivals when their partitioning keys match.</li>
<li>All existing records associated with a given partitioning key can be removed or overwritten when any new record has the partitioning key value.</li>
</ul>
<p>The column defining the partitioning key is specified in the model's <code>MODEL</code> DDL <code>partitioned_by</code> key. This example shows the <code>MODEL</code> DDL for an <code>INCREMENTAL_BY_PARTITION</code> model:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio"/><input id="__tabbed_6_2" name="__tabbed_6" type="radio"/><div class="tabbed-labels"><label for="__tabbed_6_1">SQL</label><label for="__tabbed_6_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-73-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-73-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-73-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-73-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-73-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-73-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-73-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-73-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-73-10">10</a></span>
<span class="normal"><a href="#__codelineno-73-11">11</a></span>
<span class="normal"><a href="#__codelineno-73-12">12</a></span>
<span class="normal"><a href="#__codelineno-73-13">13</a></span>
<span class="normal"><a href="#__codelineno-73-14">14</a></span>
<span class="normal"><a href="#__codelineno-73-15">15</a></span>
<span class="normal"><a href="#__codelineno-73-16">16</a></span>
<span class="normal"><a href="#__codelineno-73-17">17</a></span>
<span class="normal"><a href="#__codelineno-73-18">18</a></span>
<span class="normal"><a href="#__codelineno-73-19">19</a></span>
<span class="normal"><a href="#__codelineno-73-20">20</a></span>
<span class="normal"><a href="#__codelineno-73-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">partition</span><span class="p">,</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="n">warehouse_id</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">],</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">partitioned_analysis_key</span><span class="p">)</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6"></a><span class="p">);</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7"></a>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8"></a><span class="k">SELECT</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9"></a><span class="w">  </span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span><span class="p">,</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10"></a><span class="w">  </span><span class="n">w</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">warehouse_name</span><span class="p">,</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13"></a><span class="w">  </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span><span class="p">::</span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">::</span><span class="nb">TEXT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">partitioned_analysis_key</span><span class="p">,</span>
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_transactions</span><span class="p">,</span>
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15"></a><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">unit_price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_sales_amount</span><span class="p">,</span>
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">unique_customers</span>
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span>
</span><span id="__span-73-18"><a id="__codelineno-73-18" name="__codelineno-73-18"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">order_items</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">oi</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-73-19"><a id="__codelineno-73-19" name="__codelineno-73-19"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span>
</span><span id="__span-73-20"><a id="__codelineno-73-20" name="__codelineno-73-20"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">warehouses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">warehouse_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span>
</span><span id="__span-73-21"><a id="__codelineno-73-21" name="__codelineno-73-21"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">warehouse_id</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span>
<span class="normal"><a href="#__codelineno-74-11">11</a></span>
<span class="normal"><a href="#__codelineno-74-12">12</a></span>
<span class="normal"><a href="#__codelineno-74-13">13</a></span>
<span class="normal"><a href="#__codelineno-74-14">14</a></span>
<span class="normal"><a href="#__codelineno-74-15">15</a></span>
<span class="normal"><a href="#__codelineno-74-16">16</a></span>
<span class="normal"><a href="#__codelineno-74-17">17</a></span>
<span class="normal"><a href="#__codelineno-74-18">18</a></span>
<span class="normal"><a href="#__codelineno-74-19">19</a></span>
<span class="normal"><a href="#__codelineno-74-20">20</a></span>
<span class="normal"><a href="#__codelineno-74-21">21</a></span>
<span class="normal"><a href="#__codelineno-74-22">22</a></span>
<span class="normal"><a href="#__codelineno-74-23">23</a></span>
<span class="normal"><a href="#__codelineno-74-24">24</a></span>
<span class="normal"><a href="#__codelineno-74-25">25</a></span>
<span class="normal"><a href="#__codelineno-74-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="n">model</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vulcan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelKindName</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3"></a>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="nd">@model</span><span class="p">(</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5"></a>    <span class="s2">"vulcan_demo.partition_py"</span><span class="p">,</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6"></a>    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7"></a>        <span class="s2">"warehouse_id"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8"></a>        <span class="s2">"order_date"</span><span class="p">:</span> <span class="s2">"date"</span><span class="p">,</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9"></a>        <span class="s2">"daily_revenue"</span><span class="p">:</span> <span class="s2">"decimal(10,2)"</span><span class="p">,</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10"></a>    <span class="p">},</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11"></a>    <span class="n">partitioned_by</span><span class="o">=</span><span class="p">[</span><span class="s2">"warehouse_id"</span><span class="p">],</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12"></a>    <span class="n">kind</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13"></a>        <span class="n">name</span><span class="o">=</span><span class="n">ModelKindName</span><span class="o">.</span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14"></a>    <span class="p">),</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15"></a>    <span class="n">grains</span><span class="o">=</span><span class="p">[</span><span class="s2">"warehouse_id"</span><span class="p">,</span> <span class="s2">"order_date"</span><span class="p">],</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16"></a>    <span class="n">depends_on</span><span class="o">=</span><span class="p">[</span><span class="s2">"vulcan_demo.orders"</span><span class="p">,</span> <span class="s2">"vulcan_demo.order_items"</span><span class="p">],</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17"></a><span class="p">)</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20"></a><span class="s2">    SELECT o.warehouse_id, o.order_date,</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21"></a><span class="s2">           SUM(oi.quantity * oi.unit_price) as daily_revenue</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22"></a><span class="s2">    FROM vulcan_demo.orders o</span>
</span><span id="__span-74-23"><a id="__codelineno-74-23" name="__codelineno-74-23"></a><span class="s2">    JOIN vulcan_demo.order_items oi ON o.order_id = oi.order_id</span>
</span><span id="__span-74-24"><a id="__codelineno-74-24" name="__codelineno-74-24"></a><span class="s2">    GROUP BY o.warehouse_id, o.order_date</span>
</span><span id="__span-74-25"><a id="__codelineno-74-25" name="__codelineno-74-25"></a><span class="s2">    """</span>
</span><span id="__span-74-26"><a id="__codelineno-74-26" name="__codelineno-74-26"></a>    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
</div>
</div>
</div>
<p>You can use multiple columns for composite partition keys:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span>
<span class="normal"><a href="#__codelineno-75-2">2</a></span>
<span class="normal"><a href="#__codelineno-75-3">3</a></span>
<span class="normal"><a href="#__codelineno-75-4">4</a></span>
<span class="normal"><a href="#__codelineno-75-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="p">(</span><span class="n">warehouse_id</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">)</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Some engines support expression-based partitioning. Here's a BigQuery example that partitions by month:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span>
<span class="normal"><a href="#__codelineno-76-3">3</a></span>
<span class="normal"><a href="#__codelineno-76-4">4</a></span>
<span class="normal"><a href="#__codelineno-76-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="n">DATETIME_TRUNC</span><span class="p">(</span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="k">MONTH</span><span class="p">)</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<div class="admonition warning">
<p class="admonition-title">Only Full Restatements Supported</p>
<p>Partial data <a href="../../../guides/plan/#restatement-plans">restatements</a> are used to reprocess part of a table's data (usually a limited time range).</p>
<p>Partial data restatement is not supported for <code>INCREMENTAL_BY_PARTITION</code> models. If you restate an <code>INCREMENTAL_BY_PARTITION</code> model, its entire table will be recreated from scratch.</p>
<p>Restating <code>INCREMENTAL_BY_PARTITION</code> models may lead to data loss and should be performed with care.</p>
</div>
<h3 id="example">Example<a class="headerlink" href="#example" title="Link to this section">¶</a></h3>
<p>Here's a practical example that shows how to limit which partitions get updated using a CTE. This is a common pattern to avoid full restatements:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-77-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-77-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-77-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-77-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-77-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-77-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-77-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-77-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-77-10">10</a></span>
<span class="normal"><a href="#__codelineno-77-11">11</a></span>
<span class="normal"><a href="#__codelineno-77-12">12</a></span>
<span class="normal"><a href="#__codelineno-77-13">13</a></span>
<span class="normal"><a href="#__codelineno-77-14">14</a></span>
<span class="normal"><a href="#__codelineno-77-15">15</a></span>
<span class="normal"><a href="#__codelineno-77-16">16</a></span>
<span class="normal"><a href="#__codelineno-77-17">17</a></span>
<span class="normal"><a href="#__codelineno-77-18">18</a></span>
<span class="normal"><a href="#__codelineno-77-19">19</a></span>
<span class="normal"><a href="#__codelineno-77-20">20</a></span>
<span class="normal"><a href="#__codelineno-77-21">21</a></span>
<span class="normal"><a href="#__codelineno-77-22">22</a></span>
<span class="normal"><a href="#__codelineno-77-23">23</a></span>
<span class="normal"><a href="#__codelineno-77-24">24</a></span>
<span class="normal"><a href="#__codelineno-77-25">25</a></span>
<span class="normal"><a href="#__codelineno-77-26">26</a></span>
<span class="normal"><a href="#__codelineno-77-27">27</a></span>
<span class="normal"><a href="#__codelineno-77-28">28</a></span>
<span class="normal"><a href="#__codelineno-77-29">29</a></span>
<span class="normal"><a href="#__codelineno-77-30">30</a></span>
<span class="normal"><a href="#__codelineno-77-31">31</a></span>
<span class="normal"><a href="#__codelineno-77-32">32</a></span>
<span class="normal"><a href="#__codelineno-77-33">33</a></span>
<span class="normal"><a href="#__codelineno-77-34">34</a></span>
<span class="normal"><a href="#__codelineno-77-35">35</a></span>
<span class="normal"><a href="#__codelineno-77-36">36</a></span>
<span class="normal"><a href="#__codelineno-77-37">37</a></span>
<span class="normal"><a href="#__codelineno-77-38">38</a></span>
<span class="normal"><a href="#__codelineno-77-39">39</a></span>
<span class="normal"><a href="#__codelineno-77-40">40</a></span>
<span class="normal"><a href="#__codelineno-77-41">41</a></span>
<span class="normal"><a href="#__codelineno-77-42">42</a></span>
<span class="normal"><a href="#__codelineno-77-43">43</a></span>
<span class="normal"><a href="#__codelineno-77-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_by_partition_demo</span><span class="p">,</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="n">user_segment</span><span class="p">,</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5"></a><span class="p">);</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6"></a>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7"></a><span class="c1">-- This is the source of truth for what partitions need to be updated and will join to the product usage data</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8"></a>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9"></a><span class="c1">-- This could be an INCREMENTAL_BY_TIME_RANGE model that reads in the user_segment values last updated in the past 30 days to reduce scope</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10"></a>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11"></a><span class="c1">-- Use this strategy to reduce full restatements</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12"></a><span class="k">WITH</span><span class="w"> </span><span class="n">partitions_to_update</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14"></a><span class="w">    </span><span class="n">user_segment</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_by_time_range_demo</span><span class="w">  </span><span class="c1">-- upstream table tracking which user segments to update</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">last_updated_at</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="o">@</span><span class="n">start_dt</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_dt</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17"></a><span class="p">),</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18"></a>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19"></a><span class="n">product_usage</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21"></a><span class="w">    </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22"></a><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-77-23"><a id="__codelineno-77-23" name="__codelineno-77-23"></a><span class="w">    </span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-77-24"><a id="__codelineno-77-24" name="__codelineno-77-24"></a><span class="w">    </span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-77-25"><a id="__codelineno-77-25" name="__codelineno-77-25"></a><span class="w">    </span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-77-26"><a id="__codelineno-77-26" name="__codelineno-77-26"></a><span class="w">    </span><span class="n">user_segment</span>
</span><span id="__span-77-27"><a id="__codelineno-77-27" name="__codelineno-77-27"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">tcloud_raw_data</span><span class="p">.</span><span class="n">product_usage</span>
</span><span id="__span-77-28"><a id="__codelineno-77-28" name="__codelineno-77-28"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_segment</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">user_segment</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">partitions_to_update</span><span class="p">)</span><span class="w"> </span><span class="c1">-- partition filter applied here</span>
</span><span id="__span-77-29"><a id="__codelineno-77-29" name="__codelineno-77-29"></a><span class="p">)</span>
</span><span id="__span-77-30"><a id="__codelineno-77-30" name="__codelineno-77-30"></a>
</span><span id="__span-77-31"><a id="__codelineno-77-31" name="__codelineno-77-31"></a><span class="k">SELECT</span>
</span><span id="__span-77-32"><a id="__codelineno-77-32" name="__codelineno-77-32"></a><span class="w">  </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-77-33"><a id="__codelineno-77-33" name="__codelineno-77-33"></a><span class="w">  </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-77-34"><a id="__codelineno-77-34" name="__codelineno-77-34"></a><span class="w">  </span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-77-35"><a id="__codelineno-77-35" name="__codelineno-77-35"></a><span class="w">  </span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-77-36"><a id="__codelineno-77-36" name="__codelineno-77-36"></a><span class="w">  </span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-77-37"><a id="__codelineno-77-37" name="__codelineno-77-37"></a><span class="w">  </span><span class="n">user_segment</span><span class="p">,</span>
</span><span id="__span-77-38"><a id="__codelineno-77-38" name="__codelineno-77-38"></a><span class="w">  </span><span class="k">CASE</span>
</span><span id="__span-77-39"><a id="__codelineno-77-39" name="__codelineno-77-39"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">feature_utilization_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-77-40"><a id="__codelineno-77-40" name="__codelineno-77-40"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-77-41"><a id="__codelineno-77-41" name="__codelineno-77-41"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">usage_count</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-77-42"><a id="__codelineno-77-42" name="__codelineno-77-42"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-77-43"><a id="__codelineno-77-43" name="__codelineno-77-43"></a><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">user_type</span>
</span><span id="__span-77-44"><a id="__codelineno-77-44" name="__codelineno-77-44"></a><span class="k">FROM</span><span class="w"> </span><span class="n">product_usage</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p><strong>Note</strong>: Partial data <a href="../../../guides/plan/#restatement-plans">restatement</a> is not supported for this model kind, which means that the entire table will be recreated from scratch if restated. This may lead to data loss.</p>
<h3 id="materialization-strategy_3">Materialization strategy<a class="headerlink" href="#materialization-strategy_3" title="Link to this section">¶</a></h3>
<p>Depending on the target engine, models of the <code>INCREMENTAL_BY_PARTITION</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Databricks</td>
<td>REPLACE WHERE by partitioning key</td>
</tr>
<tr>
<td>Spark</td>
<td>INSERT OVERWRITE by partitioning key</td>
</tr>
<tr>
<td>Snowflake</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>BigQuery</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>Redshift</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>Postgres</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>DuckDB</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
</tbody>
</table>
<h2 id="incremental_unmanaged">INCREMENTAL_UNMANAGED<a class="headerlink" href="#incremental_unmanaged" title="Link to this section">¶</a></h2>
<p><code>INCREMENTAL_UNMANAGED</code> models are for append-only tables. They're "unmanaged" because Vulcan doesn't try to deduplicate or manage the data, it just runs your query and appends whatever it gets to the table.</p>
<p><strong>How it works:</strong> Every time the model runs, Vulcan executes your query and appends the results to the table. No deduplication, no updates, no deletes, just append, append, append.</p>
<div class="admonition question">
<p class="admonition-title">Should You Use This?</p>
<p><strong>Use it for:</strong> Data Vault patterns, event logs, audit trails, or any scenario where you need true append-only behavior.</p>
<p><strong>Don't use it for:</strong> Most other cases. <code>INCREMENTAL_BY_TIME_RANGE</code> or <code>INCREMENTAL_BY_UNIQUE_KEY</code> give you much more control and are usually better choices.</p>
</div>
<p><strong>When to use:</strong></p>
<ul>
<li>
<p>Data Vault hubs, links, or satellites</p>
</li>
<li>
<p>Event logs where every event should be preserved</p>
</li>
<li>
<p>Audit trails</p>
</li>
<li>
<p>Any pattern that requires true append-only semantics</p>
</li>
</ul>
<p>Here's how you'd set one up:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-78-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-78-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-78-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-78-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-78-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-78-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-78-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-78-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-78-10">10</a></span>
<span class="normal"><a href="#__codelineno-78-11">11</a></span>
<span class="normal"><a href="#__codelineno-78-12">12</a></span>
<span class="normal"><a href="#__codelineno-78-13">13</a></span>
<span class="normal"><a href="#__codelineno-78-14">14</a></span>
<span class="normal"><a href="#__codelineno-78-15">15</a></span>
<span class="normal"><a href="#__codelineno-78-16">16</a></span>
<span class="normal"><a href="#__codelineno-78-17">17</a></span>
<span class="normal"><a href="#__codelineno-78-18">18</a></span>
<span class="normal"><a href="#__codelineno-78-19">19</a></span>
<span class="normal"><a href="#__codelineno-78-20">20</a></span>
<span class="normal"><a href="#__codelineno-78-21">21</a></span>
<span class="normal"><a href="#__codelineno-78-22">22</a></span>
<span class="normal"><a href="#__codelineno-78-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">incremental_unmanaged</span><span class="p">,</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_UNMANAGED</span><span class="p">,</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2025-01-01'</span><span class="p">,</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6"></a><span class="w">  </span><span class="n">grains</span><span class="w"> </span><span class="p">(</span><span class="n">shipment_id</span><span class="p">)</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7"></a><span class="p">);</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8"></a>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9"></a><span class="cm">/* Append-only shipment event log */</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10"></a><span class="k">SELECT</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">shipment_id</span><span class="p">,</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">shipped_date</span><span class="p">,</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">carrier</span><span class="p">,</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16"></a><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17"></a><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18"></a><span class="w">  </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">shipped_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">::</span><span class="nb">DATE</span><span class="p">)::</span><span class="nb">INT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">days_to_ship</span><span class="p">,</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19"></a><span class="w">  </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shipment_event_timestamp</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20"></a><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">shipments</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span>
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span>
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">vulcan_demo</span><span class="p">.</span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span>
</span><span id="__span-78-23"><a id="__codelineno-78-23" name="__codelineno-78-23"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">shipped_date</span><span class="w"> </span><span class="k">DESC</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p><strong>Note:</strong> Since it's unmanaged, <code>INCREMENTAL_UNMANAGED</code> doesn't support <code>batch_size</code> or <code>batch_concurrency</code> properties. Vulcan just runs your query and appends the results, no batching or concurrency control.</p>
<div class="admonition warning">
<p class="admonition-title">Only Full Restatements Supported</p>
<p>Similar to <code>INCREMENTAL_BY_PARTITION</code>, attempting to <a href="../../../guides/plan/#restatement-plans">restate</a> an <code>INCREMENTAL_UNMANAGED</code> model will trigger a full restatement. That is, the model will be rebuilt from scratch rather than from a time slice you specify.</p>
<p>Be very careful when restating these models!</p>
</div>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Managed" class="md-footer__link md-footer__link--prev" href="../types/managed_models/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Managed
              </div>
</div>
</a>
<a aria-label="Next: Statements" class="md-footer__link md-footer__link--next" href="../statements/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Statements
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2025 DataOS Vulcan Team<br/>
<small>Complete stack for building data products</small>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/tmdc-io/vulcan-book" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "navigation.indexes", "navigation.path", "navigation.top", "navigation.footer", "toc.follow", "search.highlight", "search.suggest", "search.share", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
<script src="../../../assets/javascripts/mermaid-zoom.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>