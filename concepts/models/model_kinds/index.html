<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Complete documentation for Vulcan - complete stack for building data products">
      
      
        <meta name="author" content="DataOS Vulcan Team">
      
      
        <link rel="canonical" href="https://tmdc-io.github.io/vulcan-book/concepts/models/model_kinds/">
      
      
        <link rel="prev" href="../overview/">
      
      
        <link rel="next" href="../sql_models/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/vulcan.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Model kinds - DataOS Vulcan</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#model-kinds" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DataOS Vulcan" class="md-header__button md-logo" aria-label="DataOS Vulcan" data-md-component="logo">
      
  <img src="../../../assets/images/vulcan-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DataOS Vulcan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Model kinds
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/tmdc-io/vulcan-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    tmdc-io/vulcan-book
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting_started/" class="md-tabs__link">
          
  
  
  Get started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../guides/projects/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../overview/" class="md-tabs__link">
          
  
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/overview/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../integrations/engines/postgres/" class="md-tabs__link">
          
  
  
  Engines

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../reference/cli/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DataOS Vulcan" class="md-nav__button md-logo" aria-label="DataOS Vulcan" data-md-component="logo">
      
  <img src="../../../assets/images/vulcan-white.svg" alt="logo">

    </a>
    DataOS Vulcan
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tmdc-io/vulcan-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    tmdc-io/vulcan-book
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Get started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Get started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prerequisites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1">
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project structure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project structure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2">
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project setup
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project setup
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/connections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connections guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/scheduling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scheduling guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/notifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notifications guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migrations guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/table_migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Table migration guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/custom_materializations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom materializations guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3">
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project content
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project content
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/incremental_time/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Incremental by time guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/model_selection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Selection Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4">
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vulcan tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vulcan tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/linter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linter guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5">
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced usage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/signals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Signals guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2">
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plans/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plans
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../audits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auditing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Checks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Models
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Model kinds
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Model kinds
  

    
  </span>
  
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#incremental_by_time_range" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_BY_TIME_RANGE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental_by_unique_key" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_BY_UNIQUE_KEY
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full" class="md-nav__link">
    <span class="md-ellipsis">
      
        FULL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    <span class="md-ellipsis">
      
        VIEW
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedded" class="md-nav__link">
    <span class="md-ellipsis">
      
        EMBEDDED
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seed" class="md-nav__link">
    <span class="md-ellipsis">
      
        SEED
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scd-type-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        SCD Type 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external" class="md-nav__link">
    <span class="md-ellipsis">
      
        EXTERNAL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managed" class="md-nav__link">
    <span class="md-ellipsis">
      
        MANAGED
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental_by_partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_BY_PARTITION
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental_unmanaged" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_UNMANAGED
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sql_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../seed_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Seed models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../external_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../managed_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Managed models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4">
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Semantics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Semantics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../semantics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantics Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../semantics/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantic Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../semantics/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Business Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5">
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Macros
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Macros
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../macros/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../macros/macro_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Macro variables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../macros/vulcan_macros/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vulcan macros
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../macros/jinja_macros/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jinja macros
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6">
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/snapshots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snapshots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/serialization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Serialization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6">
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Engines
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Engines
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/engines/postgres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Postgres
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/engines/coming_soon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coming Soon
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7">
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/model_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#incremental_by_time_range" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_BY_TIME_RANGE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental_by_unique_key" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_BY_UNIQUE_KEY
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full" class="md-nav__link">
    <span class="md-ellipsis">
      
        FULL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    <span class="md-ellipsis">
      
        VIEW
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedded" class="md-nav__link">
    <span class="md-ellipsis">
      
        EMBEDDED
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seed" class="md-nav__link">
    <span class="md-ellipsis">
      
        SEED
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scd-type-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        SCD Type 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external" class="md-nav__link">
    <span class="md-ellipsis">
      
        EXTERNAL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managed" class="md-nav__link">
    <span class="md-ellipsis">
      
        MANAGED
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental_by_partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_BY_PARTITION
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental_unmanaged" class="md-nav__link">
    <span class="md-ellipsis">
      
        INCREMENTAL_UNMANAGED
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation">
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Overview
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../overview/" class="md-path__link">
          
  <span class="md-ellipsis">
    Concepts
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../overview/" class="md-path__link">
          
  <span class="md-ellipsis">
    Models
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="model-kinds">Model kinds<a class="headerlink" href="#model-kinds" title="Permanent link"></a></h1>
<p>This page describes the kinds of <a href="../overview/">models</a> Vulcan supports, which determine how the data for a model is loaded.</p>
<p>Find information about all model kind configuration parameters in the <a href="../../../reference/model_configuration/">model configuration reference page</a>.</p>
<h2 id="incremental_by_time_range">INCREMENTAL_BY_TIME_RANGE<a class="headerlink" href="#incremental_by_time_range" title="Permanent link"></a></h2>
<p>Models of the <code>INCREMENTAL_BY_TIME_RANGE</code> kind are computed incrementally based on a time range. This is an optimal choice for datasets in which records are captured over time and represent immutable facts such as events, logs, or transactions. Using this kind for appropriate datasets typically results in significant cost and time savings.</p>
<p>Only missing time intervals are processed during each execution for <code>INCREMENTAL_BY_TIME_RANGE</code> models. This is in contrast to the <a href="#full">FULL</a> model kind, where the entire dataset is recomputed every time the model is executed.</p>
<p>An <code>INCREMENTAL_BY_TIME_RANGE</code> model has two requirements that other models do not: it must know which column contains the time data it will use to filter the data by time range, and it must contain a <code>WHERE</code> clause that filters the upstream data by time.</p>
<p>The name of the column containing time data is specified in the model's <code>MODEL</code> DDL. It is specified in the DDL <code>kind</code> specification's <code>time_column</code> key. This example shows the <code>MODEL</code> DDL for an <code>INCREMENTAL_BY_TIME_RANGE</code> model that stores time data in the "event_date" column:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">event_date</span><span class="w"> </span><span class="c1">-- This model's time information is stored in the `event_date` column</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p><a id="timezones"></a>
In addition to specifying a time column in the <code>MODEL</code> DDL, the model's query must contain a <code>WHERE</code> clause that filters the upstream records by time range. Vulcan provides special macros that represent the start and end of the time range being processed: <code>@start_date</code> / <code>@end_date</code> and <code>@start_ds</code> / <code>@end_ds</code>. Refer to <a href="../../macros/macro_variables/">Macros</a> for more information.</p>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>This example demonstrates incremental by time range models.</p>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incrementals_demo</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="c1">-- How does this model kind behave?</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="c1">--   DELETE by time range, then INSERT</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">transaction_date</span><span class="p">,</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="c1">-- How do I handle late-arriving data?</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="c1">--   Handle late-arriving events for the past 2 (2*1) days based on cron</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="c1">--   interval. Each time it runs, it will process today, yesterday, and</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="c1">--   the day before yesterday.</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="n">lookback</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">  </span><span class="c1">-- Don't backfill data before this date</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2024-10-25'</span><span class="p">,</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">  </span><span class="c1">-- What schedule should I run these at?</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">  </span><span class="c1">--   Daily at Midnight UTC</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">  </span><span class="c1">-- Good documentation for the primary key</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">  </span><span class="n">grain</span><span class="w"> </span><span class="n">transaction_id</span><span class="p">,</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">  </span><span class="c1">-- How do I test this data?</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">  </span><span class="c1">--   Validate that the `transaction_id` primary key values are both unique</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">  </span><span class="c1">--   and non-null. Data audit tests only run for the processed intervals,</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">  </span><span class="c1">--   not for the entire table.</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">  </span><span class="c1">-- audits (</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">  </span><span class="c1">--   UNIQUE_VALUES(columns = (transaction_id)),</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">  </span><span class="c1">--   NOT_NULL(columns = (transaction_id))</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">  </span><span class="c1">-- )</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="p">);</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="k">WITH</span><span class="w"> </span><span class="n">sales_data</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span><span class="n">transaction_id</span><span class="p">,</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">    </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">    </span><span class="n">transaction_amount</span><span class="p">,</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">    </span><span class="c1">-- How do I account for UTC vs. PST (California baby) timestamps?</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">    </span><span class="c1">--   Make sure all time columns are in UTC and convert them to PST in the</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="w">    </span><span class="c1">--   presentation layer downstream.</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="w">    </span><span class="n">transaction_timestamp</span><span class="p">,</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">    </span><span class="n">payment_method</span><span class="p">,</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="w">    </span><span class="n">currency</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">tcloud_raw_data</span><span class="p">.</span><span class="n">sales</span><span class="w">  </span><span class="c1">-- Source A: sales data</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">  </span><span class="c1">-- How do I make this run fast and only process the necessary intervals?</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">  </span><span class="c1">--   Use our date macros that will automatically run the necessary intervals.</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="w">  </span><span class="c1">--   Because Vulcan manages state, it will know what needs to run each time</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="w">  </span><span class="c1">--   you invoke `vulcan run`.</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">transaction_timestamp</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_dt</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_dt</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="p">),</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="n">product_usage</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="w">    </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="w">    </span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="w">    </span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a><span class="w">    </span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">    </span><span class="n">user_segment</span>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">tcloud_raw_data</span><span class="p">.</span><span class="n">product_usage</span><span class="w">  </span><span class="c1">-- Source B</span>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="w">  </span><span class="c1">-- Include usage data from the 30 days before the interval</span>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">last_usage_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="o">@</span><span class="n">start_dt</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_dt</span>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="p">)</span>
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="k">SELECT</span>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">,</span>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">transaction_amount</span><span class="p">,</span>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a><span class="w">  </span><span class="c1">-- Extract the date from the timestamp to partition by day</span>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a><span class="w">  </span><span class="nb">DATE</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">transaction_timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">transaction_date</span><span class="p">,</span>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a><span class="w">  </span><span class="c1">-- Convert timestamp to PST using a SQL function in the presentation layer for end users</span>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="w">  </span><span class="n">DATETIME</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">transaction_timestamp</span><span class="p">,</span><span class="w"> </span><span class="s1">'America/Los_Angeles'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">transaction_timestamp_pst</span><span class="p">,</span>
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">payment_method</span><span class="p">,</span>
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">currency</span><span class="p">,</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a><span class="w">  </span><span class="c1">-- Product usage metrics</span>
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">user_segment</span><span class="p">,</span>
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a><span class="w">  </span><span class="c1">-- Derived metrics</span>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="w">  </span><span class="k">CASE</span>
</span><span id="__span-1-86"><a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">feature_utilization_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-1-87"><a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-1-88"><a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">usage_count</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-1-89"><a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-1-90"><a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">user_type</span><span class="p">,</span>
</span><span id="__span-1-91"><a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a><span class="w">  </span><span class="c1">-- Time since last usage</span>
</span><span id="__span-1-92"><a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a><span class="w">  </span><span class="n">DATE_DIFF</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">transaction_timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">last_usage_date</span><span class="p">,</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">days_since_last_usage</span>
</span><span id="__span-1-93"><a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a><span class="k">FROM</span><span class="w"> </span><span class="n">sales_data</span><span class="w"> </span><span class="n">s</span>
</span><span id="__span-1-94"><a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">product_usage</span><span class="w"> </span><span class="n">p</span>
</span><span id="__span-1-95"><a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span>
</span><span id="__span-1-96"><a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">customer_id</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>50975949</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incrementals_demo__50975949</span><span class="o">`</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'We extract the date from the timestamp to partition by day'</span><span class="p">),</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Convert this to PST using a SQL function'</span><span class="p">),</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">  </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="n">FLOAT64</span><span class="p">,</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">  </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">  </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="w"> </span><span class="n">STRING</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Derived metrics'</span><span class="p">),</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">  </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="w"> </span><span class="k">OPTIONS</span><span class="w"> </span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Time since last usage'</span><span class="p">)</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">  </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will validate the SQL before processing data (note the <code>WHERE FALSE LIMIT 0</code> and the placeholder timestamps).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">WITH</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="k">FALSE</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="p">),</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">    </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1969-12-02 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="w">    </span><span class="k">FALSE</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="p">)</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="k">SELECT</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="w">  </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="w">  </span><span class="nb">DATE</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="w">  </span><span class="n">DATETIME</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="s1">'America/Los_Angeles'</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="w">  </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="w">  </span><span class="k">CASE</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a><span class="w">  </span><span class="n">DATE_DIFF</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AND</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="w">  </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">FALSE</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p>Vulcan will merge data into the empty table.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">MERGE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incrementals_demo__50975949</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">__MERGE_TARGET__</span><span class="o">`</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">      </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">      </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">      </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">      </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">      </span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">      </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">      </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">sales</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">sales</span><span class="o">`</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">      </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">      </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">      </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">      </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">      </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">      </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">tcloud_raw_data</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">),</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">'30'</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04 23:59:59.999999+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">)</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">    </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">    </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">    </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">    </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">    </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">    </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">    </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">    </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">    </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="w">      </span><span class="nb">DATE</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="w">      </span><span class="n">DATETIME</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="s1">'America/Los_Angeles'</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="w">      </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="w">      </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="w">      </span><span class="k">CASE</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="w">      </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="w">      </span><span class="n">DATE_DIFF</span><span class="p">(</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">transaction_timestamp</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">sales_data</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="o">`</span><span class="n">product_usage</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">__MERGE_SOURCE__</span><span class="o">`</span>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="k">ON</span><span class="w"> </span><span class="k">FALSE</span>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="k">WHEN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-25'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-11-04'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">DELETE</span>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="k">WHEN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a><span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a><span class="w">    </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="w">    </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-76"><a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-4-77"><a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="w">  </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-78"><a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">customer_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_amount</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">transaction_timestamp_pst</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-79"><a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="w">    </span><span class="o">`</span><span class="n">payment_method</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">currency</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">last_usage_date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">usage_count</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">feature_utilization_score</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_segment</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">user_type</span><span class="o">`</span><span class="p">,</span>
</span><span id="__span-4-80"><a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="w">    </span><span class="o">`</span><span class="n">days_since_last_usage</span><span class="o">`</span>
</span><span id="__span-4-81"><a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a><span class="w">  </span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer to pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">incrementals_demo</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incrementals_demo__50975949</span><span class="o">`</span>
</span></code></pre></div>
</details>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>A model's <code>time_column</code> should be in the <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC time zone</a> to ensure correct interaction with Vulcan's scheduler and predefined macro variables.</p>
<p>This requirement aligns with the data engineering best practice of converting datetime/timestamp columns to UTC as soon as they are ingested into the data system and only converting them to local timezones when they exit the system for downstream uses. The <code>cron_tz</code> flag <strong>does not</strong> change this requirement.</p>
<p>Placing all timezone conversion code in the system's first/last transformation models prevents inadvertent timezone-related errors as data flows between models.</p>
<p>If a model must use a different timezone, parameters like <a href="../overview/#lookback">lookback</a>, <a href="../overview/#allow_partials">allow_partials</a>, and <a href="../overview/#cron">cron</a> with offset time can be used to try to account for misalignment between the model's timezone and the UTC timezone used by Vulcan.</p>
</div>
<p>This example implements a complete <code>INCREMENTAL_BY_TIME_RANGE</code> model that specifies the time column name <code>event_date</code> in the <code>MODEL</code> DDL and includes a SQL <code>WHERE</code> clause to filter records by time range:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span></span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="hll"><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">event_date</span>
</span></span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="hll"><span class="w">  </span><span class="p">)</span>
</span></span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="p">);</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="k">SELECT</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">  </span><span class="n">event_date</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">event_date</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">  </span><span class="n">event_payload</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">payload</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="k">FROM</span><span class="w"> </span><span class="n">raw_events</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="hll"><span class="k">WHERE</span>
</span></span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="hll"><span class="w">  </span><span class="n">event_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span><span class="p">;</span>
</span></span></code></pre></div></td></tr></tbody></table></div>
<h3 id="time-column">Time column<a class="headerlink" href="#time-column" title="Permanent link"></a></h3>
<p>Vulcan needs to know which column in the model's output represents the timestamp or date associated with each record.</p>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>The <code>time_column</code> variable should be in the UTC time zone - learn more <a href="#timezones">above</a>.</p>
</div>
<p>The time column is used to determine which records will be overwritten during data <a href="../../plans/#restatement-plans">restatement</a> and provides a partition key for engines that support partitioning (such as Apache Spark). The name of the time column is specified in the <code>MODEL</code> DDL <code>kind</code> specification:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="hll"><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">event_date</span><span class="w"> </span><span class="c1">-- This model's time information is stored in the `event_date` column</span>
</span></span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>By default, Vulcan assumes the time column is in the <code>%Y-%m-%d</code> format. For other formats, the default can be overridden with a formatting string:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="hll"><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="p">(</span><span class="n">event_date</span><span class="p">,</span><span class="w"> </span><span class="s1">'%Y-%m-%d'</span><span class="p">)</span>
</span></span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The time format should be defined using the same SQL dialect as the one used to define the model's query.</p>
</div>
<p>Vulcan also uses the time column to automatically append a time range filter to the model's query at runtime, which prevents records that are not part of the target interval from being stored. This is a safety mechanism that prevents unintentionally overwriting unrelated records when handling late-arriving data.</p>
<p>The required filter you write in the model query's <code>WHERE</code> clause filters the <strong>input</strong> data as it is read from upstream tables, reducing the amount of data processed by the model. The automatically appended time range filter is applied to the model query's <strong>output</strong> data to prevent data leakage.</p>
<p>Consider the following model definition, which specifies a <code>WHERE</code> clause filter with the <code>receipt_date</code> column. The model's <code>time_column</code> is a different column <code>event_date</code>, whose filter is automatically added to the model query. This approach is useful when an upstream model's time column is different from the model's time column:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">event_date</span><span class="w"> </span><span class="c1">-- `event_date` is model's time column</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="p">);</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="k">SELECT</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">  </span><span class="n">event_date</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">event_date</span><span class="p">,</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">  </span><span class="n">event_payload</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">payload</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="k">FROM</span><span class="w"> </span><span class="n">raw_events</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="k">WHERE</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">  </span><span class="n">receipt_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Filter is based on the user-supplied `receipt_date` column</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>At runtime, Vulcan will automatically modify the model's query to look like this:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span>
<span class="normal"><a href="#__codelineno-11-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">SELECT</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">  </span><span class="n">event_date</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">event_date</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="n">event_payload</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">payload</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="k">FROM</span><span class="w"> </span><span class="n">raw_events</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="k">WHERE</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">  </span><span class="n">receipt_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="hll"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">event_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span><span class="p">;</span><span class="w"> </span><span class="c1">-- `event_date` time column filter automatically added by Vulcan</span>
</span></span></code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="partitioning">Partitioning<a class="headerlink" href="#partitioning" title="Permanent link"></a></h3>
<p>By default, we ensure that the <code>time_column</code> is part of the <a href="../overview/#partitioned_by">partitioned_by</a> property of the model so that it forms part of the partition key and allows the database engine to do partition pruning. If it is not explicitly listed in the Model definition, we will automatically add it.</p>
<p>However, this may be undesirable if you want to exclusively partition on another column or you want to partition on something like <code>month(time_column)</code> but the engine you're using doesnt support partitioning based on expressions.</p>
<p>To opt out of this behaviour, you can set <code>partition_by_time_column false</code> like so:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_TIME_RANGE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="n">time_column</span><span class="w"> </span><span class="n">event_date</span><span class="p">,</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="hll"><span class="w">    </span><span class="n">partition_by_time_column</span><span class="w"> </span><span class="k">false</span>
</span></span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="p">(</span><span class="n">other_col</span><span class="p">)</span><span class="w"> </span><span class="c1">-- event_date will no longer be automatically added here and the partition key will just be 'other_col'</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h3 id="idempotency">Idempotency<a class="headerlink" href="#idempotency" title="Permanent link"></a></h3>
<p>We recommend making sure incremental by time range model queries are <a href="../../glossary/#idempotency">idempotent</a> to prevent unexpected results during data <a href="../../plans/#restatement-plans">restatement</a>.</p>
<p>Note, however, that upstream models and tables can impact a model's idempotency. For example, referencing an upstream model of kind <a href="#full">FULL</a> in the model query automatically causes the model to be non-idempotent because its data could change on every model execution.</p>
<h3 id="materialization-strategy">Materialization strategy<a class="headerlink" href="#materialization-strategy" title="Permanent link"></a></h3>
<p>Depending on the target engine, models of the <code>INCREMENTAL_BY_TIME_RANGE</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spark</td>
<td>INSERT OVERWRITE by time column partition</td>
</tr>
<tr>
<td>Databricks</td>
<td>INSERT OVERWRITE by time column partition</td>
</tr>
<tr>
<td>Snowflake</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>BigQuery</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>Redshift</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>Postgres</td>
<td>DELETE by time range, then INSERT</td>
</tr>
<tr>
<td>DuckDB</td>
<td>DELETE by time range, then INSERT</td>
</tr>
</tbody>
</table>
<h2 id="incremental_by_unique_key">INCREMENTAL_BY_UNIQUE_KEY<a class="headerlink" href="#incremental_by_unique_key" title="Permanent link"></a></h2>
<p>Models of the <code>INCREMENTAL_BY_UNIQUE_KEY</code> kind are computed incrementally based on a key.</p>
<p>They insert or update rows based on these rules:</p>
<ul>
<li>If a key in newly loaded data is not present in the model table, the new data row is inserted.</li>
<li>If a key in newly loaded data is already present in the model table, the existing row is updated with the new data.</li>
<li>If a key is present in the model table but not present in the newly loaded data, its row is not modified and remains in the model table.</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Prevent duplicated keys</p>
<p>If you do not want duplicated keys in the model table, you must ensure the model query does not return rows with duplicate keys.</p>
<p>Vulcan does not automatically detect or prevent duplicates.</p>
</div>
<p>This kind is a good fit for datasets that have the following traits:</p>
<ul>
<li>Each record has a unique key associated with it.</li>
<li>There is at most one record associated with each unique key.</li>
<li>It is appropriate to upsert records, so existing records can be overwritten by new arrivals when their keys match.</li>
</ul>
<p>A <a href="../../glossary/#slowly-changing-dimension-scd">Slowly Changing Dimension</a> (SCD) is one approach that fits this description well. See the <a href="#scd-type-2">SCD Type 2</a> model kind for a specific model kind for SCD Type 2 models.</p>
<p>The name of the unique key column must be provided as part of the <code>MODEL</code> DDL, as in this example:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span></span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="hll"><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">name</span>
</span></span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="hll"><span class="w">  </span><span class="p">)</span>
</span></span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="p">);</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="k">SELECT</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">  </span><span class="n">name</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">  </span><span class="n">title</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">title</span><span class="p">,</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">  </span><span class="n">salary</span><span class="p">::</span><span class="nb">INT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">salary</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="k">FROM</span><span class="w"> </span><span class="n">raw_employees</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Composite keys are also supported:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="hll"><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">last_name</span><span class="p">)</span>
</span></span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p><code>INCREMENTAL_BY_UNIQUE_KEY</code> model kinds can also filter upstream records by time range using a SQL <code>WHERE</code> clause and the <code>@start_date</code>, <code>@end_date</code> or other macro variables (similar to the <a href="#incremental_by_time_range">INCREMENTAL_BY_TIME_RANGE</a> kind). Note that Vulcan macro time variables are in the UTC time zone.
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="k">SELECT</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">  </span><span class="n">name</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span><span class="n">title</span><span class="p">::</span><span class="nb">TEXT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">title</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span><span class="n">salary</span><span class="p">::</span><span class="nb">INT</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">salary</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="k">FROM</span><span class="w"> </span><span class="n">raw_employee_events</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="hll"><span class="k">WHERE</span>
</span></span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="hll"><span class="w">  </span><span class="n">event_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_date</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_date</span><span class="p">;</span>
</span></span></code></pre></div></td></tr></tbody></table></div><p></p>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_by_unique_key_example</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="k">start</span><span class="w"> </span><span class="s1">'2020-01-01'</span><span class="p">,</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">);</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="k">SELECT</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">  </span><span class="n">item_id</span><span class="p">,</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">  </span><span class="n">event_date</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="k">FROM</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">seed_model</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="k">WHERE</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">  </span><span class="n">event_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">@</span><span class="n">start_date</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_date</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>1161945221</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_by_unique_key_example__1161945221</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will validate the model's query before processing data (note the <code>FALSE LIMIT 0</code> in the <code>WHERE</code> statement and the placeholder dates).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_model__2834544882</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'1970-01-01'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">FALSE</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p>Vulcan will create a versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_by_unique_key_example__1161945221</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_model__2834544882</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2024-10-30'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">seed_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2020-01-01'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">incremental_by_unique_key_example</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_by_unique_key_example__1161945221</span><span class="o">`</span>
</span></code></pre></div>
</details>
<p><strong>Note:</strong> Models of the <code>INCREMENTAL_BY_UNIQUE_KEY</code> kind are inherently <a href="../../glossary/#idempotency">non-idempotent</a>, which should be taken into consideration during data <a href="../../plans/#restatement-plans">restatement</a>. As a result, partial data restatement is not supported for this model kind, which means that the entire table will be recreated from scratch if restated.</p>
<h3 id="unique-key-expressions">Unique Key Expressions<a class="headerlink" href="#unique-key-expressions" title="Permanent link"></a></h3>
<p>The <code>unique_key</code> values can either be column names or SQL expressions. For example, if you wanted to create a key that is based on the coalesce of a value then you could do the following:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span>
<span class="normal"><a href="#__codelineno-22-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span><span class="p">,</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="hll"><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="ss">"name"</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span>
</span></span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h3 id="when-matched-expression">When Matched Expression<a class="headerlink" href="#when-matched-expression" title="Permanent link"></a></h3>
<p>The logic to use when updating columns when a match occurs (the source and target match on the given keys) by default updates all the columns. This can be overriden with custom logic like below:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span>
<span class="normal"><a href="#__codelineno-23-5">5</a></span>
<span class="normal"><a href="#__codelineno-23-6">6</a></span>
<span class="normal"><a href="#__codelineno-23-7">7</a></span>
<span class="normal"><a href="#__codelineno-23-8">8</a></span>
<span class="normal"><a href="#__codelineno-23-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span><span class="p">,</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="hll"><span class="w">    </span><span class="n">when_matched</span><span class="w"> </span><span class="p">(</span>
</span></span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">source</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>The <code>source</code> and <code>target</code> aliases are required when using the <code>when_matched</code> expression in order to distinguish between the source and target columns.</p>
<p>Multiple <code>WHEN MATCHED</code> expressions can also be provided. Ex:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span><span class="p">,</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="hll"><span class="w">    </span><span class="n">when_matched</span><span class="w"> </span><span class="p">(</span>
</span></span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="hll"><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">source</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">source</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span>
</span></span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">source</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p><strong>Note</strong>: <code>when_matched</code> is only available on engines that support the <code>MERGE</code> statement. Currently supported engines include:</p>
<ul>
<li>BigQuery</li>
<li>Databricks</li>
<li>Postgres</li>
<li>Redshift</li>
<li>Snowflake</li>
<li>Spark</li>
</ul>
<p>In Redshift's case, to enable the use of the native <code>MERGE</code> statement, you need to pass the <code>enable_merge</code> flag in the connection and set it to <code>true</code>. It is disabled by default.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nt">gateways</span><span class="p">:</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">  </span><span class="nt">redshift</span><span class="p">:</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="nt">connection</span><span class="p">:</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redshift</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">      </span><span class="nt">enable_merge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Redshift supports only the <code>UPDATE</code> or <code>DELETE</code> actions for the <code>WHEN MATCHED</code> clause and does not allow multiple <code>WHEN MATCHED</code> expressions. For further information, refer to the <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_MERGE.html#r_MERGE-parameters">Redshift documentation</a>.</p>
<h3 id="merge-filter-expression">Merge Filter Expression<a class="headerlink" href="#merge-filter-expression" title="Permanent link"></a></h3>
<p>The <code>MERGE</code> statement typically induces a full table scan of the existing table, which can be problematic with large data volumes.</p>
<p>Prevent a full table scan by passing filtering conditions to the <code>merge_filter</code> parameter.</p>
<p>The <code>merge_filter</code> accepts a single or a conjunction of predicates to be used in the <code>ON</code> clause of the <code>MERGE</code> operation:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span>
<span class="normal"><a href="#__codelineno-26-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employee_contracts</span><span class="p">,</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_UNIQUE_KEY</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="hll"><span class="w">    </span><span class="n">merge_filter</span><span class="w"> </span><span class="k">source</span><span class="p">.</span><span class="n">_operation</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">contract_date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dateadd</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="k">current_date</span><span class="p">)</span>
</span></span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Similar to <code>when_matched</code>, the <code>source</code> and <code>target</code> aliases are used to distinguish between the source and target tables.</p>
<p>If an existing dbt project uses the <a href="https://docs.getdbt.com/docs/build/incremental-strategy#about-incremental_predicates">incremental_predicates</a> functionality, Vulcan will automatically convert them into the equivalent <code>merge_filter</code> specification.</p>
<h3 id="materialization-strategy_1">Materialization strategy<a class="headerlink" href="#materialization-strategy_1" title="Permanent link"></a></h3>
<p>Depending on the target engine, models of the <code>INCREMENTAL_BY_UNIQUE_KEY</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spark</td>
<td>not supported</td>
</tr>
<tr>
<td>Databricks</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>Snowflake</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>BigQuery</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>Redshift</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>Postgres</td>
<td>MERGE ON unique key</td>
</tr>
<tr>
<td>DuckDB</td>
<td>DELETE ON matched + INSERT new rows</td>
</tr>
</tbody>
</table>
<h2 id="full">FULL<a class="headerlink" href="#full" title="Permanent link"></a></h2>
<p>Models of the <code>FULL</code> kind cause the dataset associated with a model to be fully refreshed (rewritten) upon each model evaluation.</p>
<p>The <code>FULL</code> model kind is somewhat easier to use than incremental kinds due to the lack of special settings or additional query considerations. This makes it suitable for smaller datasets, where recomputing data from scratch is relatively cheap and doesn't require preservation of processing history. However, using this kind with datasets containing a large volume of records will result in significant runtime and compute costs.</p>
<p>This kind can be a good fit for aggregate tables that lack a temporal dimension. For aggregate tables with a temporal dimension, consider the <a href="#incremental_by_time_range">INCREMENTAL_BY_TIME_RANGE</a> kind instead.</p>
<p>This example specifies a <code>FULL</code> model kind:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">salary_by_title_agg</span><span class="p">,</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">FULL</span>
</span></span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="p">);</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="k">SELECT</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">  </span><span class="n">title</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="k">FROM</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">title</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">full_model_example</span><span class="p">,</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">FULL</span><span class="p">,</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">  </span><span class="n">grain</span><span class="w"> </span><span class="n">item_id</span><span class="p">,</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="p">);</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="k">SELECT</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">  </span><span class="n">item_id</span><span class="p">,</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_orders</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="k">FROM</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_model</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">  </span><span class="n">item_id</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>2345651858</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__full_model_example__2345651858</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will validate the model's query before processing data (note the <code>WHERE FALSE</code> and <code>LIMIT 0</code>).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_model__89556012</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">FALSE</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p>Vulcan will create a versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__full_model_example__2345651858</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">num_orders</span><span class="o">`</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__incremental_model__89556012</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">`</span><span class="n">incremental_model</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">full_model_example</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__full_model_example__2345651858</span><span class="o">`</span>
</span></code></pre></div>
</details>
<h3 id="materialization-strategy_2">Materialization strategy<a class="headerlink" href="#materialization-strategy_2" title="Permanent link"></a></h3>
<p>Depending on the target engine, models of the <code>FULL</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spark</td>
<td>INSERT OVERWRITE</td>
</tr>
<tr>
<td>Databricks</td>
<td>INSERT OVERWRITE</td>
</tr>
<tr>
<td>Snowflake</td>
<td>CREATE OR REPLACE TABLE</td>
</tr>
<tr>
<td>BigQuery</td>
<td>CREATE OR REPLACE TABLE</td>
</tr>
<tr>
<td>Redshift</td>
<td>DROP TABLE, CREATE TABLE, INSERT</td>
</tr>
<tr>
<td>Postgres</td>
<td>DROP TABLE, CREATE TABLE, INSERT</td>
</tr>
<tr>
<td>DuckDB</td>
<td>CREATE OR REPLACE TABLE</td>
</tr>
</tbody>
</table>
<h2 id="view">VIEW<a class="headerlink" href="#view" title="Permanent link"></a></h2>
<p>The model kinds described so far cause the output of a model query to be materialized and stored in a physical table.</p>
<p>The <code>VIEW</code> kind is different, because no data is actually written during model execution. Instead, a non-materialized view (or "virtual table") is created or replaced based on the model's query.</p>
<p><strong>Note:</strong> <code>VIEW</code> is the default model kind if kind is not specified.</p>
<p><strong>Note:</strong> Python models do not support the <code>VIEW</code> model kind - use a SQL model instead.</p>
<p><strong>Note:</strong> With this kind, the model's query is evaluated every time the model is referenced in a downstream query. This may incur undesirable compute cost and time in cases where the model's query is compute-intensive, or when the model is referenced in many downstream queries.</p>
<p>This example specifies a <code>VIEW</code> model kind:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span>
<span class="normal"><a href="#__codelineno-34-5">5</a></span>
<span class="normal"><a href="#__codelineno-34-6">6</a></span>
<span class="normal"><a href="#__codelineno-34-7">7</a></span>
<span class="normal"><a href="#__codelineno-34-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">highest_salary</span><span class="p">,</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">VIEW</span>
</span></span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="p">);</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="k">SELECT</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">  </span><span class="k">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">example_view</span><span class="p">,</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">VIEW</span><span class="p">,</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">  </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span><span class="p">,</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="p">);</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="k">SELECT</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">  </span><span class="s1">'hello there'</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a_column</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned view in the physical layer. Note that the view's version fingerprint, <code>1024042926</code>, is part of the view name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__example_view__1024042926</span><span class="o">`</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="p">(</span><span class="o">`</span><span class="n">a_column</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">'hello there'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">a_column</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned view in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">example_view</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__example_view__1024042926</span><span class="o">`</span>
</span></code></pre></div>
</details>
<h3 id="materialized-views">Materialized Views<a class="headerlink" href="#materialized-views" title="Permanent link"></a></h3>
<p>The <code>VIEW</code> model kind can be configured to represent a materialized view by setting the <code>materialized</code> flag to <code>true</code>:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span>
<span class="normal"><a href="#__codelineno-39-4">4</a></span>
<span class="normal"><a href="#__codelineno-39-5">5</a></span>
<span class="normal"><a href="#__codelineno-39-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">highest_salary</span><span class="p">,</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="hll"><span class="w">    </span><span class="n">materialized</span><span class="w"> </span><span class="k">true</span>
</span></span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p><strong>Note:</strong> This flag only applies to engines that support materialized views and is ignored by other engines. Supported engines include:</p>
<ul>
<li>BigQuery</li>
<li>Databricks</li>
<li>Snowflake</li>
</ul>
<p>During the evaluation of a model of this kind, the view will be replaced or recreated only if the model's query rendered during evaluation does not match the query used during the previous view creation for this model, or if the target view does not exist. Thus, views are recreated only when necessary in order to realize all the benefits provided by materialized views.</p>
<h2 id="embedded">EMBEDDED<a class="headerlink" href="#embedded" title="Permanent link"></a></h2>
<p>Embedded models are a way to share common logic between different models of other kinds.</p>
<p>There are no data assets (tables or views) associated with <code>EMBEDDED</code> models in the data warehouse. Instead, an <code>EMBEDDED</code> model's query is injected directly into the query of each downstream model that references it, as a subquery.</p>
<p><strong>Note:</strong> Python models do not support the <code>EMBEDDED</code> model kind - use a SQL model instead.</p>
<p>This example specifies a <code>EMBEDDED</code> model kind:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span>
<span class="normal"><a href="#__codelineno-40-5">5</a></span>
<span class="normal"><a href="#__codelineno-40-6">6</a></span>
<span class="normal"><a href="#__codelineno-40-7">7</a></span>
<span class="normal"><a href="#__codelineno-40-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">unique_employees</span><span class="p">,</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">EMBEDDED</span>
</span></span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="p">);</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5"></a>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">  </span><span class="n">name</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">employees</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<h2 id="seed">SEED<a class="headerlink" href="#seed" title="Permanent link"></a></h2>
<p>The <code>SEED</code> model kind is used to specify <a href="../seed_models/">seed models</a> for using static CSV datasets in your Vulcan project.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Seed models are loaded only once unless the SQL model and/or seed file is updated.</li>
<li>Python models do not support the <code>SEED</code> model kind - use a SQL model instead.</li>
</ul>
<details>
<summary>Example SQL sequence when applying this model kind (ex: BigQuery)</summary>
<p>Create a model with the following definition and run <code>vulcan plan dev</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">seed_example</span><span class="p">,</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SEED</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span><span class="n">path</span><span class="w"> </span><span class="s1">'../../seeds/seed_example.csv'</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="n">columns</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">    </span><span class="n">item_id</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">    </span><span class="n">event_date</span><span class="w"> </span><span class="nb">DATE</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="p">),</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">  </span><span class="n">grain</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">event_date</span><span class="p">)</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will execute this SQL to create a versioned table in the physical layer. Note that the table's version fingerprint, <code>3038173937</code>, is part of the table name.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_example__3038173937</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="n">INT64</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span>
</span></code></pre></div>
<p>Vulcan will upload the seed as a temp table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">vulcan__demo</span><span class="p">.</span><span class="n">__temp_demo__seed_example__3038173937_9kzbpld7</span>
</span></code></pre></div>
<p>Vulcan will create a versioned table in the physical layer from the temp table.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_example__3038173937</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INT64</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">item_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">event_date</span><span class="o">`</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">__temp_demo__seed_example__3038173937_9kzbpld7</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">_subquery</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will drop the temp table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">__temp_demo__seed_example__3038173937_9kzbpld7</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a suffixed <code>__dev</code> schema based on the name of the plan environment.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span>
</span></code></pre></div>
<p>Vulcan will create a view in the virtual layer pointing to the versioned table in the physical layer.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__dev</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">seed_example</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">vulcan__demo</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">demo__seed_example__3038173937</span><span class="o">`</span>
</span></code></pre></div>
</details>
<h2 id="scd-type-2">SCD Type 2<a class="headerlink" href="#scd-type-2" title="Permanent link"></a></h2>
<p>SCD Type 2 is a model kind that supports <a href="https://en.wikipedia.org/wiki/Slowly_changing_dimension#Type_2:_add_new_row">slowly changing dimensions</a> (SCDs) in your Vulcan project. SCDs are a common pattern in data warehousing that allow you to track changes to records over time.</p>
<p>Vulcan achieves this by adding a <code>valid_from</code> and <code>valid_to</code> column to your model. The <code>valid_from</code> column is the timestamp that the record became valid (inclusive) and the <code>valid_to</code> column is the timestamp that the record became invalid (exclusive). The <code>valid_to</code> column is set to <code>NULL</code> for the latest record.</p>
<p>Therefore, you can use these models to not only tell you what the latest value is for a given record but also what the values were anytime in the past. Note that maintaining this history does come at a cost of increased storage and compute and this may not be a good fit for sources that change frequently since the history could get very large.</p>
<p><strong>Note</strong>: Partial data <a href="../../plans/#restatement-plans">restatement</a> is not supported for this model kind, which means that the entire table will be recreated from scratch if restated. This may lead to data loss, so data restatement is disabled for models of this kind by default.</p>
<p>There are two ways to tracking changes: By Time (Recommended) or By Column.</p>
<h3 id="scd-type-2-by-time-recommended">SCD Type 2 By Time (Recommended)<a class="headerlink" href="#scd-type-2-by-time-recommended" title="Permanent link"></a></h3>
<p>SCD Type 2 By Time supports sourcing from tables that have an "Updated At" timestamp defined in the table that tells you when a given record was last updated.
This is the recommended way since this "Updated At" gives you a precise time when the record was last updated and therefore improves the accuracy of the SCD Type 2 table that is produced.</p>
<p>This example specifies a <code>SCD_TYPE_2_BY_TIME</code> model kind:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span></span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="p">);</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7"></a>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="k">SELECT</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="w">  </span><span class="n">id</span><span class="p">::</span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="w">  </span><span class="n">name</span><span class="p">::</span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11"></a><span class="w">  </span><span class="n">price</span><span class="p">::</span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12"></a><span class="w">  </span><span class="n">updated_at</span><span class="p">::</span><span class="k">TIMESTAMP</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13"></a><span class="k">FROM</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="w">  </span><span class="n">stg</span><span class="p">.</span><span class="n">current_menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span>
<span class="normal"><a href="#__codelineno-49-4">4</a></span>
<span class="normal"><a href="#__codelineno-49-5">5</a></span>
<span class="normal"><a href="#__codelineno-49-6">6</a></span>
<span class="normal"><a href="#__codelineno-49-7">7</a></span>
<span class="normal"><a href="#__codelineno-49-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>The <code>updated_at</code> column name can also be changed by adding the following to your model definition:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="hll"><span class="w">    </span><span class="n">updated_at_name</span><span class="w"> </span><span class="n">my_updated_at</span><span class="w"> </span><span class="c1">-- Name for `updated_at` column</span>
</span></span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="p">);</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8"></a>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="k">SELECT</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="w">  </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="w">  </span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="w">  </span><span class="n">my_updated_at</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="k">FROM</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15"></a><span class="w">  </span><span class="n">stg</span><span class="p">.</span><span class="n">current_menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span>
<span class="normal"><a href="#__codelineno-51-2">2</a></span>
<span class="normal"><a href="#__codelineno-51-3">3</a></span>
<span class="normal"><a href="#__codelineno-51-4">4</a></span>
<span class="normal"><a href="#__codelineno-51-5">5</a></span>
<span class="normal"><a href="#__codelineno-51-6">6</a></span>
<span class="normal"><a href="#__codelineno-51-7">7</a></span>
<span class="normal"><a href="#__codelineno-51-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="w">  </span><span class="n">my_updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="scd-type-2-by-column">SCD Type 2 By Column<a class="headerlink" href="#scd-type-2-by-column" title="Permanent link"></a></h3>
<p>SCD Type 2 By Column supports sourcing from tables that do not have an "Updated At" timestamp defined in the table.
Instead, it will check the columns defined in the <code>columns</code> field to see if their value has changed and if so it will record the <code>valid_from</code> time as the execution time when the change was detected.</p>
<p>This example specifies a <code>SCD_TYPE_2_BY_COLUMN</code> model kind:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_COLUMN</span><span class="w"> </span><span class="p">(</span>
</span></span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="w">    </span><span class="n">columns</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">]</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="p">);</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8"></a>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="k">SELECT</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10"></a><span class="w">  </span><span class="n">id</span><span class="p">::</span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="w">  </span><span class="n">name</span><span class="p">::</span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="w">  </span><span class="n">price</span><span class="p">::</span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13"></a><span class="k">FROM</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14"></a><span class="w">  </span><span class="n">stg</span><span class="p">.</span><span class="n">current_menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span>
<span class="normal"><a href="#__codelineno-53-3">3</a></span>
<span class="normal"><a href="#__codelineno-53-4">4</a></span>
<span class="normal"><a href="#__codelineno-53-5">5</a></span>
<span class="normal"><a href="#__codelineno-53-6">6</a></span>
<span class="normal"><a href="#__codelineno-53-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="w">  </span><span class="n">valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="change-column-names">Change Column Names<a class="headerlink" href="#change-column-names" title="Permanent link"></a></h3>
<p>Vulcan will automatically add the <code>valid_from</code> and <code>valid_to</code> columns to your table.
If you would like to specify the names of these columns you can do so by adding the following to your model definition:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span>
<span class="normal"><a href="#__codelineno-54-5">5</a></span>
<span class="normal"><a href="#__codelineno-54-6">6</a></span>
<span class="normal"><a href="#__codelineno-54-7">7</a></span>
<span class="normal"><a href="#__codelineno-54-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="hll"><span class="w">    </span><span class="n">valid_from_name</span><span class="w"> </span><span class="n">my_valid_from</span><span class="p">,</span><span class="w"> </span><span class="c1">-- Name for `valid_from` column</span>
</span></span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="hll"><span class="w">    </span><span class="n">valid_to_name</span><span class="w"> </span><span class="n">my_valid_to</span><span class="w"> </span><span class="c1">-- Name for `valid_to` column</span>
</span></span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Vulcan will materialize this table with the following structure:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span>
<span class="normal"><a href="#__codelineno-55-4">4</a></span>
<span class="normal"><a href="#__codelineno-55-5">5</a></span>
<span class="normal"><a href="#__codelineno-55-6">6</a></span>
<span class="normal"><a href="#__codelineno-55-7">7</a></span>
<span class="normal"><a href="#__codelineno-55-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="k">TABLE</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="w">  </span><span class="n">my_valid_from</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="w">  </span><span class="n">my_valid_to</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="deletes">Deletes<a class="headerlink" href="#deletes" title="Permanent link"></a></h3>
<p>A hard delete is when a record no longer exists in the source table. When this happens,</p>
<p>If <code>invalidate_hard_deletes</code> is set to <code>false</code> (default):</p>
<ul>
<li><code>valid_to</code> column will continue to be set to <code>NULL</code> (therefore still considered "valid")</li>
<li>If the record is added back, then the <code>valid_to</code> column will be set to the <code>valid_from</code> of the new record.</li>
</ul>
<p>When a record is added back, the new record will be inserted into the table with <code>valid_from</code> set to:</p>
<ul>
<li>SCD_TYPE_2_BY_TIME: the largest of either the <code>updated_at</code> timestamp of the new record or the <code>valid_from</code> timestamp of the deleted record in the SCD Type 2 table</li>
<li>SCD_TYPE_2_BY_COLUMN: the <code>execution_time</code> when the record was detected again</li>
</ul>
<p>If <code>invalidate_hard_deletes</code> is set to <code>true</code>:</p>
<ul>
<li><code>valid_to</code> column will be set to the time when the Vulcan run started that detected the missing record (called <code>execution_time</code>).</li>
<li>If the record is added back, then the <code>valid_to</code> column will remain unchanged.</li>
</ul>
<p>One way to think about <code>invalidate_hard_deletes</code> is that, if <code>invalidate_hard_deletes</code> is set to <code>true</code>, deletes are most accurately tracked in the SCD Type 2 table since it records when the delete occurred.
As a result though, you can have gaps between records if the there is a gap of time between when it was deleted and added back.
If you would prefer to not have gaps, and a result consider missing records in source as still "valid", then you can leave the default value or set <code>invalidate_hard_deletes</code> to <code>false</code>.</p>
<h3 id="example-of-scd-type-2-by-time-in-action">Example of SCD Type 2 By Time in Action<a class="headerlink" href="#example-of-scd-type-2-by-time-in-action" title="Permanent link"></a></h3>
<p>Lets say that you started with the following data in your source table and <code>invalidate_hard_deletes</code> is set to <code>true</code>:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
</tbody>
</table>
<p>The target table, which is currently empty, will be materialized with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>Now lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
</tbody>
</table>
<p>Summary of Changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $10.99 to $12.99.</li>
<li>Cheeseburger was removed from the menu.</li>
<li>Milkshakes were added to the menu.</li>
</ul>
<p>Assuming your pipeline ran at <code>2020-01-02 11:00:00</code>, target table will be updated with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>For our final pass, lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
</tbody>
</table>
<p>Summary of changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $12.99 to $14.99 (must be good!)</li>
<li>Cheeseburger was added back to the menu with original name and price.</li>
<li>Milkshake name was updated to be "Chocolate Milkshake".</li>
</ul>
<p>Target table will be updated with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Updated At</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">2020-01-01 00:00:00</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-02 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">2020-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> <code>Cheeseburger</code> was deleted from <code>2020-01-02 11:00:00</code> to <code>2020-01-03 00:00:00</code> meaning if you queried the table during that time range then you would not see <code>Cheeseburger</code> in the menu.
This is the most accurate representation of the menu based on the source data provided.
If <code>Cheeseburger</code> were added back to the menu with it's original updated at timestamp of <code>2020-01-01 00:00:00</code> then the <code>valid_from</code> timestamp of the new record would have been <code>2020-01-02 11:00:00</code> resulting in no period of time where the item was deleted.
Since in this case the updated at timestamp did not change it is likely the item was removed in error and this again most accurately represents the menu based on the source data.</p>
<h3 id="example-of-scd-type-2-by-column-in-action">Example of SCD Type 2 By Column in Action<a class="headerlink" href="#example-of-scd-type-2-by-column-in-action" title="Permanent link"></a></h3>
<p>Lets say that you started with the following data in your source table and <code>invalidate_hard_deletes</code> is set to <code>true</code>:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
</tr>
</tbody>
</table>
<p>We configure the SCD Type 2 By Column model to check the columns <code>Name</code> and <code>Price</code> for changes</p>
<p>The target table, which is currently empty, will be materialized with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>Now lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
</tr>
</tbody>
</table>
<p>Summary of Changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $10.99 to $12.99.</li>
<li>Cheeseburger was removed from the menu.</li>
<li>Milkshakes were added to the menu.</li>
</ul>
<p>Assuming your pipeline ran at <code>2020-01-02 11:00:00</code>, target table will be updated with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p>For our final pass, lets say that you update the source table with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
</tr>
</tbody>
</table>
<p>Summary of changes:</p>
<ul>
<li>The price of the Chicken Sandwich was increased from $12.99 to $14.99 (must be good!)</li>
<li>Cheeseburger was added back to the menu with original name and price.</li>
<li>Milkshake name was updated to be "Chocolate Milkshake".</li>
</ul>
<p>Assuming your pipeline ran at <code>2020-01-03 11:00:00</code>, Target table will be updated with the following data:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Valid From</th>
<th style="text-align: center;">Valid To</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">10.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">12.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
</tr>
<tr>
<td>1</td>
<td>Chicken Sandwich</td>
<td style="text-align: center;">14.99</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
</tr>
<tr>
<td>2</td>
<td>Cheeseburger</td>
<td style="text-align: center;">8.99</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>3</td>
<td>French Fries</td>
<td style="text-align: center;">4.99</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
<tr>
<td>4</td>
<td>Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-02 11:00:00</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
</tr>
<tr>
<td>4</td>
<td>Chocolate Milkshake</td>
<td style="text-align: center;">3.99</td>
<td style="text-align: center;">2020-01-03 11:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> <code>Cheeseburger</code> was deleted from <code>2020-01-02 11:00:00</code> to <code>2020-01-03 11:00:00</code> meaning if you queried the table during that time range then you would not see <code>Cheeseburger</code> in the menu.
This is the most accurate representation of the menu based on the source data provided.</p>
<h3 id="shared-configuration-options">Shared Configuration Options<a class="headerlink" href="#shared-configuration-options" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>unique_key</td>
<td>Unique key used for identifying rows between source and target</td>
<td>List of strings or string</td>
</tr>
<tr>
<td>valid_from_name</td>
<td>The name of the <code>valid_from</code> column to create in the target table. Default: <code>valid_from</code></td>
<td>string</td>
</tr>
<tr>
<td>valid_to_name</td>
<td>The name of the <code>valid_to</code> column to create in the target table. Default: <code>valid_to</code></td>
<td>string</td>
</tr>
<tr>
<td>invalidate_hard_deletes</td>
<td>If set to <code>true</code>, when a record is missing from the source table it will be marked as invalid. Default: <code>false</code></td>
<td>bool</td>
</tr>
<tr>
<td>batch_size</td>
<td>The maximum number of intervals that can be evaluated in a single backfill task. If this is <code>None</code>, all intervals will be processed as part of a single task. See <a href="#processing-source-table-with-historical-data">Processing Source Table with Historical Data</a> for more info on this use case. (Default: <code>None</code>)</td>
<td>int</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>If using BigQuery, the default data type of the valid_from/valid_to columns is DATETIME. If you want to use TIMESTAMP, you can specify the data type in the model definition.</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span>
<span class="normal"><a href="#__codelineno-56-3">3</a></span>
<span class="normal"><a href="#__codelineno-56-4">4</a></span>
<span class="normal"><a href="#__codelineno-56-5">5</a></span>
<span class="normal"><a href="#__codelineno-56-6">6</a></span>
<span class="normal"><a href="#__codelineno-56-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="hll"><span class="w">    </span><span class="n">time_data_type</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span></span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>This could likely be used on other engines to change the expected data type but has only been tested on BigQuery.</p>
</div>
<h3 id="scd-type-2-by-time-configuration-options">SCD Type 2 By Time Configuration Options<a class="headerlink" href="#scd-type-2-by-time-configuration-options" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>updated_at_name</td>
<td>The name of the column containing a timestamp to check for new or updated records. Default: <code>updated_at</code></td>
<td>string</td>
</tr>
<tr>
<td>updated_at_as_valid_from</td>
<td>By default, for new rows <code>valid_from</code> is set to <code>1970-01-01 00:00:00</code>. This changes the behavior to set it to the valid of <code>updated_at</code> when the row is inserted. Default: <code>false</code></td>
<td>bool</td>
</tr>
</tbody>
</table>
<h3 id="scd-type-2-by-column-configuration-options">SCD Type 2 By Column Configuration Options<a class="headerlink" href="#scd-type-2-by-column-configuration-options" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>columns</td>
<td>The name of the columns to check for changes. <code>*</code> to represent that all columns should be checked.</td>
<td>List of strings or string</td>
</tr>
<tr>
<td>execution_time_as_valid_from</td>
<td>By default, when the model is first loaded <code>valid_from</code> is set to <code>1970-01-01 00:00:00</code> and future new rows will have <code>execution_time</code> of when the pipeline ran. This changes the behavior to always use <code>execution_time</code>. Default: <code>false</code></td>
<td>bool</td>
</tr>
<tr>
<td>updated_at_name</td>
<td>If sourcing from a table that includes as timestamp to use as valid_from, set this property to that column. See <a href="#processing-source-table-with-historical-data">Processing Source Table with Historical Data</a> for more info on this use case. (Default: <code>None</code>)</td>
<td>int</td>
</tr>
</tbody>
</table>
<h3 id="processing-source-table-with-historical-data">Processing Source Table with Historical Data<a class="headerlink" href="#processing-source-table-with-historical-data" title="Permanent link"></a></h3>
<p>The most common case for SCD Type 2 is creating history for a table that it doesn't have it already. 
In the example of the restaurant menu, the menu just tells you what is offered right now, but you want to know what was offered over time.
In this case, the default setting of <code>None</code> for <code>batch_size</code> is the best option.</p>
<p>Another use case though is processing a source table that already has history in it. 
A common example of this is a "daily snapshot" table that is created by a source system that takes a snapshot of the data at the end of each day.
If your source table has historical records, like a "daily snapshot" table, then set <code>batch_size</code> to <code>1</code> to process each interval (each day if a <code>@daily</code> cron) in sequential order.
That way the historical records will be properly captured in the SCD Type 2 table.</p>
<h4 id="example-source-from-daily-snapshot-table">Example - Source from Daily Snapshot Table<a class="headerlink" href="#example-source-from-daily-snapshot-table" title="Permanent link"></a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span>
<span class="normal"><a href="#__codelineno-57-18">18</a></span>
<span class="normal"><a href="#__codelineno-57-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="k">table</span><span class="p">,</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="w">    </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_COLUMN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="w">        </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="w">        </span><span class="n">columns</span><span class="w"> </span><span class="p">[</span><span class="n">some_value</span><span class="p">],</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="w">        </span><span class="n">updated_at_name</span><span class="w"> </span><span class="n">ds</span><span class="p">,</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="w">        </span><span class="n">batch_size</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="w">    </span><span class="k">start</span><span class="w"> </span><span class="s1">'2025-01-01'</span><span class="p">,</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="w">    </span><span class="n">cron</span><span class="w"> </span><span class="s1">'@daily'</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="p">);</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="k">SELECT</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13"></a><span class="w">    </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="w">    </span><span class="n">some_value</span><span class="p">,</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="w">    </span><span class="n">ds</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16"></a><span class="k">FROM</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="w">    </span><span class="n">source_table</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18"></a><span class="k">WHERE</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19"></a><span class="w">    </span><span class="n">ds</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="o">@</span><span class="n">start_ds</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">@</span><span class="n">end_ds</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>This will process each day of the source table in sequential order (if more than one day to process), checking <code>some_value</code> column to see if it changed. If it did change, <code>valid_from</code> will be set to match the <code>ds</code> column (except for first value which would be <code>1970-01-01 00:00:00</code>).</p>
<p>If the source data was the following:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>some_value</th>
<th style="text-align: center;">ds</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td style="text-align: center;">2025-01-01</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td style="text-align: center;">2025-01-02</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td style="text-align: center;">2025-01-03</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td style="text-align: center;">2025-01-04</td>
</tr>
</tbody>
</table>
<p>Then the resulting SCD Type 2 table would be:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>some_value</th>
<th style="text-align: center;">ds</th>
<th style="text-align: center;">valid_from</th>
<th style="text-align: center;">valid_to</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td style="text-align: center;">2025-01-01</td>
<td style="text-align: center;">1970-01-01 00:00:00</td>
<td style="text-align: center;">2025-01-02 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td style="text-align: center;">2025-01-02</td>
<td style="text-align: center;">2025-01-02 00:00:00</td>
<td style="text-align: center;">2025-01-03 00:00:00</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td style="text-align: center;">2025-01-03</td>
<td style="text-align: center;">2025-01-03 00:00:00</td>
<td style="text-align: center;">NULL</td>
</tr>
</tbody>
</table>
<h3 id="querying-scd-type-2-models">Querying SCD Type 2 Models<a class="headerlink" href="#querying-scd-type-2-models" title="Permanent link"></a></h3>
<h4 id="querying-the-current-version-of-a-record">Querying the current version of a record<a class="headerlink" href="#querying-the-current-version-of-a-record" title="Permanent link"></a></h4>
<p>Although SCD Type 2 models support history, it is still very easy to query for just the latest version of a record. Simply query the model as you would any other table.
For example, if you wanted to query the latest version of the <code>menu_items</code> table you would simply run:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span>
<span class="normal"><a href="#__codelineno-58-4">4</a></span>
<span class="normal"><a href="#__codelineno-58-5">5</a></span>
<span class="normal"><a href="#__codelineno-58-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="k">SELECT</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="w">  </span><span class="o">*</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="k">FROM</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="k">WHERE</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>One could also create a view on top of the SCD Type 2 model that creates a new <code>is_current</code> column to make it easy for consumers to identify the current record.</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span>
<span class="normal"><a href="#__codelineno-59-3">3</a></span>
<span class="normal"><a href="#__codelineno-59-4">4</a></span>
<span class="normal"><a href="#__codelineno-59-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">SELECT</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="w">  </span><span class="o">*</span><span class="p">,</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_current</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="k">FROM</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="w">  </span><span class="n">menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h4 id="querying-for-a-specific-version-of-a-record-at-a-give-point-in-time">Querying for a specific version of a record at a give point in time<a class="headerlink" href="#querying-for-a-specific-version-of-a-record-at-a-give-point-in-time" title="Permanent link"></a></h4>
<p>If you wanted to query the <code>menu_items</code> table as it was on <code>2020-01-02 01:00:00</code> you would simply run:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span>
<span class="normal"><a href="#__codelineno-60-5">5</a></span>
<span class="normal"><a href="#__codelineno-60-6">6</a></span>
<span class="normal"><a href="#__codelineno-60-7">7</a></span>
<span class="normal"><a href="#__codelineno-60-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="k">SELECT</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="w">  </span><span class="o">*</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="k">FROM</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="k">WHERE</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="s1">'2020-01-02 01:00:00'</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">valid_from</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="s1">'2020-01-02 01:00:00'</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2199-12-31 23:59:59+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">));</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Example in a join:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span>
<span class="normal"><a href="#__codelineno-61-2">2</a></span>
<span class="normal"><a href="#__codelineno-61-3">3</a></span>
<span class="normal"><a href="#__codelineno-61-4">4</a></span>
<span class="normal"><a href="#__codelineno-61-5">5</a></span>
<span class="normal"><a href="#__codelineno-61-6">6</a></span>
<span class="normal"><a href="#__codelineno-61-7">7</a></span>
<span class="normal"><a href="#__codelineno-61-8">8</a></span>
<span class="normal"><a href="#__codelineno-61-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="k">SELECT</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="w">  </span><span class="o">*</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="k">FROM</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">  </span><span class="n">orders</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">menu_item_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menu_items</span><span class="p">.</span><span class="n">id</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">menu_items</span><span class="p">.</span><span class="n">valid_from</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">menu_items</span><span class="p">.</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2199-12-31 23:59:59+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">));</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>A view can be created to do the <code>COALESCE</code> automatically. This, combined with the <code>is_current</code> flag, makes it easier to query for a specific version of a record.</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="k">SELECT</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="w">  </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="w">  </span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="p">,</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="p">,</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2199-12-31 23:59:59+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">valid_to</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_current</span><span class="p">,</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="k">FROM</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10"></a><span class="w">  </span><span class="n">menu_items</span><span class="p">;</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Furthermore if you want to make it so users can use <code>BETWEEN</code> when querying by making <code>valid_to</code> inclusive you can do the following:
</p><div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span>
<span class="normal"><a href="#__codelineno-63-2">2</a></span>
<span class="normal"><a href="#__codelineno-63-3">3</a></span>
<span class="normal"><a href="#__codelineno-63-4">4</a></span>
<span class="normal"><a href="#__codelineno-63-5">5</a></span>
<span class="normal"><a href="#__codelineno-63-6">6</a></span>
<span class="normal"><a href="#__codelineno-63-7">7</a></span>
<span class="normal"><a href="#__codelineno-63-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="k">SELECT</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="w">  </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="w">  </span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="w">  </span><span class="n">updated_at</span><span class="p">,</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="w">  </span><span class="n">valid_from</span><span class="p">,</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">valid_to</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">'2200-01-01 00:00:00+00:00'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">SECOND</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">valid_to</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="w">  </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_current</span><span class="p">,</span>
</span></code></pre></div></td></tr></tbody></table></div><p></p>
<p>Note: The precision of the timestamps in this example is second so I subtract 1 second. Make sure to subtract a value equal to the precision of your timestamps.</p>
<h4 id="querying-for-deleted-records">Querying for deleted records<a class="headerlink" href="#querying-for-deleted-records" title="Permanent link"></a></h4>
<p>One way to identify deleted records is to query for records that do not have a <code>valid_to</code> record of <code>NULL</code>. For example, if you wanted to query for all deleted ids in the <code>menu_items</code> table you would simply run:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span>
<span class="normal"><a href="#__codelineno-64-4">4</a></span>
<span class="normal"><a href="#__codelineno-64-5">5</a></span>
<span class="normal"><a href="#__codelineno-64-6">6</a></span>
<span class="normal"><a href="#__codelineno-64-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="k">SELECT</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="w">  </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="w">  </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">valid_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_deleted</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="k">FROM</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="w">  </span><span class="n">menu_items</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7"></a><span class="w">  </span><span class="n">id</span>
</span></code></pre></div></td></tr></tbody></table></div>
<h3 id="reset-scd-type-2-model-clearing-history">Reset SCD Type 2 Model (clearing history)<a class="headerlink" href="#reset-scd-type-2-model-clearing-history" title="Permanent link"></a></h3>
<p>SCD Type 2 models are designed by default to protect the data that has been captured because it is not possible to recreate the history once it has been lost.
However, there are cases where you may want to clear the history and start fresh.
For this use use case you will want to start by setting <code>disable_restatement</code> to <code>false</code> in the model definition.</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span>
<span class="normal"><a href="#__codelineno-65-3">3</a></span>
<span class="normal"><a href="#__codelineno-65-4">4</a></span>
<span class="normal"><a href="#__codelineno-65-5">5</a></span>
<span class="normal"><a href="#__codelineno-65-6">6</a></span>
<span class="normal"><a href="#__codelineno-65-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="hll"><span class="w">    </span><span class="n">disable_restatement</span><span class="w"> </span><span class="k">false</span>
</span></span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Plan/apply this change to production.
Then you will want to <a href="../../plans/#restatement-plans">restate the model</a>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>vulcan<span class="w"> </span>plan<span class="w"> </span>--restate-model<span class="w"> </span>db.menu_items
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This will remove the historical data on the model which in most situations cannot be recovered.</p>
</div>
<p>Once complete you will want to remove <code>disable_restatement</code> on the model definition which will set it back to <code>true</code> and prevent accidental data loss.</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span>
<span class="normal"><a href="#__codelineno-67-4">4</a></span>
<span class="normal"><a href="#__codelineno-67-5">5</a></span>
<span class="normal"><a href="#__codelineno-67-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">menu_items</span><span class="p">,</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">SCD_TYPE_2_BY_TIME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="w">    </span><span class="n">unique_key</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Plan/apply this change to production.</p>
<h2 id="external">EXTERNAL<a class="headerlink" href="#external" title="Permanent link"></a></h2>
<p>The EXTERNAL model kind is used to specify <a href="../external_models/">external models</a> that store metadata about external tables. External models are special; they are not specified in .sql files like the other model kinds. They are optional but useful for propagating column and type information for external tables queried in your Vulcan project.</p>
<h2 id="managed">MANAGED<a class="headerlink" href="#managed" title="Permanent link"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Managed models are still under development and the API / semantics may change as support for more engines is added</p>
</div>
<p><strong>Note:</strong> Python models do not support the <code>MANAGED</code> model kind - use a SQL model instead.</p>
<p>The <code>MANAGED</code> model kind is used to create models where the underlying database engine manages the data lifecycle.</p>
<p>These models don't get updated with new intervals or refreshed when <code>vulcan run</code> is called. Responsibility for keeping the <em>data</em> up to date falls on the engine.</p>
<p>You can control how the engine creates the managed model by using the <a href="../overview/#physical_properties"><code>physical_properties</code></a> to pass engine-specific parameters for adapter to use when issuing commands to the underlying database.</p>
<p>Due to there being no standard, each vendor has a different implementation with different semantics and different configuration parameters. Therefore, <code>MANAGED</code> models are not as portable between database engines as other Vulcan model types. In addition, due to their black-box nature, Vulcan has limited visibility into the integrity and state of the model.</p>
<p>We would recommend using standard Vulcan model types in the first instance. However, if you do need to use Managed models, you still gain other Vulcan benefits like the ability to use them in <a href="../../overview/#build-a-virtual-environment">virtual environments</a>.</p>
<p>See <a href="../managed_models/">Managed Models</a> for more information on which engines are supported and which properties are available.</p>
<h2 id="incremental_by_partition">INCREMENTAL_BY_PARTITION<a class="headerlink" href="#incremental_by_partition" title="Permanent link"></a></h2>
<p>Models of the <code>INCREMENTAL_BY_PARTITION</code> kind are computed incrementally based on partition. A set of columns defines the model's partitioning key, and a partition is the group of rows with the same partitioning key value.</p>
<div class="admonition question">
<p class="admonition-title">Should you use this model kind?</p>
<p>Any model kind can use a partitioned <strong>table</strong> by specifying the <a href="../overview/#partitioned_by"><code>partitioned_by</code> key</a> in the <code>MODEL</code> DDL.</p>
<p>The "partition" in <code>INCREMENTAL_BY_PARTITION</code> is about how the data is <strong>loaded</strong> when the model runs.</p>
<p><code>INCREMENTAL_BY_PARTITION</code> models are inherently <a href="../../glossary/#idempotency">non-idempotent</a>, so restatements and other actions can cause data loss. This makes them more complex to manage than other model kinds.</p>
<p>In most scenarios, an <code>INCREMENTAL_BY_TIME_RANGE</code> model can meet your needs and will be easier to manage. The <code>INCREMENTAL_BY_PARTITION</code> model kind should only be used when the data must be loaded by partition (usually for performance reasons).</p>
</div>
<p>This model kind is designed for the scenario where data rows should be loaded and updated as a group based on their shared value for the partitioning key.</p>
<p>It may be used with any SQL engine. Vulcan will automatically create partitioned tables on engines that support explicit table partitioning (e.g., <a href="https://cloud.google.com/bigquery/docs/creating-partitioned-tables">BigQuery</a>, <a href="https://docs.databricks.com/en/sql/language-manual/sql-ref-partition.html">Databricks</a>).</p>
<p>New rows are loaded based on their partitioning key value:</p>
<ul>
<li>If a partitioning key in newly loaded data is not present in the model table, the new partitioning key and its data rows are inserted.</li>
<li>If a partitioning key in newly loaded data is already present in the model table, <strong>all the partitioning key's existing data rows in the model table are replaced</strong> with the partitioning key's data rows in the newly loaded data.</li>
<li>If a partitioning key is present in the model table but not present in the newly loaded data, the partitioning key's existing data rows are not modified and remain in the model table.</li>
</ul>
<p>This kind should only be used for datasets that have the following traits:</p>
<ul>
<li>The dataset's records can be grouped by a partitioning key.</li>
<li>Each record has a partitioning key associated with it.</li>
<li>It is appropriate to upsert records, so existing records can be overwritten by new arrivals when their partitioning keys match.</li>
<li>All existing records associated with a given partitioning key can be removed or overwritten when any new record has the partitioning key value.</li>
</ul>
<p>The column defining the partitioning key is specified in the model's <code>MODEL</code> DDL <code>partitioned_by</code> key. This example shows the <code>MODEL</code> DDL for an <code>INCREMENTAL_BY_PARTITION</code> model whose partition key is the row's value for the <code>region</code> column:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span>
<span class="normal"><a href="#__codelineno-68-2">2</a></span>
<span class="normal"><a href="#__codelineno-68-3">3</a></span>
<span class="normal"><a href="#__codelineno-68-4">4</a></span>
<span class="normal"><a href="#__codelineno-68-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="hll"><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="n">region</span><span class="p">,</span>
</span></span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Compound partition keys are also supported, such as <code>region</code> and <code>department</code>:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span>
<span class="normal"><a href="#__codelineno-69-2">2</a></span>
<span class="normal"><a href="#__codelineno-69-3">3</a></span>
<span class="normal"><a href="#__codelineno-69-4">4</a></span>
<span class="normal"><a href="#__codelineno-69-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="hll"><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">department</span><span class="p">),</span>
</span></span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Date and/or timestamp column expressions are also supported (varies by SQL engine). This BigQuery example's partition key is based on the month each row's <code>event_date</code> occurred:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span>
<span class="normal"><a href="#__codelineno-70-4">4</a></span>
<span class="normal"><a href="#__codelineno-70-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="hll"><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="n">DATETIME_TRUNC</span><span class="p">(</span><span class="n">event_date</span><span class="p">,</span><span class="w"> </span><span class="k">MONTH</span><span class="p">)</span>
</span></span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<div class="admonition warning">
<p class="admonition-title">Only full restatements supported</p>
<p>Partial data <a href="../../plans/#restatement-plans">restatements</a> are used to reprocess part of a table's data (usually a limited time range).</p>
<p>Partial data restatement is not supported for <code>INCREMENTAL_BY_PARTITION</code> models. If you restate an <code>INCREMENTAL_BY_PARTITION</code> model, its entire table will be recreated from scratch.</p>
<p>Restating <code>INCREMENTAL_BY_PARTITION</code> models may lead to data loss and should be performed with care.</p>
</div>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link"></a></h3>
<p>This is a fuller example of how you would use this model kind in practice. It limits the number of partitions to backfill based on time range in the <code>partitions_to_update</code> CTE.</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-71-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-71-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-71-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-71-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-71-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-71-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-71-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-71-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-71-10">10</a></span>
<span class="normal"><a href="#__codelineno-71-11">11</a></span>
<span class="normal"><a href="#__codelineno-71-12">12</a></span>
<span class="normal"><a href="#__codelineno-71-13">13</a></span>
<span class="normal"><a href="#__codelineno-71-14">14</a></span>
<span class="normal"><a href="#__codelineno-71-15">15</a></span>
<span class="normal"><a href="#__codelineno-71-16">16</a></span>
<span class="normal"><a href="#__codelineno-71-17">17</a></span>
<span class="normal"><a href="#__codelineno-71-18">18</a></span>
<span class="normal"><a href="#__codelineno-71-19">19</a></span>
<span class="normal"><a href="#__codelineno-71-20">20</a></span>
<span class="normal"><a href="#__codelineno-71-21">21</a></span>
<span class="normal"><a href="#__codelineno-71-22">22</a></span>
<span class="normal"><a href="#__codelineno-71-23">23</a></span>
<span class="normal"><a href="#__codelineno-71-24">24</a></span>
<span class="normal"><a href="#__codelineno-71-25">25</a></span>
<span class="normal"><a href="#__codelineno-71-26">26</a></span>
<span class="normal"><a href="#__codelineno-71-27">27</a></span>
<span class="normal"><a href="#__codelineno-71-28">28</a></span>
<span class="normal"><a href="#__codelineno-71-29">29</a></span>
<span class="normal"><a href="#__codelineno-71-30">30</a></span>
<span class="normal"><a href="#__codelineno-71-31">31</a></span>
<span class="normal"><a href="#__codelineno-71-32">32</a></span>
<span class="normal"><a href="#__codelineno-71-33">33</a></span>
<span class="normal"><a href="#__codelineno-71-34">34</a></span>
<span class="normal"><a href="#__codelineno-71-35">35</a></span>
<span class="normal"><a href="#__codelineno-71-36">36</a></span>
<span class="normal"><a href="#__codelineno-71-37">37</a></span>
<span class="normal"><a href="#__codelineno-71-38">38</a></span>
<span class="normal"><a href="#__codelineno-71-39">39</a></span>
<span class="normal"><a href="#__codelineno-71-40">40</a></span>
<span class="normal"><a href="#__codelineno-71-41">41</a></span>
<span class="normal"><a href="#__codelineno-71-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_by_partition_demo</span><span class="p">,</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_BY_PARTITION</span><span class="p">,</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="w">  </span><span class="n">partitioned_by</span><span class="w"> </span><span class="n">user_segment</span><span class="p">,</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5"></a><span class="p">);</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6"></a>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7"></a><span class="c1">-- This is the source of truth for what partitions need to be updated and will join to the product usage data</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8"></a><span class="c1">-- This could be an INCREMENTAL_BY_TIME_RANGE model that reads in the user_segment values last updated in the past 30 days to reduce scope</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9"></a><span class="c1">-- Use this strategy to reduce full restatements</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10"></a><span class="k">WITH</span><span class="w"> </span><span class="n">partitions_to_update</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12"></a><span class="w">    </span><span class="n">user_segment</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">incremental_by_time_range_demo</span><span class="w">  </span><span class="c1">-- upstream table tracking which user segments to update</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">last_updated_at</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="o">@</span><span class="n">start_dt</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">@</span><span class="n">end_dt</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15"></a><span class="p">),</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16"></a>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17"></a><span class="n">product_usage</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18"></a><span class="w">  </span><span class="k">SELECT</span>
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19"></a><span class="w">    </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20"></a><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-71-21"><a id="__codelineno-71-21" name="__codelineno-71-21"></a><span class="w">    </span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-71-22"><a id="__codelineno-71-22" name="__codelineno-71-22"></a><span class="w">    </span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-71-23"><a id="__codelineno-71-23" name="__codelineno-71-23"></a><span class="w">    </span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-71-24"><a id="__codelineno-71-24" name="__codelineno-71-24"></a><span class="w">    </span><span class="n">user_segment</span>
</span><span id="__span-71-25"><a id="__codelineno-71-25" name="__codelineno-71-25"></a><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">vulcan</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="n">demo</span><span class="p">.</span><span class="n">tcloud_raw_data</span><span class="p">.</span><span class="n">product_usage</span>
</span><span id="__span-71-26"><a id="__codelineno-71-26" name="__codelineno-71-26"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_segment</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">user_segment</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">partitions_to_update</span><span class="p">)</span><span class="w"> </span><span class="c1">-- partition filter applied here</span>
</span><span id="__span-71-27"><a id="__codelineno-71-27" name="__codelineno-71-27"></a><span class="p">)</span>
</span><span id="__span-71-28"><a id="__codelineno-71-28" name="__codelineno-71-28"></a>
</span><span id="__span-71-29"><a id="__codelineno-71-29" name="__codelineno-71-29"></a><span class="k">SELECT</span>
</span><span id="__span-71-30"><a id="__codelineno-71-30" name="__codelineno-71-30"></a><span class="w">  </span><span class="n">product_id</span><span class="p">,</span>
</span><span id="__span-71-31"><a id="__codelineno-71-31" name="__codelineno-71-31"></a><span class="w">  </span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-71-32"><a id="__codelineno-71-32" name="__codelineno-71-32"></a><span class="w">  </span><span class="n">last_usage_date</span><span class="p">,</span>
</span><span id="__span-71-33"><a id="__codelineno-71-33" name="__codelineno-71-33"></a><span class="w">  </span><span class="n">usage_count</span><span class="p">,</span>
</span><span id="__span-71-34"><a id="__codelineno-71-34" name="__codelineno-71-34"></a><span class="w">  </span><span class="n">feature_utilization_score</span><span class="p">,</span>
</span><span id="__span-71-35"><a id="__codelineno-71-35" name="__codelineno-71-35"></a><span class="w">  </span><span class="n">user_segment</span><span class="p">,</span>
</span><span id="__span-71-36"><a id="__codelineno-71-36" name="__codelineno-71-36"></a><span class="w">  </span><span class="k">CASE</span>
</span><span id="__span-71-37"><a id="__codelineno-71-37" name="__codelineno-71-37"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">feature_utilization_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Power User'</span>
</span><span id="__span-71-38"><a id="__codelineno-71-38" name="__codelineno-71-38"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">usage_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'Regular User'</span>
</span><span id="__span-71-39"><a id="__codelineno-71-39" name="__codelineno-71-39"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">usage_count</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">'New User'</span>
</span><span id="__span-71-40"><a id="__codelineno-71-40" name="__codelineno-71-40"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">'Light User'</span>
</span><span id="__span-71-41"><a id="__codelineno-71-41" name="__codelineno-71-41"></a><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">user_type</span>
</span><span id="__span-71-42"><a id="__codelineno-71-42" name="__codelineno-71-42"></a><span class="k">FROM</span><span class="w"> </span><span class="n">product_usage</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p><strong>Note</strong>: Partial data <a href="../../plans/#restatement-plans">restatement</a> is not supported for this model kind, which means that the entire table will be recreated from scratch if restated. This may lead to data loss.</p>
<h3 id="materialization-strategy_3">Materialization strategy<a class="headerlink" href="#materialization-strategy_3" title="Permanent link"></a></h3>
<p>Depending on the target engine, models of the <code>INCREMENTAL_BY_PARTITION</code> kind are materialized using the following strategies:</p>
<table>
<thead>
<tr>
<th>Engine</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Databricks</td>
<td>REPLACE WHERE by partitioning key</td>
</tr>
<tr>
<td>Spark</td>
<td>INSERT OVERWRITE by partitioning key</td>
</tr>
<tr>
<td>Snowflake</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>BigQuery</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>Redshift</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>Postgres</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
<tr>
<td>DuckDB</td>
<td>DELETE by partitioning key, then INSERT</td>
</tr>
</tbody>
</table>
<h2 id="incremental_unmanaged">INCREMENTAL_UNMANAGED<a class="headerlink" href="#incremental_unmanaged" title="Permanent link"></a></h2>
<p>The <code>INCREMENTAL_UNMANAGED</code> model kind exists to support append-only tables. It's "unmanaged" in the sense that Vulcan doesnt try to manage how the data is loaded. Vulcan will just run your query on the configured cadence and append whatever it gets into the table.</p>
<div class="admonition question">
<p class="admonition-title">Should you use this model kind?</p>
<p>Some patterns for data management, such as Data Vault, may rely on append-only tables. In this situation, <code>INCREMENTAL_UNMANAGED</code> is the correct type to use.</p>
<p>In most other situations, you probably want <code>INCREMENTAL_BY_TIME_RANGE</code> or <code>INCREMENTAL_BY_UNIQUE_KEY</code> because they give you much more control over how the data is loaded.</p>
</div>
<p>Usage of the <code>INCREMENTAL_UNMANAGED</code> model kind is straightforward:</p>
<div class="language-sql highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span>
<span class="normal"><a href="#__codelineno-72-3">3</a></span>
<span class="normal"><a href="#__codelineno-72-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="n">MODEL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">,</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="hll"><span class="w">  </span><span class="n">kind</span><span class="w"> </span><span class="n">INCREMENTAL_UNMANAGED</span><span class="p">,</span>
</span></span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="p">);</span>
</span></code></pre></div></td></tr></tbody></table></div>
<p>Since it's unmanaged, it doesnt support the <code>batch_size</code> and <code>batch_concurrency</code> properties to control how data is loaded like the other incremental model types do.</p>
<div class="admonition warning">
<p class="admonition-title">Only full restatements supported</p>
<p>Similar to <code>INCREMENTAL_BY_PARTITION</code>, attempting to <a href="../../plans/#restatement-plans">restate</a> an <code>INCREMENTAL_UNMANAGED</code> model will trigger a full restatement. That is, the model will be rebuilt from scratch rather than from a time slice you specify.</p>
<p>This is because an append-only table is inherently non-idempotent. Restating <code>INCREMENTAL_UNMANAGED</code> models may lead to data loss and should be performed with care.</p>
</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  2024 DataOS Vulcan Team<br>
<small>Complete stack for building data products</small>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/tmdc-io/vulcan-book" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "toc.follow", "search.highlight", "search.suggest", "content.tabs.link", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>